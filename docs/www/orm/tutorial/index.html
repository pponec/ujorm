<html><head><title>Ujorm User Guide - EN</title><style type="text/css">ol{margin:0;padding:0}.c53{vertical-align:top;width:429.8pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c57{vertical-align:top;width:381pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c61{vertical-align:top;width:401.2pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c36{vertical-align:top;width:437.2pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c35{vertical-align:top;width:468pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c65{vertical-align:top;width:297pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c50{vertical-align:top;width:347.2pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c52{vertical-align:top;width:438pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c70{vertical-align:top;width:430.5pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c71{vertical-align:top;width:404.2pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c69{vertical-align:top;width:379.5pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c44{vertical-align:top;width:390.8pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c22{vertical-align:top;width:117pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c74{vertical-align:top;width:446.2pt;border-style:solid;border-color:#ffffff;border-width:0pt;padding:5pt 5pt 5pt 5pt}.c30{vertical-align:top;width:498.6pt;border-style:solid;border-color:#999999;border-width:1pt;padding:5pt 5pt 5pt 5pt}.c67{vertical-align:top;width:436.2pt;border-style:solid;border-color:#999999;border-width:1pt;padding:5pt 5pt 5pt 5pt}.c63{vertical-align:top;width:29.2pt;border-style:solid;border-color:#ffffff;border-width:0pt;padding:5pt 5pt 5pt 5pt}.c62{max-width:498.6pt;background-color:#ffffff;padding:56.7pt 56.7pt 56.7pt 56.7pt}.c0{padding-top:0pt;direction:ltr;padding-bottom:0pt}.c17{list-style-type:circle;margin:0;padding:0}.c58{list-style-type:square;margin:0;padding:0}.c66{list-style-type:decimal;margin:0;padding:0}.c6{list-style-type:disc;margin:0;padding:0}.c46{padding-left:0pt;margin-left:54pt}.c10{direction:ltr;margin-left:36pt}.c38{padding-left:0pt;padding-top:0pt}.c19{color:#0000ee;text-decoration:underline}.c1{color:inherit;text-decoration:inherit}.c45{padding-left:0pt;margin-left:36pt}.c31{padding-left:0pt;margin-left:60pt}.c21{padding-top:0pt;direction:ltr}.c49{color:#000099;text-decoration:underline}.c20{color:#1155cc;text-decoration:underline}.c3{padding-left:0pt;margin-left:45pt}.c56{padding-left:0pt;margin-left:90pt}.c2{padding-left:0pt;margin-left:30pt}.c39{margin-right:4.5pt}.c26{color:#999999}.c13{font-family:"Courier New"}.c18{color:#0b5394}.c14{color:#741b47}.c29{direction:ltr}.c37{padding-bottom:12.8pt}.c40{color:#3d85c6}.c23{padding-bottom:11.2pt}.c60{padding-bottom:4pt}.c48{margin-left:54pt}.c75{color:#e69138}.c54{font-size:9pt}.c73{font-size:18pt}.c33{color:#674ea7}.c16{text-align:center}.c9{margin-left:30pt}.c7{color:#7f6000}.c32{color:#666666}.c41{padding-top:14pt}.c12{margin-left:21pt}.c11{text-align:right}.c4{height:0pt}.c8{font-weight:bold}.c24{border-collapse:collapse}.c59{margin-left:36pt}.c42{margin-left:4.5pt}.c25{color:#cc0000}.c34{margin-left:28.5pt}.c5{height:10pt}.c43{margin-left:60pt}.c47{color:#a64d79}.c15{font-style:italic}.c55{color:#990000}.c64{font-size:8pt}.c72{margin-left:120pt}.c68{margin-left:18pt}.c28{color:#bf9000}.c27{color:#351c75}.c51{font-size:11pt}.title{padding-top:24pt;line-height:1.0;text-align:left;color:#000000;font-size:36pt;font-family:"Verdana";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.0;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:10pt;font-family:"Verdana"}p{color:#000000;font-size:10pt;margin:0;font-family:"Verdana"}h1{padding-top:12pt;line-height:1.0;text-align:left;color:#000000;font-size:18pt;font-family:"Verdana";font-weight:bold;padding-bottom:12pt}h2{padding-top:11.2pt;line-height:1.0;text-align:left;color:#000000;font-size:14pt;font-family:"Verdana";font-weight:bold;padding-bottom:11.2pt}h3{padding-top:12pt;line-height:1.0;text-align:left;color:#000000;font-size:12pt;font-family:"Verdana";font-weight:bold;padding-bottom:12pt}h4{padding-top:12.8pt;line-height:1.0;text-align:left;color:#000000;font-size:10pt;font-family:"Verdana";font-weight:bold;padding-bottom:12.8pt}h5{padding-top:12.8pt;line-height:1.0;text-align:left;color:#000000;font-size:8pt;font-family:"Verdana";font-weight:bold;padding-bottom:12.8pt}h6{padding-top:18pt;line-height:1.0;text-align:left;color:#000000;font-size:8pt;font-family:"Verdana";font-weight:bold;padding-bottom:18pt}</style></head><body class="c62"><h1 class="c29"><a name="h.2f89e3402672"></a><span class="c33 c8 c73">Ujorm User Guide</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img height="65" src="images/image01.png" width="65"></h1><p class="c21"><span class="c33 c8 c51">the ORM module</span></p><p class="c0 c5"><span class="c33 c8 c51"></span></p><p class="c0"><span class="c15">Document License: </span><span class="c19 c15"><a class="c1" href="http://creativecommons.org/licenses/by-nd/3.0/">Creative Commons BY-ND</a></span><span class="c15">&nbsp;,</span></p><p class="c0"><span class="c15">Author: Pavel Ponec, ponec@ujorm.com</span></p><p class="c0 c9"><span class="c15">&nbsp;&nbsp; Spring Integration by Tomas Hampl</span></p><p class="c0"><span class="c15">Version: Ujorm 1.30 (October, 2012)</span></p><p class="c0"><span class="c15">PDF format:</span><span>&nbsp;</span><img height="16" src="images/image02.png" width="16"><span class="c20"><a class="c1" href="http://ujorm.org/orm/tutorial/UjormUserGuide-1.30.pdf">http://ujorm.org/orm/tutorial/UjormUserGuide-1.30.pdf </a></span></p><p class="c0"><span class="c15">Thank you for your comments or suggestions.</span></p><p class="c21 c23 c5"><span></span></p><p class="c29 c68"><span class="c20"><a class="c1" href="#h.2f89e3402672">Ujorm User Guide</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.6d553494a6d4">Prologue</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.3f19c028a66e">Quick Start</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.dc11e7a0ee04">Architecture</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.524c1014fb21">Example of the application code</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.fbe3bfa4e133">Persistent domain objects</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.d0c24121399a">Comment by annotations</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.e3c2a8d31f1d">How to use the Criterion?</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.f3eeecf0018a">Native Criterion</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.69a8d8c6e0d5">Native Query</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.68ad777df9c1">Dynamic native query</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.c7130ecb63b9">States of persistent object</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.c448f4c12d9e">Mapping of data types</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.f52f9a1ffe92">Lazy loading</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.b0f5b8a80c12">Session cache</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.dda7591ed9d5">DDL support</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.c672291e4db1">Entity inheritance</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.e795e614c8d5">Primary key auto increment</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.7b8bdc481ed0">Database procedures</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.fa936dd12adb">Connection to database</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.b24a52ae4cf8">Batch database operations</a></span></p><p class="c29 c48"><span class="c20"><a class="c1" href="#h.fd8iy4h5f88u">Batch insert</a></span></p><p class="c29 c48"><span class="c20"><a class="c1" href="#h.5t2xecc4a6fc">Batch update</a></span></p><p class="c29 c48"><span class="c20"><a class="c1" href="#h.kzh8jc8xqn1g">Batch delete</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.286935a745d0">Transaction control</a></span></p><p class="c29 c48"><span class="c20"><a class="c1" href="#h.ls18qrfpiyn8">Nested transaction</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.dahj244afoo5">Logging support</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.87af2d291d2c">Multi-thread environment</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.2dc8b03b0862">API extension</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.5902a957f5ab">Meta-Model</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.529d45f07307">Performance</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.6c32e8b75e6e">Supported databases</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.55252fa54c31">Why Key constants have lowercase letters?</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.51c99f3693d0">Using of UJO objects</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.978d5de1fd78">Best Practices</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.c41270dc0dbb">Integrating Spring Framework</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.304a6c50b9c1">More information</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.772ac403cca2">References</a></span></p><p class="c10"><span class="c20"><a class="c1" href="#h.cc2d51f7ea2f">Acknowledgements</a></span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.6d553494a6d4"></a><span>Prologue</span></h2><p class="c0"><span class="c19"><a class="c1" href="http://ujorm.com/">Ujorm</a></span><span>&nbsp;is an easy-to-use ORM framework designed for rapid Java development based on a relation database. The framework is carefully designed for the </span><span class="c8">effective</span><span>&nbsp;development with great performance and a small footprint. The key features are:</span></p><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c2"><span>type-safe queries to a relation database</span></li><li class="c0 c2"><span>building of queries are independent on a target database</span></li><li class="c0 c2"><span>relation mapping by the Java code by default, however the</span></li><li class="c0 c2"><span>database mapping can be overwritten by annotations or a XML file</span></li><li class="c0 c2"><span>internal cache with a protection against overload storage</span></li><li class="c0 c2"><span>no entity states</span></li><li class="c0 c2"><span>incremental database update using DDL statements</span></li><li class="c0 c2"><span>lazy initialization is supported</span></li><li class="c0 c2"><span>multi row insert, update and delete is supported by a single SQL statement</span></li><li class="c0 c2"><span>subset of table columns on SELECT can be specified for the statement</span></li><li class="c0 c2"><span>simple and reliable implementation solution</span></li><li class="c0 c2"><span>integration support for the Spring Framework&nbsp;</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span>The main vision is:</span></p><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c2"><span>50% developer time saving for a persistent layer and</span></li><li class="c0 c2"><span>great performance compared with competitors</span></li><li class="c0 c2"><span>simple rules to use</span></li><li class="c0 c2"><span>lightweight ORM framework</span></li><li class="c0 c2"><span>open-source for free use, including commercial</span></li></ol><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.3f19c028a66e"></a><span>Quick Start</span></h2><p class="c0"><span>There is recommended to read first of all this </span><span class="c19"><a class="c1" href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/SampleORM.java?view=markup">class tutorial</a></span><span>&nbsp;based on an annotated source code for a quick introduction. In the tutorial you can found entities from following class diagram:</span></p><p class="c0 c9 c5"><span></span></p><p class="c0 c5 c16"><span></span></p><p class="c0 c16"><img height="225" src="images/image03.png" width="444"></p><p class="c0"><span class="c15">Note: Keys are in diagrams formally described using the attributes of entity.</span></p><p class="c0 c5"><span class="c15"></span></p><p class="c0"><span>Because the Ujorm connected from Maven repository (repo1) is compiled without debugging information, I suggest to you to join the Ujorm JavaDoc to your project, so that you get full names of method parameters and more useful information from API.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>When you use the Maven POM file, take the following dependency:</span></p><p class="c0 c5"><span></span></p><a href="#" name="bca9d76ec197c56aec8e95cdac3063d0fae3ada4"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c35"><p class="c0"><span class="c13">&nbsp; &lt;dependency&gt;</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;</span><span class="c13 c8">org.ujorm</span><span class="c13">&lt;/groupId&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;</span><span class="c13 c8">ujo-orm</span><span class="c13">&lt;/artifactId&gt;</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;version&gt;</span><span class="c13 c8">1.30.RC1</span><span class="c13">&lt;/version&gt;</span></p><p class="c0"><span class="c13">&nbsp; &lt;/dependency&gt;</span></p></td></tr></tbody></table><p class="c21 c23 c5"><span class="c13"></span></p><p class="c21 c23 c5"><span class="c13"></span></p><h2 class="c29"><a name="h.dc11e7a0ee04"></a><span>Architecture</span></h2><p class="c0"><span>The next class diagram clarifies relation between Ujorm framework classes and application domain classes. The diagram is simplified and slightly modified to show only the relevant entities. A more detailed descriptions can be found, if necessary, in the </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/">Ujorm JavaDoc</a></span><span>&nbsp;.</span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0 c16 c5"><span></span></p><p class="c0 c16"><img height="588" src="images/image05.png" width="561"></p><p class="c0 c16 c5"><span></span></p><p class="c0"><span>Notes to graph:</span></p><p class="c0"><span class="c19"><a class="c1" href="http://www.google.com/url?q=http%3A%2F%2Fujorm.org%2Fjavadoc%2Forg%2Fujorm%2FUjoProperty.html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNFf-hVoZYjWIXQSXrJyH4AHQC1QvQ">Key</a></span><span>&nbsp;attributes described in the domain objects are always </span><span class="c8">immutable static constants,</span><span>&nbsp;which provide methods for writing and reading values to (from) the Ujo object. Only this diagram is hinted for better illustration the implementation of Keys in domain objects, in other diagrams of this document is used the same formal registration as for a regular POJO attributes.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>Entity Description:</span></p><ol class="c6" start="1"><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/Ujo.html">Ujo</a></span><span>&nbsp;- interface of an object containing the values. The object provides a list of their properties. A kind of data storage determines the implementation, for example OrmTable uses internally an array of objects.</span></li><li class="c0 c2"><span class="c20"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/Key.html">Key</a></span><span>&nbsp;- immutable object containing meta-data of the object property, which provides also two methods for reading and writing values to Ujo object. The reading method replaces a NULL value for the default value always and for example the method solves an ORM lazy-loading too. Two related Keys could be joined using the method add(), the result is stored in a new immutable instance of the Key interface. The original name of the interface was called the </span><span class="c20"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/UjoProperty.html">UjoProperty</a></span><span>, however the interface is obsoleted now due its unclear meaning and long name.</span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/extensions/Property.html">Property</a></span><span>&nbsp;- the default implementation of Key</span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/implementation/orm/RelationToMany.html">RelationToMany</a></span><span>&nbsp;- extended default implementation of Key designed for the data type: UjoIterator&lt;item&gt;</span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/OrmUjo.html">OrmUjo</a></span><span>&nbsp;- an interface designed for persistent application domain objects. Each object contains the session and provides a list of modified keys, more information are available later in this document</span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/implementation/orm/OrmTable.html">OrmTable</a></span><span>&nbsp;- default implementation of OrmUjo interface</span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/OrmHandler.html">OrmHandler</a></span><span>&nbsp;- owner of the meta-model, which provides an efficient methods to search for specific parts of the meta-model. Meta-model is locked after initialization and can&#39;t be changed later.</span></li><li class="c0 c2"><span class="c49"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html">Criterion</a></span><span>&nbsp;- the fundamental condition for the evaluation database Query. Criterion objects can be joined into a binary tree by operators </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html#and%28org.ujorm.criterion.Criterion%29">and()</a></span><span>&nbsp;and </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html#or%28org.ujorm.criterion.Criterion%29">or()</a></span><span>&nbsp;.</span></li><li class="c0 c2"><span>Database - the class form an application package containing a description of the persistent domain classes and stored procedures. For different DB connections, you can define multiple classes type of Database</span></li><li class="c0 c2"><span>User, Order, Item - example of using application domain objects, Please notice that in object can be used RelatinToMany property like in class Database. This RelationToMany always returns UjoIterator as a result of a new database query.</span></li></ol><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.524c1014fb21"></a><span>Example of the application code</span></h2><p class="c0"><span>The following code example obtains instances of </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/OrmHandler.html">OrmHandler</a></span><span>&nbsp;class and its configuration using the Database class, the instance is retained for. It creates an instance of Order class Items and stores in a database. The </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/Session.html#save%28org.ujorm.orm.OrmUjo%29">save()</a></span><span>&nbsp;and </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/Session.html#commit%28%29">commit()</a></span><span>&nbsp;operations can throw an run-time exception so there is necessary to catch the exception and close the used </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/Session.html">Session</a></span><span>.</span></p><p class="c0 c5"><span></span></p><a href="#" name="436aaf7ac0c7d1e3c64c3c6e7f7aed25c6b32797"></a><a href="#" name="1"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c65"><p class="c0"><span class="c13">&nbsp;OrmHandler handler = </span><span class="c13 c14 c8">new</span><span class="c13 c8">&nbsp;</span><span class="c13">OrmHandler();&nbsp;</span></p><p class="c0"><span class="c13">&nbsp;handler.loadDatabase(Database.</span><span class="c13 c14 c8">class</span><span class="c13">);</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">&nbsp;Order order = </span><span class="c13 c14 c8">new</span><span class="c13 c14">&nbsp;</span><span class="c13">Order();</span></p><p class="c0"><span class="c13">&nbsp;order.setDate(</span><span class="c13 c14 c8">new </span><span class="c13">Date());</span></p><p class="c0"><span class="c13">&nbsp;order.setDescr(&quot;</span><span class="c13 c8 c18">My order</span><span class="c13">&quot;);</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">&nbsp;Item item1 = </span><span class="c13 c14">new </span><span class="c13">Item();</span></p><p class="c0"><span class="c13">&nbsp;item1.setOrder(order);</span></p><p class="c0"><span class="c13">&nbsp;item1.setDescr(</span><span class="c13 c18 c8">&quot;Yellow table&quot;</span><span class="c13">);</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">&nbsp;Item item2 = </span><span class="c13 c14 c8">new</span><span class="c13 c14">&nbsp;</span><span class="c13">Item();</span></p><p class="c0"><span class="c13">&nbsp;item2.setOrder(order);</span></p><p class="c0"><span class="c13">&nbsp;item2.setDescr(</span><span class="c13 c18 c8">&quot;Green window&quot;</span><span class="c13">);</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">&nbsp;Session session =&nbsp;handler.createSession(); &nbsp;</span></p><p class="c0"><span class="c13">&nbsp;session.save(order); &nbsp;</span></p><p class="c0"><span class="c13">&nbsp;session.save(item1); &nbsp;</span></p><p class="c0"><span class="c13">&nbsp;session.save(item2); &nbsp;</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">&nbsp;session.commit(); &nbsp;</span></p><p class="c0"><span class="c13">&nbsp;session.close();</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span>The second example contains usage a query using the </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html">Criterion</a></span><span>&nbsp;joined by two elementary conditions. Missing operator is replaced by the EQUALS&#39; one. Notice how is created composite &#39;Key&#39;. The composite &#39;key&#39; can be stored as an additional static constants of domain object. Prepared query is contained in the &#39;Query&#39; object a can be simply used in &#39;for-each&#39; command. In the end we have to close database &#39;session&#39; again. More information about the Criterion use can be found </span><span class="c19">later</span><span>&nbsp;in this document.</span></p><p class="c0 c5"><span></span></p><a href="#" name="48278fc92c6014c8160a92f76a46f2ef9b8cd6b1"></a><a href="#" name="2"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c52"><p class="c0"><span>&nbsp; </span><span class="c13">Criterion&lt;Item&gt; cn1, cn2, criterion;</span><span>&nbsp; &nbsp;</span></p><p class="c0"><span class="c13">&nbsp;cn1 = Item.id.whereGe(</span><span class="c13 c18 c8">1L</span><span class="c13">);</span></p><p class="c0"><span class="c13">&nbsp;cn2 = Item.order.add(Order.descr).whereEq(</span><span class="c13 c18 c8">&quot;My order&quot;</span><span class="c13">);</span></p><p class="c0"><span class="c13">&nbsp;criterion = cn1.and(cn2);</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">&nbsp;Session session = handler.createSession();</span></p><p class="c0"><span class="c13 c14">&nbsp;</span><span class="c13 c14 c8">for</span><span class="c13">&nbsp;(Item item : session.createQuery(criterion)) {</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp; String descr = item.getDescr();</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp; Date created = item.getOrder().getDate();</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp; System.out.println( created + </span><span class="c13 c18 c8">&quot; : &quot;</span><span class="c13">&nbsp;+ descr );</span></p><p class="c0"><span class="c13">&nbsp;}</span></p><p class="c0"><span class="c13">&nbsp;session.close();</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span>This Java code executes a database SQL statement </span><span class="c8">similar </span><span>to this:</span></p><p class="c0 c5"><span></span></p><a href="#" name="d2137566e23f896250e3a82119511d0a235ad1d3"></a><a href="#" name="3"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c52"><p class="c0"><span class="c13">&nbsp;SELECT * FROM item</span></p><p class="c0"><span class="c13">&nbsp;LEFT INNER JOIN order ON order.id = item.fk_order&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c13">&nbsp;WHERE item.id &gt;= </span><span class="c13 c18 c8">1</span></p><p class="c0"><span class="c13">&nbsp;&nbsp; AND order.descr = &#39;</span><span class="c13 c18 c8">John\&#39;s order</span><span class="c13">&#39;</span></p><p class="c0"><span class="c13">&nbsp;ORDER BY order.created, item.id DESC</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span>where both parameters are passed by a &#39;question mark&#39; notation for a high security.</span></p><p class="c0"><span>In the last example is used information from meta-model, which may contain useful information such as validation of the object.</span></p><p class="c0 c5"><span></span></p><a href="#" name="4327cabf7445bfcb08e0628ac9ed1d8ee8dbdded"></a><a href="#" name="4"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c50"><p class="c0"><span class="c13">&nbsp;MetaColumn col = (MetaColumn) &nbsp;</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handler.findColumnModel(Order.DESCR); &nbsp;</span></p><p class="c0"><span>&nbsp;</span></p><p class="c0"><span class="c13">&nbsp;String msg</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp; = </span><span class="c13 c18 c8">&quot;DB name: &quot;</span><span class="c13">&nbsp;+ col.getFullName()&nbsp; + </span><span class="c13 c18 c8">&#39;\n&#39;</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp; + </span><span class="c13 c18 c8">&quot;Comment: &quot;</span><span class="c13">&nbsp;+ col.getComment() &nbsp; + </span><span class="c13 c18 c8">&#39;\n&#39;</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp; + </span><span class="c13 c18 c8">&quot;Length : &quot;</span><span class="c13">&nbsp;+ col.getMaxLength() + </span><span class="c13 c18 c8">&#39;\n&#39;</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp; + </span><span class="c13 c18 c8">&quot;NotNull: &quot;</span><span class="c13">&nbsp;+ col.isMandatory()&nbsp; + </span><span class="c13 c18 c8">&#39;\n&#39;</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp; + </span><span class="c13 c18 c8">&quot;Primary: &quot;</span><span class="c13">&nbsp;+ col.isPrimaryKey() + </span><span class="c13 c18 c8">&#39;\n&#39;</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp; + </span><span class="c13 c18 c8">&quot;Dialect: &quot;</span><span class="c13">&nbsp;+ col.getDialectName()</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp; ;</span></p><p class="c0"><span class="c13">&nbsp;System.out.println(msg);</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13"></span></p><p class="c29"><span>Prints the text report on a console output:</span></p><a href="#" name="c4411e6d661c48f81171c3ee94d010be2d048aed"></a><a href="#" name="5"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c50"><p class="c0"><span>&nbsp;&nbsp;</span><span class="c13">DB name: db1.ord_order.DESCR</span></p><p class="c0"><span class="c13">&nbsp;Comment: Description of the Order</span></p><p class="c0"><span class="c13">&nbsp;Length : 128</span></p><p class="c0"><span class="c13">&nbsp;NotNull: true</span></p><p class="c0"><span class="c13">&nbsp;Primary: false</span></p><p class="c0"><span class="c13">&nbsp;Dialect: H2Dialect</span></p></td></tr></tbody></table><p class="c21 c23 c5"><span class="c13"></span></p><h2 class="c29"><a name="h.fbe3bfa4e133"></a><span>Persistent domain objects</span></h2><p class="c0"><span>Ujorm framework can use to persistence any object which implements the OrmUjo interface.</span></p><p class="c0"><span>However the easiest way is to create a child from the abstract class OrmTable:</span></p><p class="c0 c5"><span></span></p><a href="#" name="046b5e0b5dd4521454e7b54b941976e2b1b00074"></a><a href="#" name="6"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c53"><p class="c0"><span>public class </span><span class="c8 c27">Order </span><span>extends OrmTable&lt;Order&gt; {</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; @Column(pk = true)</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public static final Key&lt;Order, Long&gt; </span><span class="c8 c27">id </span><span>= newKey();</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public static final Key&lt;Order, Date&gt; </span><span class="c8 c27">created </span><span>= newKey();</span></p><p class="c0"><span>&nbsp; &nbsp; public static final Key&lt;Order, User&gt; </span><span class="c8 c27">user </span><span>= newKey();</span></p><p class="c0 c5"><span></span></p><p class="c0"><span class="c26 c15">&nbsp;&nbsp;&nbsp; /** Reference to an Order Item Iterator */</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public static final RelationToMany&lt;Order, Item&gt; </span><span class="c8 c27">items </span><span>= newRelation();</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>}</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0"><span>The </span><span class="c8">primary key</span><span>&nbsp;is marked by parameter </span><span class="c8">pk</span><span>&nbsp;of the annotation </span><span class="c8">Column</span><span>, a database column name is derived from Key field name by default. That is all, isn&#39;t it easy?</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>OK, for better comfort for developers we can optionally add getters and setters, however it is important to know that the framework doesn&#39;t need the methods:</span></p><p class="c0 c5"><span></span></p><a href="#" name="c75018713f2784b0e6031ddf7a936ac993d1cb12"></a><a href="#" name="7"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c50"><p class="c0"><span>public class </span><span class="c8 c27">Order </span><span>extends OrmTable&lt;Order&gt; {</span></p><p class="c0 c5"><span></span></p><p class="c0"><span class="c26 c15">&nbsp;&nbsp;&nbsp; [ The Key declarations ... ]</span></p><p class="c0 c5"><span class="c26 c15"></span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public Long getId() {</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="c14 c8">return </span><span>get(</span><span class="c8 c27">id</span><span>);</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; }</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public </span><span class="c14 c8">void </span><span>setId(Long _id) {</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set(</span><span class="c8 c27">id</span><span>, _id);</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; }</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public Date getCreated() {</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="c14 c8">return </span><span>get(</span><span class="c8 c27">created</span><span>);</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; }</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public </span><span class="c14 c8">void </span><span>setCreated(Date _created) {</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set(</span><span class="c8 c27">created</span><span>, _created);</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; }</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public User getUser() {</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="c14 c8">return </span><span>get(</span><span class="c8 c27">user</span><span>);</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; }</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public </span><span class="c14 c8">void </span><span>setUser(User _user) {</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set(</span><span class="c8 c27">user</span><span>, _user);</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; }</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; </span><span class="c26 c15">/** Only getter is allowed for the UjoIterlator */</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public UjoIterator&lt;Item&gt; getItems() {</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="c14 c8">return </span><span>get(</span><span class="c8 c27">items</span><span>);</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; }</span></p><p class="c0"><span>}</span></p></td></tr></tbody></table><p class="c21 c23 c5"><span></span></p><p class="c21 c23"><span>Note, that the relation to the Items can&#39;t have got the setter. A new Items can be assigned by the method Session.save(...) to database only.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.d0c24121399a"></a><span>Comment by annotations</span></h2><p class="c0"><span>Since Ujorm release 1.10 is allowed to describe persistent objects or its properties by special annotation called </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/annot/Comment.html">Comment.</a></span></p><p class="c0"><span>In case that a DDL auto-update is enabled than Ujorm write the text to relation database meta-model loading time, if the feature is supported</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>The assigned policy can be affected by parameter </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/metaModel/MetaParams.html#COMMENT_POLICY">COMMENT_POLICY</a></span><span>&nbsp;with options:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>ON_ANY_CHANGE - Assign all available comments from annotations to database on a new database object event,exactly on new table, column or index. It is a </span><span class="c8">default </span><span>option.</span></li><li class="c0 c2"><span>FOR_NEW_OBJECT Assign the comment for a new table only</span></li><li class="c0 c2"><span>NEVER No comments are assigned</span></li><li class="c0 c2"><span>ALWAYS - Write all available comments from annotations to database on each meta-model loading event.</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span>Sample of the use:</span></p><p class="c0 c5"><span></span></p><a href="#" name="186465589ee356fbae7b9ebc8ed66c2ffa7d12a4"></a><a href="#" name="8"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c61"><p class="c0"><span class="c14 c8">@Comment</span><span>(&quot;</span><span class="c27">Order table is a head for its &#39;item&#39;</span><span>&nbsp;list)</span></p><p class="c0"><span>public class </span><span class="c8 c27">Order </span><span>extends OrmTable&lt;Order&gt; {</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; </span><span class="c14 c8">@Comment</span><span>(&quot;</span><span class="c27">The Primary Key</span><span>&quot;)</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; @Column(pk = true)</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public static final Key&lt;Order, Long&gt; </span><span class="c8 c27">id</span><span>&nbsp;= newKey();</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; </span><span class="c14 c8">@Comment</span><span>(&quot;</span><span class="c27">Date of insert</span><span>&quot;)</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public static final Key&lt;Order, Date&gt; </span><span class="c8 c27">created</span><span>&nbsp;= newKey();</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; </span><span class="c14 c8">@Comment</span><span>(&quot;</span><span class="c27">Key to related user</span><span>&quot;)</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; public static final Key&lt;Order, User&gt; </span><span class="c8 c27">user</span><span>&nbsp;= newKey();</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>}</span></p></td></tr></tbody></table><p class="c21 c23 c5"><span></span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.e3c2a8d31f1d"></a><span>How to use the Criterion?</span></h2><p class="c0"><span>The </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html">Criterion</a></span><span>&nbsp;is a base element to restrict a database </span><span class="c8">query</span><span>, however criterions have got one next feature: they can be used immediately for the evaluation of an object - as a </span><span class="c8">validator</span><span>.</span></p><p class="c0"><span>Each Criterion can be built to the binary tree by to operators: </span><span class="c8">and</span><span>(), </span><span class="c8">or</span><span>().</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>For example let&#39;s create an instance of the Order entity:</span></p><p class="c0 c5"><span></span></p><a href="#" name="316900549f5dbe0e15015ed96494c5b4265ec959"></a><a href="#" name="9"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c69"><p class="c0"><span class="c13">final Order order = </span><span class="c13 c14 c8">new </span><span class="c13">Order();</span></p><p class="c0"><span class="c13">order.setId(</span><span class="c13 c18 c8">100L</span><span class="c13">);</span></p><p class="c0"><span class="c13">order.setDescr(&quot;</span><span class="c13 c18 c8">my order</span><span class="c13">&quot;);</span></p><p class="c0"><span class="c13">order.setDate(</span><span class="c13 c14 c8">new</span><span class="c13">&nbsp;Date());</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span>and three different instances of the Criterion class:</span></p><p class="c0 c5"><span></span></p><a href="#" name="f72eba939f363ce646438c2a0aaaaca1d224d2ef"></a><a href="#" name="10"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c57"><p class="c0"><span class="c13 c18 c8">final&nbsp;</span><span class="c13">Criterion&lt;Order&gt; crnId,&nbsp;crnDescr, crnCreated, crn;</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c26 c13 c8 c15">// Order.id&gt;99 :</span></p><p class="c0"><span class="c13">crnId = Order.</span><span class="c13 c8">id</span><span class="c13">.whereGt(</span><span class="c13 c18 c8">99L</span><span class="c13">);</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c26 c13 c8 c15">// Order.descr=&#39;another&#39; :</span></p><p class="c0"><span class="c13">crnDescr = Order.</span><span class="c13 c8">descr</span><span class="c13">.whereEq(&quot;</span><span class="c13 c18 c8">another</span><span class="c13">&quot;);</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c26 c13 c8">// Order.created&lt;=now()</span><span class="c26 c13 c8 c15">&nbsp;:</span></p><p class="c0"><span class="c13">crnCreated = Criterion.where(Order.created</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; , Operator.LE, </span><span class="c13 c14 c8">new </span><span class="c13">Date());</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13"></span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span>See the samples where the </span><span class="c13 c8">assert </span><span>statement have got a true result always.</span></p><p class="c0"><span>Simple condition: </span></p><p class="c0"><span class="c26 c13 c8 c15">Order.id&gt;99</span></p><a href="#" name="924672d88e242980c62a360ace699c4386dc90fb"></a><a href="#" name="11"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c50"><p class="c0"><span class="c13 c14 c8">assert </span><span class="c13">crnId.evaluate(order);</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span>Compound condition: </span></p><p class="c0"><span class="c26 c13 c8 c15">Order.id&gt;99 or Order.descr=&#39;another&#39;</span></p><a href="#" name="c36202c9b6690190e7ae572c122864ac2da1b1c6"></a><a href="#" name="12"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c50"><p class="c0"><span class="c13">crn = crnId.or(crnDescr);</span></p><p class="c0"><span class="c13 c14 c8">assert </span><span class="c13">crn.evaluate(order);</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span>Compound condition with parentheses: </span></p><p class="c0"><span class="c13 c8 c26">Order.created&lt;=now() and (Order.descr=&#39;another&#39; or Order.id&gt;99)</span></p><a href="#" name="4aac5537641366bb71f9dba862ec4e6068cf335d"></a><a href="#" name="13"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c50"><p class="c0"><span class="c13">crn = crnCreated.and(crnDescr.or(crnId));</span></p><p class="c0"><span class="c13 c14 c8">assert </span><span class="c13">crn.evaluate(order);</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span>Another condition: </span></p><p class="c0"><span class="c26 c13 c8 c15">Order.created&lt;=now() or Order.descr=&#39;another&#39;) and Order.id&gt;99</span></p><a href="#" name="369ddca974875ac74b7ea5e08c5254379f00b386"></a><a href="#" name="14"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c50"><p class="c0"><span class="c13">crn = (crnCreated.or(crnDescr)).and(crnId);</span></p><p class="c0"><span class="c26 c13 c15">// ... or simple by a native priority:</span></p><p class="c0"><span class="c13">crn =&nbsp; crnCreated.or(crnDescr).and(crnId);</span></p><p class="c0"><span class="c13 c14 c8">assert </span><span class="c13">crn.evaluate(order);</span></p></td></tr></tbody></table><p class="c21 c23 c5"><span class="c13"></span></p><p class="c29 c39"><span>See the last example to filter an list of order items where each its order is created in the past:</span></p><a href="#" name="d3b85289dadc26007a6bde877e9dadaee78251a0"></a><a href="#" name="15"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr><td class="c30"><p class="c0 c39 c42"><span class="c13">List&lt;Item&gt; items = Item.</span><span class="c13 c8">order</span><span class="c13">.add(</span><span class="c13 c8">created</span><span class="c13">).whereLt(new Date())</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.evaluate(getAllOrderItems());</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13 c14 c8">for</span><span class="c13">&nbsp;(Item item : items) {</span></p><p class="c0 c39 c42"><span class="c13">&nbsp; &nbsp; System.out.println(item);</span></p><p class="c0"><span class="c13">}</span></p></td></tr></tbody></table><p class="c21 c23 c5"><span class="c13"></span></p><p class="c21 c23"><span>Further examples of solved tasks can be found at this </span><span class="c19"><a class="c1" href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/SampleORM.java?view=markup">link</a></span><span>&nbsp;.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.f3eeecf0018a"></a><span>Native Criterion</span></h2><p class="c0"><span>Native Criterion is a special Criterion with a native SQL code. The Criterion can be created by the factory method</span></p><p class="c0 c9"><span>Criterion.forSql(Property, SQL_condition)</span></p><p class="c0"><span>where</span></p><ol class="c6" start="1"><li class="c0 c2"><span>parameter </span><span class="c8">Property </span><span>is required by Ujorm to location a basic </span><span class="c8">database table </span><span>and the join relations in case a composed Property</span></li><li class="c0 c2"><span class="c8">SQL_condition</span><span>&nbsp;is a part of the native SQL statement with a condition expression in a text format</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span>The instance of the native Criterion have got some special features:</span></p><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c2"><span>parameters inside the SQL_condition are not supported by the Ujorm using a &#39;question mark&#39; notation</span></li><li class="c0 c2"><span>your own implementation of SQL the parameters can increase a risk of the </span><span class="c19"><a class="c1" href="http://en.wikipedia.org/wiki/SQL_injection">SQL injection</a></span><span>&nbsp;attacks</span></li><li class="c0 c2"><span>method </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html#evaluate%28UJO%29">Criterion.evaluate(ujo)</a></span><span>&nbsp;is not supported and throws the exception UnsupportedOperationException in the run-time</span></li><li class="c0 c2"><span>native Criterion dependents on a selected database so application developers should to create support for each supported database of target application to ensure database compatibility</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span>The native Criterion can be </span><span class="c8">joined </span><span>with another Criterions include the native type. The Criterion can be used also in the </span><span class="c19">Native Query</span><span>.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>Sample of the use:</span></p><p class="c0 c5"><span></span></p><a href="#" name="ad386641f7ae1f4af9df8c2e704413dbe1a48631"></a><a href="#" name="16"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c71"><p class="c0"><span class="c13">&nbsp;Criterion&lt;Order&gt; crn1 = Criterion.forSql</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Order.</span><span class="c13 c8 c47">id</span><span class="c13">, &quot;</span><span class="c13 c33 c8">ord_order_alias.id &gt; 3</span><span class="c13">&quot;);</span></p><p class="c0"><span class="c13">&nbsp;Criterion&lt;Order&gt; crn2 = Order.created..whereLe(new Date());</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">&nbsp;Query&lt;Order&gt; orders = session.createQuery(crn1.and(crn2));</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13 c14 c8">&nbsp;for</span><span class="c13">&nbsp;(Order order : orders) {</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp; System.out.println(&quot;ORDER: &quot; + order);</span></p><p class="c0"><span class="c13">&nbsp;}</span></p></td></tr></tbody></table><p class="c21 c23 c5"><span class="c13"></span></p><p class="c21 c23"><span>Note: the property </span><span class="c14 c8">id</span><span>&nbsp;from the sample can be replaced for another Key from the Order class.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.69a8d8c6e0d5"></a><span>Native Query</span></h2><p class="c0"><span>The native Query is a tool of the framework Ujorm to mapping a native (database-dependent) SQL query to </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/OrmUjo.html">OrmUjo</a></span><span>&nbsp;business object. Each native Query must be mapped to new object. Using of the Query is similar like the object-table mapping, however the </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/annot/View.html">@View</a></span><span>&nbsp;annotation is used instead of @</span><span class="c8">Table</span><span>.</span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><a href="#" name="ae1b65e7c33ea43a2fbc6b5f1db7a6941a728cdc"></a><a href="#" name="17"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr><td class="c30"><p class="c0"><span class="c13 c14 c8">@View</span><span class="c13">(select=</span><span class="c13 c8">&quot;</span><span class="c13 c8 c28">SELECT ord_order_alias.id, count(*) AS item_count</span><span class="c13 c8">&quot;</span></p><p class="c0"><span class="c13 c8">&nbsp;&nbsp;&nbsp; </span><span class="c13">+</span><span class="c13 c8">&nbsp;&quot;</span><span class="c13 c8 c28">&nbsp;FROM </span><span class="c13 c8 c55">{SCHEMA}</span><span class="c13 c8 c28">.ord_order ord_order_alias</span><span class="c13 c8">&quot;</span></p><p class="c0"><span class="c13 c8">&nbsp;&nbsp;&nbsp; </span><span class="c13">+</span><span class="c13 c8">&nbsp;&quot;</span><span class="c13 c8 c28">, </span><span class="c13 c8 c55">{SCHEMA}</span><span class="c13 c8 c28">.ord_item ord_item_alias</span><span class="c13 c8">&quot;</span></p><p class="c0"><span class="c13 c8">&nbsp;&nbsp;&nbsp; </span><span class="c13">+</span><span class="c13 c8">&nbsp;&quot; </span><span class="c13 c8 c28">WHERE ord_order_alias.id = ord_item_alias.fk_order</span><span class="c13 c8">&quot;</span></p><p class="c0"><span class="c13 c8">&nbsp;&nbsp;&nbsp; </span><span class="c13">+</span><span class="c13 c8">&nbsp;&quot; </span><span class="c13 c8 c28">GROUP BY ord_order_alias.id</span><span class="c13 c8">&quot;</span></p><p class="c0"><span class="c13 c8">&nbsp;&nbsp;&nbsp; </span><span class="c13">+</span><span class="c13 c8">&nbsp;&quot; </span><span class="c13 c8 c28">ORDER BY ord_order_alias.id</span><span class="c13 c8">&quot;</span><span class="c13">)</span></p><p class="c0"><span class="c13">public </span><span class="c13 c33 c8">class </span><span class="c13">ViewOrder </span><span class="c13 c8 c33">extends </span><span class="c13">OrmTable&lt;ViewOrder&gt; {</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp; </span><span class="c26 c13">/** Unique key */</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp; </span><span class="c13 c14 c8">@Column</span><span class="c13">(pk=true)</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp; </span><span class="c13 c33 c8">public static final</span><span class="c13">&nbsp;Key&lt;ViewOrder,Long&gt; ID = newKey();</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp; </span><span class="c26 c13">/** Item Count */</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp; </span><span class="c13 c33 c8">public static final</span><span class="c13">&nbsp;Key&lt;ViewOrder,Integer&gt; ITEM_COUNT = newKey(</span><span class="c13 c14 c8">0</span><span class="c13">);</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">}</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p><p class="c0"><span>The View:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>must contain an unique column similar as a primary key</span></li><li class="c0 c2"><span>supports </span><span class="c8">relations </span><span>to another views or tables</span></li><li class="c0 c2"><span>the view business object can&#39;t be used to the INSERT, UPDATE nor DELETE</span></li><li class="c0 c2"><span>different SQL syntax can be covered in a different XML configurations</span></li><li class="c0 c2"><span>in the most cases the additional Criterion (all types) is supported</span></li><li class="c0 c2"><span>in the most cases the additional sorting is supported</span></li><li class="c0 c2"><span>attributes LIMIT and OFFSET are ignored</span></li></ol><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.68ad777df9c1"></a><span>Dynamic native query</span></h2><p class="c21 c23"><span>Sometimes there is necessary to use a SQK query built in the run-time. For the case use you can use the next feature:</span></p><a href="#" name="a686ba3e012bc40a5075dd674cc9ec8357400c68"></a><a href="#" name="18"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr><td class="c30"><p class="c0"><span class="c13 c33 c8">final </span><span class="c13">Long </span><span class="c13 c40 c8">excludedId </span><span class="c13">= </span><span class="c13 c33 c8">-7L</span><span class="c13">;</span></p><p class="c0"><span class="c13">SqlParameters sql = </span><span class="c13 c33 c8">new </span><span class="c13">SqlParameters().setSqlStatement</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span class="c13 c28">&nbsp;</span><span class="c13 c8 c28">&quot;SELECT * FROM (&quot;</span></p><p class="c0"><span class="c13 c8 c28">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c13">+</span><span class="c13 c8 c28">&nbsp;&quot;SELECT ord_order_alias.id&quot;</span></p><p class="c0"><span class="c13 c8 c28">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c13">+</span><span class="c13 c8 c28">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;, 1000 + count(*) AS item_count&quot;</span></p><p class="c0"><span class="c13 c8 c28">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c13">+</span><span class="c13 c8 c28">&nbsp;&quot; FROM </span><span class="c13 c8 c55">${SCHEMA}</span><span class="c13 c8 c28">.ord_order ord_order_alias&quot;</span></p><p class="c0"><span class="c13 c8 c28">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c13">+</span><span class="c13 c8 c28">&nbsp;&quot; LEFT JOIN </span><span class="c13 c8 c55">${SCHEMA}</span><span class="c13 c8 c28">.ord_item ord_item_alias&quot;</span></p><p class="c0"><span class="c13 c8 c28">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c13">+</span><span class="c13 c8 c28">&nbsp;&quot; ON ord_order_alias.id = ord_item_alias.fk_order&quot;</span></p><p class="c0"><span class="c13 c8 c28">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c13">+</span><span class="c13 c8 c28">&nbsp;&quot; WHERE ord_item_alias.id != ?&quot;</span><span class="c26 c13">&nbsp;</span><span class="c26 c13 c64">// Parameter is replaced by the excludedId</span></p><p class="c0"><span class="c13 c8 c28">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c13">+</span><span class="c13 c8 c28">&nbsp;&quot; GROUP BY ord_order_alias.id&quot;</span></p><p class="c0"><span class="c13 c8 c28">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c13">+</span><span class="c13 c8 c28">&nbsp;&quot; ORDER BY ord_order_alias.id&quot;</span></p><p class="c0"><span class="c13 c8 c28">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c13">+</span><span class="c13 c8 c28">&nbsp;&quot;) testView WHERE true&quot;</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).setParameters(</span><span class="c13 c8 c40">excludedId</span><span class="c13">);</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">Criterion&lt;ViewOrder&gt; </span><span class="c13 c8">crit </span><span class="c13">= ViewOrder.</span><span class="c13 c8">itemCount</span><span class="c13">.whereLe(100);</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">long orderCount = session.createQuery(</span><span class="c13 c8">crit</span><span class="c13">)</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.setSqlParameters(sql)</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.getCount()</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></p><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span class="c13">Query&lt;ViewOrder&gt; orders = session.createQuery(</span><span class="c13 c8">crit</span><span class="c13">)</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.setLimit(5)</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.orderBy(ViewOrder.ID)</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.setSqlParameters(sql)</span></p><p class="c0"><span class="c13">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></p></td></tr></tbody></table><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.c7130ecb63b9"></a><span>States of persistent object</span></h2><p class="c0"><span>Persistent class is obtained by extending the abstract class </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/implementation/orm/OrmTable.html">OrmTable</a></span><span>&nbsp;or implementation of </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/OrmUjo.html">OrmUjo</a></span><span>&nbsp;interface. Persistent object </span><span class="c8">doesn&#39;t</span><span>&nbsp;contain invasive states known from specifications of &#39;JPA/Hibernate&#39;, but each persistent object of OrmUjo type contains two other attributes:</span></p><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/Session.html">Session</a></span><span>&nbsp;- is needed to obtain a &#39;DB connection&#39; in late values approach, the process is called &#39;lazy-loading&#39;. If an </span><span class="c8">attribute of</span><span>&nbsp;the persistent object is another persistent object, then in each session reading is &#39;session&#39; propagated from the reference to the relational object. For this reason, if you restore the &#39;session&#39;, there is sufficient to setup only the first object of the relational hierarchy to the current Session.</span></li><li class="c0 c2"><span class="c49"><a class="c1" href="http://www.google.com/url?q=http%3A%2F%2Fujorm.org%2Fjavadoc%2Forg%2Fujorm%2FUjoProperty.html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNFf-hVoZYjWIXQSXrJyH4AHQC1QvQ">Key</a></span><span>[] - contains a list of &#39;Properties&#39; </span><span class="c8">registered</span><span>&nbsp;during the assigned session. This list provides more efficient updating of the database by &#39;UPDATE&#39; command, because the command is compiled only for the modified value of the &#39;Properties&#39;. Other values are ignored while updating. Note that if a session isn&#39;t assigned to the object, there is registered no value changes.</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span>Function of OrmUjo object is just &quot;data transporter&quot;, without any restrictions you can do activities such as:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>object obtained using the &#39;update&#39; can be used (after changing ID) for insert</span></li><li class="c0 c2"><span>a new session can be assigned to object anytime (no other dependency)</span></li><li class="c0 c2"><span>object can be assigned with </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/ForeignKey.html">foreign key</a></span><span>&nbsp;to force LazyLoading - using &#39;Ujo.writeValue()&#39;</span></li><li class="c0 c2"><span>to change the session of ManyToOne type (update of foreign key) is sufficient to assign a new instance of an object containing an real Primary Key</span></li><li class="c0 c2"><span>when using Criterion, the value of the filter (parameter) can be a new instance of OrmUjo object that contains the required Primary Key</span></li></ol><p class="c21 c23 c5"><span></span></p><p class="c21 c23"><span>Note: both of these attributes aren&#39;t transferred by Java </span><span class="c8">serialization,</span><span>&nbsp;which means that after the restoration from serialization, they will be logically empty.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.c448f4c12d9e"></a><span>Mapping of data types</span></h2><p class="c0"><span>Mapping of data types means adding JDBC type and element name to persistent Ujo property. Depending on the parameter mapping can be divided into two major groups:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>mapping of session - mapping to another persistent object of </span><span class="c8">OrmUjo </span><span>type</span></li><li class="c0 c2"><span>mapping of value - other assignments of selected object types</span></li></ol><p class="c0"><span>More detailed description is here:</span></p><p class="c0 c5"><span></span></p><p class="c0"><span class="c8 c27">Mapping of values</span></p><ol class="c6" start="1"><li class="c0 c2"><span class="c8">default</span><span>&nbsp;mapping is implemented for objects of these types: String, Boolean, Byte, Character, Short, Integer, Long, Float, Double, BigDecimal, BigInteger, byte [], java.util.Date, java.sql.Date, java.sql.Time, java.sql.Timestamp, java.sql.Blob, java.sql.Clob, Enum</span></li><li class="c0 c2"><span class="c8">explicit</span><span>&nbsp;mapping is given in &#39;@Column&#39; annotation or via an XML configuration file</span></li><li class="c0 c2"><span>via </span><span class="c8">interface:</span><span>&nbsp;any object that implements the interface &#39;ValueExportable&#39; is automatically mapped to &#39;VARCHAR&#39;. That interface can also implement the &#39;Enum&#39; type.</span></li><li class="c0 c2"><span>specific requirements for mapping can be implemented by overlay </span><span class="c8">TypeService </span><span>class</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span class="c8 c27">Mapping of session M:1</span></p><ol class="c6" start="1"><li class="c0 c2"><span>mapping on primary key: for mapping is used standard property, only in class name appears another persistent class of object (implementing OrmUjo). As a relational column will be automatically used the primary key of a relational table.</span></li><li class="c0 c2"><span>explicit mapping: used if the referenced column is not the primary key. In this case, you can use a &#39;RelationToOne&#39; class that lets you put relational column with a second parameter in the following format:</span></li></ol><p class="c0 c43"><span>ordProperty = RelationToOne.newInstance (Order.class, </span><span class="c8">Order.sid)</span></p><p class="c0 c9"><span>I recommend referenced column mark with a unique </span><span class="c8">index</span><span>&nbsp;for fast searching and data integrity, some databases require an index explicitly.</span></p><p class="c0"><span class="c8 c27">Mapping of session 1:M</span></p><p class="c0 c9"><span>This type of mapping offers (in way of writing code), easy access to the database query results. Any other value invoking generates a new database query. This type of property doesn&#39;t affect the creation or modification of database structure. Example of use:</span></p><p class="c0 c5 c43"><span></span></p><p class="c0 c43"><span>items = newRelation (Item.class)</span></p><p class="c0"><span class="c8 c27">Mapping of session 1:1</span></p><p class="c0 c9"><span>From the perspective of a solution this is a special case of session M: 1, where degree number M can be limited by appropriate unique index. An alternative solution can be using a relational table as primary key (see example below).</span></p><p class="c0"><span class="c8 c27">Mapping of relation M:N</span></p><p class="c21 c23 c9"><span>The binding is implemented using two relations M:1 &amp; 1:N, which are mapped on the other (relation) table.</span></p><p class="c21 c5 c23"><span></span></p><h2 class="c21"><a name="h.f52f9a1ffe92"></a><span>Lazy loading</span></h2><p class="c0"><span>Late loading of objects is a process that generally allows more efficient transfer of data between the database and the client. Late loading is implemented for each attribute that contains other entity, which is, in the database model, mapped by a foreign key.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>In late loading of an object Ujorm starts new database query that uses a database connection stored in </span><span class="c8">opened session.</span><span>&nbsp;However, because the entity </span><span class="c8">can&#39;t </span><span>open the closed session is itself, so LazyLoading on closed session shows a run-time exception:</span></p><p class="c0 c9"><span>new IllegalStateException (&quot;The session is closed&quot;)</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>Such exemption can be avoided by choosing a suitable solution:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>before invoking lazy to assign a open session to object:</span></li></ol><p class="c0 c43"><span>OrmUjo.writeSession(session)</span></p><ol class="c6" start="1"><li class="c0 c2"><span>before invoking lazy to update the attributes of an object from database:</span></li></ol><p class="c0 c43"><span>Session.reload (ujo)</span></p><ol class="c6" start="1"><li class="c0 c2"><span>load the required lazy property right after obtaining the object using method according to the model:</span></li></ol><p class="c0 c43"><span>item.getOrder();</span></p><ol class="c6" start="1"><li class="c0 c2"><span>retrieve all the lazy property to the desired depth by method:</span></li></ol><p class="c0 c43"><span>OrmTools.loadLazyValuesAsBatch(...)</span></p><ol class="c6" start="1"><li class="c0 c2"><span>sometimes it is not necessary to load the entire entity, just a </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/ForeignKey.html">foreign key</a></span><span>, for which there is no need to have an opened session. This key can be obtained by command:</span></li></ol><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrmTable.readFK (property)</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>Note: Ujorm core doesn&#39;t use this method and isn&#39;t included in OrmUjo interface. The method is available in the default implementation of OrmTable.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>Sometimes you need to get lazy attribute(s) with a single SQL query using JOIN for more database query optimization, or to use some specific operators in your database. In this case, you can use:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>user&#39;s query called &quot;Ujorm native query&quot; mapped to a new entity, or</span></li><li class="c0 c2"><span>database VIEW - mapped to the new entity</span></li></ol><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><h2 class="c29"><a name="h.b0f5b8a80c12"></a><span>Session cache</span></h2><p class="c0"><span>Ujorm uses caching objects in session in order to limit duplicate database queries. Cache behavior has a simple rule:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>lifetime of cache has range (SCOPE) of database transactions. After executing a commit / rollback the cache will be released</span></li><li class="c0 c2"><span>in cache would get only objects of foreign key when loading lazy (lazy loading), in other cases the object is always loaded from the database</span></li><li class="c0 c2"><span>while updating the object, cache doesn&#39;t sync and so for elimination of potential conflicts you can empty the cache by </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/Session.html#cacheClear%28%29">clearCache()</a></span></li><li class="c0 c2"><span>cache storage is protected against memory overload, it means that the garbage collector can release part of the cache at any time</span></li></ol><p class="c21 c23 c5"><span></span></p><p class="c21 c23"><span>From cache side: Ujorm doesn&#39;t have exclusive access to the database, the registration will only need to align the allocation of primary keys. With parameter </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/metaModel/MetaParams.html#CACHE_POLICY">CACHE_POLICY</a></span><span>&nbsp;you can disable the cache for whole meta-model or you can disable releasing the cache with the garbage collector.</span></p><p class="c21 c23"><span>To optimize performance rather recommend to keep the cache of</span><span class="c8">&nbsp;logic units</span><span>&nbsp;at the level of application logic (e.g., Articles) than maintaining a cache of database rows.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.dda7591ed9d5"></a><span>DDL support</span></h2><p class="c0"><span>Ujorm can create or update the database schema using DDL commands according its meta-model. Meta-model contains a description of the real database structure, which is built from class names, Key names, their annotations and occasionally from a XML configuration file. Once the meta-model loading (into a memory) is finished, the information is locked so any future modifications aren&#39;t possible. Updating the database is following these rules:</span></p><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c2"><span>updates are carried out according to a meta-model right after its completion in the OrmHandler object</span></li><li class="c0 c2"><span>update is done only for </span><span class="c8">database items:</span></li></ol><ol class="c17" start="1"><li class="c0 c31"><span>new table</span></li><li class="c0 c31"><span>new columns</span></li><li class="c0 c31"><span>new indexes</span></li><li class="c0 c31"><span>db schema is created only on the first update</span></li></ol><ol class="c6" start="3"><li class="c0 c2"><span>item (column, index) created in the database framework is no longer changed, so you will have to be handle migrations on </span><span class="c8">your own</span><span>, for example:</span></li></ol><ol class="c17" start="1"><li class="c0 c31"><span>change the column NULL to NOT NULL (or back)</span></li><li class="c0 c31"><span>change in the index UNIQUE to NON-UNIQUE (or back)</span></li><li class="c0 c31"><span>change the primary key of table, etc.</span></li></ol><ol class="c6" start="4"><li class="c0 c2"><span>database table must contain at least the primary key</span></li><li class="c0 c2"><span>Ujorm ignores non-mapped database objects (tables, columns, indexes)</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span>Parameter </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/metaModel/MetaParams.html#ORM2DLL_POLICY">ORM2DLL_POLICY</a></span><span>&nbsp;can change behavior of update to one of the following </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/ao/Orm2ddlPolicy.html">approaches</a></span><span>:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>update ban</span></li><li class="c0 c2"><span>allow only the first creation of the db model</span></li><li class="c0 c2"><span>allow incremental changes (default)</span></li></ol><p class="c21 c23"><span>General use of Ujorm parameters is described in the </span><span class="c19"><a class="c1" href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/SampleORM.java?view=markup">tutorial</a></span><span>.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c21"><a name="h.c672291e4db1"></a><span>Entity inheritance</span></h2><p class="c0"><span>Ujorm doesn&#39;t support the concept of inheritance in the JPA. The main reason is that implementation of inheritance into the existing Ujorm architecture simply doesn&#39;t fit.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>Easy availability of inheritance in ORM tempting to light-headed use, which can cause performance problems on production data, so I recommend rather avoid the inheritance. However, if required, Ujorm allows </span><span class="c8">to emulate</span><span>&nbsp;inheritance - using design pattern of </span><span class="c8">aggregation and interface</span><span>&nbsp;(interface).</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>&nbsp; In draft of solution the inheritance are used entities:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>User [id, login, password, name]</span></li><li class="c0 c2"><span>Customer [user, company, discount]</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span>The proposed solution is based on IUser interface, that implements User and Customer objects. Both entities, User and Customer, shares the same ID. We can start using the advantages of inheritance, because instance of type </span><span class="c8">ICustomer</span><span>&nbsp;can be written to the data type </span><span class="c8">IUser.</span><span>&nbsp;Descriptions of </span><span class="c8">setters</span><span>&nbsp;have been skipped to simplify the diagram.</span></p><p class="c0 c5"><span></span></p><p class="c0 c16"><img height="238" src="images/image04.png" width="335"></p><p class="c0 c5"><span></span></p><p class="c0"><span>Notice that the &#39;Customer&#39; has a </span><span class="c8">primary key</span><span>&nbsp;of </span><span class="c8">User </span><span>type and shares the same ID value:</span></p><p class="c0 c9 c5"><span></span></p><a href="#" name="3ad56f0cd50617aa0e6a91beb05313944a3420b4"></a><a href="#" name="19"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c52"><p class="c0"><span class="c13">public class Customer extends OrmTable&lt;Employee&gt; implements IUser {</span></p><p class="c0 c9"><span class="c13">@Column(</span><span class="c13 c8">pk=true</span><span class="c13">, value</span><span class="c13 c8">=</span><span class="c13 c18 c8">&quot;</span><span class="c13 c18">id&quot;</span><span class="c13">)</span></p><p class="c0 c9"><span class="c13">public static final Key&lt;Customer, User&gt; </span><span class="c13 c8">user</span></p><p class="c0 c72"><span class="c13">= newKey();</span></p><p class="c0 c9"><span class="c13">...</span></p><p class="c0"><span class="c13">}</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span>Implementation of the method </span><span class="c8">Customer.getLogin()</span><span>&nbsp;might look like this:</span></p><p class="c0 c5"><span></span></p><a href="#" name="233be75f466d8dd591b7ed65d24370002bee4e91"></a><a href="#" name="20"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c36"><p class="c0"><span class="c13">@Override</span></p><p class="c0"><span class="c13">public String getLogin() {</span></p><p class="c0 c9"><span class="c13">return get(user).getLogin();</span></p><p class="c0"><span class="c13">}</span></p></td></tr></tbody></table><p class="c0 c9 c5"><span class="c13"></span></p><p class="c0 c5 c43"><span class="c13"></span></p><p class="c0"><span>In operations such as INSERT and UPDATE, we have to take care of each entity separately. See the example of coding to save the &#39;Customer&#39;:</span></p><p class="c0 c5"><span></span></p><a href="#" name="798b81dfc12b61394d7d221b864ade8aa49363e0"></a><a href="#" name="21"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c70"><p class="c0"><span class="c13">&nbsp;Session session = handler.getSession();</span></p><p class="c0"><span class="c13">&nbsp;session.save(customer);&nbsp;&nbsp; // Save the parent User object too</span></p><p class="c0"><span class="c13">&nbsp;session.commit();</span></p><p class="c0"><span class="c13">&nbsp;...</span></p><p class="c0"><span class="c13">&nbsp;session.update(customer); // Update the parent User too</span></p><p class="c0"><span class="c13">&nbsp;session.commit();</span></p><p class="c0"><span class="c13">&nbsp;...</span></p><p class="c0"><span class="c13">&nbsp;session.delete(customer); // Delete the parent User too</span></p><p class="c0"><span class="c13">&nbsp;session.commit();</span></p></td></tr></tbody></table><p class="c21 c23 c5"><span class="c13"></span></p><p class="c21 c23"><span>Example of a full implementing the inheritance of the &#39;Customer&#39; class can be found </span><span class="c19"><a class="c1" href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/inheritance/src/main/java/org/bo/Customer.java?view=markup">here</a></span><span>&nbsp;and its use </span><span class="c19"><a class="c1" href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/inheritance/src/main/java/org/SampleOfInheritance.java?view=markup">here</a></span><span>. For more information see the parametr </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/metaModel/MetaParams.html#INHERITANCE_MODE">INHERITANCE_MODE</a></span><span>.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c21"><a name="h.e795e614c8d5"></a><span>Primary key auto increment</span></h2><p class="c0"><span>Ujorm supports automatic generation of primary key using </span><span class="c8">UjoSequencer </span><span>class. The solution was influenced primarily by requirements for high </span><span class="c8">reliability</span><span>&nbsp;and smooth </span><span class="c8">portability </span><span>of implementation between database of different providers. Allocation of primary keys is following these rules:</span></p><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c2"><span>Primary key (PK) will be assigned automatically only if the value of &#39;Key&#39; is NULL. It is possible to assign own values of PK without changing any configuration.</span></li><li class="c0 c2"><span>Each table has its own set of primary keys, about which take care its own instance of the&nbsp; UjoSequencer class. Class UjoSequencer contains primary key values in an auxiliary database table </span><span class="c8">ujorm_pk_support,</span><span>&nbsp;here is a description of columns:</span></li></ol><ol class="c17" start="1"><li class="c0 c31"><span class="c8">id</span><span>&nbsp;(db type VARCHAR) - table name including schema format</span></li><li class="c0 c31"><span class="c8">seq</span><span>&nbsp;- the value last assigned sequence</span></li><li class="c0 c31"><span class="c8">cache</span><span>&nbsp;- UjoSequencer can allocate a number of consecutive numbers, which then allocates from memory to increase performance. Enabled cache may cause:</span></li></ol><ol class="c58" start="1"><li class="c0 c56"><span>discontinuous series of keys in case of restart Ujorm</span></li><li class="c0 c56"><span>violation of time sequence in the case of multiple Ujorm clients</span></li></ol><p class="c0 c43"><span>This behavior can be eliminated by disabling the cache using value 1. Value of cache can be modified correctly also in application program (SQL command).</span></p><ol class="c17" start="1"><li class="c0 c31"><span class="c8">maxvalue</span><span>&nbsp;- if a column &#39;seq&#39; exceeds the maximum value, Ujorm shows an exception</span></li></ol><ol class="c6" start="1"><li class="c0 c2"><span>allocating the primary key of Ujorm is used independent DB connection, so that any rollback of transaction wouldn&#39;t cause the return already assigned primary keys</span></li></ol><p class="c21 c23 c5"><span></span></p><p class="c21 c23"><span>How does the default class </span><span class="c8">UjoSequence</span><span>? Sequence numbers are taken from the database table column </span><span class="c8">ujorm_pk_support.seq</span><span>. Ujorm have also booked a series of numbers in advance, not to have ID for each reaching back to the DB, the buffer size is governed by the cache column. The </span><span class="c8">seq</span><span>&nbsp;column is always the last number of the allocated range. Column </span><span class="c8">maxvalue</span><span>&nbsp;can limit the maximum number of assigned sequence, in case the next number overcomes the limit so the class UjoSequencer&nbsp;throws exception. If </span><span class="c8">maxvalue </span><span>have got zero, so the limit is not checked.</span></p><p class="c21 c23"><span>A common question is how to use native support of database sequence? The solution lies in creating own implementation (child) of </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/UjoSequencer.html">UjoSequencer</a></span><span>&nbsp;class. Class of this child must be registered in the parameters Ujorm before creating a meta-model. The only requirement of solution is that the acquisition of a new primary key (e.g. using JDBC) must be completed before INSERT command. Removing this condition is in the development plan of Ujorm.</span></p><p class="c21 c23"><span>There is possible to suppress the formation table &#39;ujorm_pk_support&#39; by the overriding the method UjoSequencer.isSequenceTableRequired() in case a different implementation of the ID generator is used.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.7b8bdc481ed0"></a><span>Database procedures</span></h2><p class="c0"><span>Ujorm supports since version 0.94 invoking database stored </span><span class="c8">procedures</span><span>&nbsp;and </span><span class="c8">functions&nbsp;</span><span>(furthermore just a procedure). Each procedure is described by class extending an abstract DbProcedure class, which implements the Ujo. Important is an order of Keys in the class, which must match the order of parameters in the procedure. If the procedure </span><span class="c8">have no return type,</span><span>&nbsp;the first constant Key in order will be </span><span class="c8">Void.class </span><span>type</span><span class="c8">.</span><span>&nbsp;The first Key is OUTPUT type, others are INPUT type. The default type of properties you can override by annotation </span><span class="c15">@Parameter (input = true, output = true).</span><span>&nbsp;Database procedures need to be </span><span class="c8">registered</span><span>&nbsp;in the class of databases like the database table:</span></p><p class="c0 c5 c43"><span></span></p><a href="#" name="eb85d86d008e6a8dfe945bc4eaa05bf8e843c5e9"></a><a href="#" name="22"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr><td class="c30"><p class="c0 c9"><span>public static final Property &lt;Database,MyProcedure&gt; procedure = newInstance();</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p><p class="c0"><span>We create an instance of the procedure, fill the INPUT type parameters and invoke with &#39;call&#39; method with parameter of opened session:</span></p><p class="c0 c5 c43"><span></span></p><a href="#" name="d3a128f9bbe94c2bce68d460f6e7bbda650cc92a"></a><a href="#" name="23"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c30"><p class="c0 c9"><span>MyProcedure procedure = new MyProcedure().</span></p><p class="c0 c9"><span>procedure.set (MyProcedure.DATE, new Date ());</span></p><p class="c0 c9"><span>String result = procedure.call (session);</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p><p class="c21 c23"><span>Complete example you can find in </span><span class="c19"><a class="c1" href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/SampleORM.java?view=markup">tutorial</a></span><span>. Instances of the procedure isn&#39;t connected with a particular session and such instance can be used can frequently with different parameters (only one-thread access). Ujorm version 1.00 does not support the return type of parameter ResultSet.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c21"><a name="h.fa936dd12adb"></a><span>Connection to database</span></h2><p class="c0"><span>How to configure a database connection for Ujorm? You can use parameters for the direct database configuration or use some JNDI service (from an application server for example). If the JNDI parameter have got no empty text then other direct database parameters will be ignored. The JNDI solution is preffered in a production environment.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>There are three basic ways how to configure the database connection:</span></p><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c2"><span>Use the annotation </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/annot/Db.html">@Db</a></span><span>&nbsp;on the class where are database table configured. See the </span><span class="c19"><a class="c1" href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/Database.java?view=markup">sample</a></span><span>&nbsp;of use for more information. This is very quick and type safe solution.</span></li><li class="c0 c2"><span>Overwrite the configuration annotations by XML configuration file. The full final content of the file is logged in the time of start you application. Simple example for the MySQL dialect follows:</span></li></ol><a href="#" name="726a02fa8ca34f9af41c9a355b137da572cb7f42"></a><a href="#" name="24"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr><td class="c63"><p class="c0 c5"><span></span></p></td><td class="c74"><p class="c0 c5 c34"><span class="c7"></span></p><a href="#" name="1941f815fe0d450a0d2ba786cd1282638b5da8df"></a><a href="#" name="25"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr><td class="c67"><p class="c0"><span class="c7">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></p><p class="c0"><span class="c7">&lt;body&gt;</span></p><p class="c0"><span class="c7">&nbsp;&nbsp;&nbsp; &lt;database id=&quot;DatabaseConfigurationClass&quot;&gt;</span></p><p class="c0"><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;schema&gt;TestDBSchema&lt;/schema&gt;</span></p><p class="c0"><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;user&gt;applicationUser&lt;/user&gt;</span></p><p class="c0"><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;password&gt;userPassword&lt;/password&gt;</span></p><p class="c0"><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dialect&gt;org.ujorm.orm.dialect.MySqlDialect&lt;/dialect&gt;</span></p><p class="c0"><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;jdbcUrl&gt;jdbc:mysql://127.0.0.1:3306/&lt;/jdbcUrl&gt;</span></p><p class="c0"><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;jdbcDriver&gt;com.mysql.jdbc.Driver&lt;/jdbcDriver&gt;</span></p><p class="c0"><span class="c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;jndi&gt;&lt;/jndi&gt;</span></p><p class="c0"><span class="c7">&nbsp;&nbsp;&nbsp; &lt;/database&gt;</span></p><p class="c0"><span class="c7">&lt;/body&gt;</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p></td></tr></tbody></table><p class="c0 c59"><span>Where:</span></p><ol class="c6" start="1"><li class="c0 c46"><span class="c8">database </span><span>id - is the the name of a configuration Class from you application&nbsp; without package</span></li><li class="c0 c46"><span class="c8">schema </span><span>- default database schema (can be empty), however each table can have got your own schema. Table schema can be modified in the XML by a table configuration tags.</span></li><li class="c0 c46"><span class="c8">user </span><span>- the application database user</span></li><li class="c0 c46"><span class="c8">password </span><span>- is a password for the user</span></li><li class="c0 c46"><span class="c8">dialect </span><span>- use one dialect from or your own</span></li><li class="c0 c46"><span class="c8">jdbcUrl </span><span>- JDBC URL</span></li><li class="c0 c46"><span class="c8">jdbcDriver </span><span>- JDBC Driver</span></li><li class="c0 c46"><span class="c8">jndi </span><span>- no empty JNDI string have got an more strong priority than any previous parameters. Some more information can be found in the </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/annot/Db.html#jndi%28%29">JavaDoc</a></span><span>&nbsp;.</span></li></ol><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c2"><span>Create a special child of the SqlDialect class and overwrite a special method for creating the database connection: </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/SqlDialect.html#createConnection%28org.ujorm.orm.metaModel.MetaDatabase%29">SqlDialect.createConnection()</a></span><span>. The method can implement any special implementation by your idea.</span></li></ol><p class="c21 c23 c5"><span></span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29 c37"><a name="h.b24a52ae4cf8"></a><span>Batch database operations</span></h2><p class="c21 c37"><span>For a better performance is useful to use so called &#39;batch operation&#39;. The common feature is that many rows is affected by a single SQL statement. There are supported next cases of the typical use.</span></p><h3 class="c29 c41"><a name="h.fd8iy4h5f88u"></a><span>Batch insert</span></h3><p class="c0 c9"><span>Most of databases supports special SQL statement for Multi Row Insert. The statement can import many database rows by a single SQL statement. If database doesn&#39;t supports the feature, so all rows will be inserted by many plain SQL INSERT statements. See next sample of use:</span></p><p class="c0 c9 c5"><span></span></p><p class="c0 c9 c5"><span></span></p><a href="#" name="a9689329864c972af853e69912b33c5c0da49049"></a><a href="#" name="26"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c44"><p class="c0"><span>&nbsp; List&lt;Item&gt; itemList = createOrderItems();</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>&nbsp; session.</span><span class="c8">save</span><span>(itemList);</span></p><p class="c0"><span>&nbsp; session.commit();</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p><p class="c21 c9 c37"><span>Warning: the batch insert affect to parent objects (if any) using a plain INSERT statement only.</span></p><h3 class="c29 c41"><a name="h.5t2xecc4a6fc"></a><span>Batch update</span></h3><p class="c0 c9"><span>Ujorm can modify a table column(s) to any CONSTANT by single SQL statement. The example updates one database column (created) to the current date for all Orders where id&gt;=1 .</span></p><p class="c0 c5"><span></span></p><p class="c0 c9 c5"><span></span></p><a href="#" name="540d43e2b30d5b7402a0cd7348e4cf9fdef9ab3a"></a><a href="#" name="27"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c44"><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Order order = new Order();</span></p><p class="c0 c5"><span></span></p><p class="c0"><span class="c26">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Activate the Change column management:</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; order.writeSession(session);</span></p><p class="c0 c5"><span></span></p><p class="c0"><span class="c26">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Set a value(s) to the change:</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; order.setCreated(new </span><span class="c8">Date</span><span>());</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Criterion&lt;Order&gt; criterion&nbsp; = Criterion.where(Order.id, GE, 1L);</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; session.</span><span class="c8">update</span><span>(order, criterion);</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; session.commit();</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p><p class="c21 c37 c9"><span>Warning: batch update does affect to parent objects (if any). Modification to an expression is not supported in the current version of Ujorm.</span></p><h3 class="c29 c41"><a name="h.kzh8jc8xqn1g"></a><span>Batch delete</span></h3><p class="c0 c9"><span>The next example deletes all Items where Item.id &lt; 10. See more information in JavaDoc.</span></p><p class="c0 c9 c5"><span></span></p><a href="#" name="9147a138c20b32bc47fa77f3d34a676ba7273167"></a><a href="#" name="28"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c44"><p class="c0"><span>&nbsp;&nbsp;&nbsp; Criterion&lt;Item&gt; crit = Criterion.where(Item.id, LT, </span><span class="c8">10</span><span>L);</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; int count = session.delete(crit);</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; session.commit();</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp; System.out.println(</span><span class="c75">&quot;There are DELETED rows: &quot; </span><span>+ count);</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p><p class="c0 c9"><span>Warning: batch delete does affect to parent objects (if any).</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c21"><a name="h.286935a745d0"></a><span>Transaction control</span></h2><p class="c0"><span>All database DML statements can be seen as temporary until they are committed. Ujorm supports commitment with the Ujorm Session.commit() . Method Session.rollback() is used to remove operations performed since the previous commit or rollback. Use this method when an exception occurs or when the program detects some error condition or error in the data.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>For a parallel transaction use a next session.</span></p><p class="c0"><span>See a JDBC 2.0 documentation for more information.</span></p><p class="c0 c5"><span></span></p><h3 class="c29 c41 c60"><a name="h.ls18qrfpiyn8"></a><span>Nested transaction</span></h3><p class="c39 c29 c42"><span>Nested transactions are supported since the Ujorm 1.23 running on JDBC driver 3.0. You can use two ways to manage transactions:</span></p><p class="c0 c9 c5"><span></span></p><a href="#" name="64d3f043b45f3f710f3f1bb5a873ddcfaf777036"></a><a href="#" name="29"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c44"><p class="c0 c12"><span>Session session = getDefaultSession();</span></p><p class="c0 c12"><span class="c8 c14">try</span><span>&nbsp;{</span></p><p class="c0 c12"><span>&nbsp; &nbsp;session.beginTransaction();</span></p><p class="c0 c12"><span>&nbsp; &nbsp;session.save(newObject()), // some CRUD operations</span></p><p class="c0 c12"><span class="c26">&nbsp; &nbsp;doInnerTrasaction(...);</span></p><p class="c0 c12"><span>&nbsp; &nbsp;session.commitTransaction();</span></p><p class="c0 c12"><span class="c14 c8">catch </span><span>{Exception e) {</span></p><p class="c0 c12"><span>&nbsp; &nbsp;session.rollbackTransaction();</span></p><p class="c0 c12"><span>}</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p><p class="c0"><span>The Ujorm have got partially implemented the </span><span class="c20"><a class="c1" href="http://en.wikipedia.org/wiki/Java_Transaction_API">JTA</a></span><span>, so you can use the next code for the same behaviour too:</span></p><p class="c0 c9 c5"><span></span></p><a href="#" name="6baf5ae1173a0d3f232706f7f35907ab330f591e"></a><a href="#" name="30"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c44"><p class="c0 c12"><span>Session session = getDefaultSession();</span></p><p class="c0 c12"><span>Transaction transaction = </span><span class="c8 c47">null</span><span>;</span></p><p class="c0 c12"><span class="c14 c8">try</span><span>&nbsp;{</span></p><p class="c0 c12"><span>&nbsp; &nbsp;transaction = session.beginTransaction();</span></p><p class="c0 c12"><span>&nbsp; &nbsp;session.save(newObject()); &nbsp;// some CRUD operations</span></p><p class="c0 c12"><span class="c26">&nbsp; &nbsp;doInnerTrasaction(...);</span></p><p class="c0 c12"><span>&nbsp; &nbsp;transaction.commit();</span></p><p class="c0 c12"><span class="c14 c8">catch </span><span>{Exception e) {</span></p><p class="c0 c12"><span>&nbsp; &nbsp;transaction.rollback();</span></p><p class="c0 c12"><span>}</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p><p class="c0"><span>Note: the method Session.</span><span class="c8">commit</span><span>() make a commit for all (nested) transactions similarly like the method Session.</span><span class="c8">rollback</span><span>() make the rollback for all transactions.</span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><h2 class="c21"><a name="h.dahj244afoo5"></a><span>Logging support</span></h2><p class="c0"><span>The Ujorm have got a native support for the both logging tools</span></p><ol class="c6" start="1"><li class="c0 c45"><span class="c8">org.slf4j.Logger</span><span>&nbsp;from </span><span class="c49"><a class="c1" href="http://www.slf4j.org/">SLF4J framework</a></span><span>&nbsp;or the</span></li><li class="c0 c45"><span class="c8">java.util.loggingl.Logger</span><span>&nbsp;from the JRE 5.0+</span></li></ol><p class="c21 c23 c5"><span></span></p><p class="c21 c23"><span>On the first request to log a message from the Ujorm framework is processed:</span></p><ol class="c6" start="1"><li class="c10 c38 c23"><span>the Ujorm try to load a class org.slf4j.Logger</span></li><li class="c10 c23 c38"><span>if the class is loaded succesfully and the action does not throw an other exception, than an internal flag i switched to the SLF4J logger support</span></li><li class="c10 c38 c23"><span>if the class is not found or any else exception is throwed, than the Ujorm is switched to a native JRE logger.</span></li></ol><p class="c21 c23"><span>Of course, you can use any other logging systems based on the interface org.slf4j.Logger as the </span><span class="c49"><a class="c1" href="http://logback.qos.ch/">LogBack</a></span><span>&nbsp;for example. There is need to customize your project along the logging framework&rsquo;s documentation.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c21"><a name="h.87af2d291d2c"></a><span>Multi-thread environment</span></h2><p class="c0"><span>The </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/implementation/orm/OrmTable.html">OrmTable</a></span><span>&nbsp;UJO class is not ready to use in multi-thread environment by default implementation. You can eliminate some risks probably using a read-only mode and loading all needed lazy properties before you share the object to more threads. However for the case is prepared a specilal implementation called </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/implementation/orm/OrmTableSynchronized.html">OrmTableSynchronized</a></span><span>&nbsp;with the next features:</span></p><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c2"><span>there are synchonized methods </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/Ujo.html#readValue%28org.ujorm.UjoProperty%29">Ujo.readValue(Property)</a></span><span>&nbsp;and</span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/Ujo.html#writeValue%28org.ujorm.UjoProperty,%20java.lang.Object%29">Ujo.writeValue(Property, Object)</a></span><span>&nbsp; and some more strategy methods</span></li><li class="c0 c2"><span>there is used a special object </span><span class="c8">ThreadLocal&lt;Session&gt;</span><span>&nbsp;to store the private object Session</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span>The data lazy loading in a new thread needs to assign a new (open) Session instance always. The great news are that an incorrect lazy property loading throws the IllegalStateException instead of a dead-lock risk.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c21"><a name="h.2dc8b03b0862"></a><span>API extension</span></h2><p class="c0"><span>In development, after time we can meet the requirement of implementation of specific function or features of SQL language. For this type of requirement can be created &quot;own child&quot; of </span><span class="c19 c8"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/SqlDialect.html">SqlDialect</a></span><span>&nbsp;class (or some of its implementation), because this class provides several important activities:</span></p><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c2"><span>creates a specific SQL queries for different CRUD type databases</span></li><li class="c0 c2"><span>defines the syntax of each type of operator in the WHERE phrase</span></li><li class="c0 c2"><span>creates DDL commands according to a meta-model</span></li><li class="c0 c2"><span>provides DB connection (or other parameters for DB connection)</span></li><li class="c0 c2"><span>provides a list of SQL keywords</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span>Any of the attributes above can be easily modified by creating a &#39;child&#39;, new class is registered by annotation in the Database class type. Overlapping the SqlDialect class can solve one of the following requirements:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>expansion and optimization of SQL queries</span></li><li class="c0 c2"><span>mapping of specific data type of SQL language</span></li><li class="c0 c2"><span>completion of own operators for Criterion class has two steps:</span></li></ol><ol class="c66" start="1"><li class="c0 c31"><span>create a child of </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/criterion/ValueCriterion.html">ValueCriterion</a></span><span>&nbsp;class, extended with specification of a custom type</span></li><li class="c0 c31"><span>overlay method </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/SqlDialect.html#getCriterionTemplate%28org.ujorm.criterion.ValueCriterion%29">SqlDialect.getCriterionTemplate ()</a></span><span>&nbsp;implementing the extended operator</span></li></ol><ol class="c6" start="4"><li class="c0 c2"><span>creating own DB connection or a its modification (adding parameters)</span></li><li class="c0 c2"><span>add or remove a reserved SQL keywords</span></li></ol><p class="c21 c23 c5"><span></span></p><p class="c21 c23"><span class="c8">TypeService</span></p><p class="c21 c23"><span>class provides a mapping of application values to the JDBC API. Methods of class can be overridden with your own implementations. Registration is done by annotation in the &#39;Database&#39; type class.</span></p><p class="c21 c23"><span class="c8">UjoSequencer</span></p><p class="c21 c23"><span>As stated earlier, this class allows the implementation of your own algorithm for assigning a unique ID to INSERT command. Registration is done by annotation in the &#39;Database&#39; type class.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.5902a957f5ab"></a><span>Meta-Model</span></h2><p class="c0"><span>Meta-model is created according to the content of Ujo properties of Database class and its tables. The names of tables, view and procedure are derived from names of Ujo property. Most features of the model can be overridden by annotations placed directly in property or in name of the class. Features set by annotation can be also overridden by configuration XML file, which can optionally modify only selection of a meta-model.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>After creating a meta-model in memory, the model is locked and you can&#39;t write into meta-model anymore, at run-time, however, you can obtain useful information from it. Slightly simplified class diagram meta is in the following picture:</span></p><p class="c0 c16 c5"><span></span></p><p class="c0 c16"><img height="452" src="images/image00.png" width="431"></p><p class="c0 c5"><span></span></p><p class="c0"><span class="c8">Entity Description:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>OrmHandler is a class providing meta-model, in the application is recommended to keep only one instance of this class. Class offers several methods to provide selected parts of meta-model. OrmHandler is the only entity in the diagram, which isn&#39;t a child of an abstract AbstractMetaModel class (implementing the interface of Ujo).</span></li><li class="c0 c2"><span>MetaRoot creates the base of meta-model and allows you to read an XML configuration file</span></li><li class="c0 c2"><span>MetaParams contains general Ujorm parameters that can be also modify by the XML configuration file</span></li><li class="c0 c2"><span>MetaDatabase contains a database connection, a list of tables (or views) and the list of database procedures. It also includes a default schema.</span></li><li class="c0 c2"><span>MetaTable represents the database table that takes the schema from &#39;MetaDatabase&#39;, but you can configure (with annotations) also a different scheme. Logical attribute &#39;view&#39; differs view from the tables (you can&#39;t white into &#39;view&#39; and it doesn&#39;t affect the updating of the DB).</span></li><li class="c0 c2"><span>MetaPKey - each table contains one primary key</span></li><li class="c0 c2"><span>MetaRelation2Many - represents a 1: M type database session</span></li><li class="c0 c2"><span>MetaColumn - class represents the database column, or stored procedure parameters.</span></li></ol><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.529d45f07307"></a><span>Performance</span></h2><p class="c0"><span>Ujorm is very fast in comparison to its competitors, see the benchmark table to detail information. I hope that you will not be angry if I compare Ujorm performance with the popular Hibernate ORM framework. The result of the benchmark is listed in the next table. Each action represents a type of database operation with </span><span class="c8">no optimization</span><span>, all tests are performed by default Java parameters.</span></p><p class="c0 c5"><span></span></p><a href="#" name="cdf7ff561630131ec1701c309d33ea03b166d30a"></a><a href="#" name="31"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c22"><p class="c0"><span class="c33 c8">Action</span><span>&nbsp;</span><span class="c33 c8">on</span></p><p class="c0"><span class="c33 c8">PostgreSQL</span></p></td><td class="c22"><p class="c0 c16"><span class="c33 c8">Ujorm 1.00</span></p><p class="c0 c16"><span class="c33">[sec]</span></p></td><td class="c22"><p class="c0 c16"><span class="c33 c8">Hibernate 3.3.1</span></p><p class="c0 c16"><span class="c33">[sec]</span></p></td><td class="c22"><p class="c0 c11"><span class="c33 c8">Ratio</span><span>&nbsp;</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">meta data</span></p></td><td class="c22"><p class="c0 c11"><span>0.33</span></p></td><td class="c22"><p class="c0 c11"><span>1.53</span></p></td><td class="c22"><p class="c0 c11"><span>4.65</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">single select</span></p></td><td class="c22"><p class="c0 c11"><span>0.35</span></p></td><td class="c22"><p class="c0 c11"><span>0.58</span></p></td><td class="c22"><p class="c0 c11"><span>1.67</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">multi select</span></p></td><td class="c22"><p class="c0 c11"><span>21.78</span></p></td><td class="c22"><p class="c0 c11"><span>168.01</span></p></td><td class="c22"><p class="c0 c11"><span>7.71</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">empty select</span></p></td><td class="c22"><p class="c0 c11"><span>1.24</span></p></td><td class="c22"><p class="c0 c11"><span>151.17</span></p></td><td class="c22"><p class="c0 c11"><span class="c8 c25">121.85</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">insert</span></p></td><td class="c22"><p class="c0 c11"><span>11.12</span></p></td><td class="c22"><p class="c0 c11"><span>12.30</span></p></td><td class="c22"><p class="c0 c11"><span>1.11</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">delete</span></p></td><td class="c22"><p class="c0 c11"><span>101.18</span></p></td><td class="c22"><p class="c0 c11"><span>208.28</span></p></td><td class="c22"><p class="c0 c11"><span>2.06</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">update</span></p></td><td class="c22"><p class="c0 c11"><span>8.04</span></p></td><td class="c22"><p class="c0 c11"><span>3.90</span></p></td><td class="c22"><p class="c0 c11"><span>0.49</span></p></td></tr></tbody></table><p class="c0"><span>&nbsp;</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>Action description:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>meta data - time to loading meta-model and to verify database model (auto-update option is enabled)</span></li><li class="c0 c2"><span>single select - the one big select for all order items (with a condition)</span></li><li class="c0 c2"><span>multi select - many different selects to emulate a server application or statements with no optimization</span></li><li class="c0 c2"><span>empty selects - 2000 selects with the empty result - where a condition contains different parameter values</span></li><li class="c0 c2"><span>insert - insert 2000 orders, 14000 items and 1 user</span></li><li class="c0 c2"><span>delete - execution many statements to delete all table rows</span></li><li class="c0 c2"><span>update - modify and save a loaded BO</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span>Environment description:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>date of performance: 2010-10-15</span></li><li class="c0 c2"><span>test through the 2000 orders and 14,000 items</span></li><li class="c0 c2"><span>against the database PostgreSQL 8.3 (on the same computer)</span></li><li class="c0 c2"><span>values are an average of 5 measurements</span></li><li class="c0 c2"><span>DB indexes was insignificant</span></li><li class="c0 c2"><span>Ujorm release 1.00</span></li><li class="c0 c2"><span>Hibernate 3.3.1.GA + EhCacheProvider</span></li><li class="c0 c2"><span>Java version &quot;1.6.0_14&quot; running with default run-time parameters</span></li><li class="c0 c2"><span>Intel Dual Core, 2GB RAM</span></li><li class="c0 c2"><span>Windows XP + SP3</span></li><li class="c0 c2"><span>benchmark code is available on the SourceForge</span></li></ol><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0"><span class="c8">The similar test </span><span>I have finished on the </span><span class="c19"><a class="c1" href="http://www.h2database.com/html/main.html">database H2</a></span><span>&nbsp;(release 1.2.147) running in-memory mode. The test was performed on 2011-01-29 on the release Ujorm 1.10:</span></p><p class="c0 c5"><span></span></p><a href="#" name="e6ad4693b6d882d85316ec7beaed1c1b1e71157d"></a><a href="#" name="32"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c22"><p class="c0"><span class="c33 c8">Action</span><span>&nbsp;</span><span class="c33 c8">on</span></p><p class="c0"><span class="c33 c8">H2 in-memory</span></p></td><td class="c22"><p class="c0 c16"><span class="c33 c8">Ujorm 1.10</span></p><p class="c0 c16"><span class="c33">[sec]</span></p></td><td class="c22"><p class="c0 c16"><span class="c33 c8">Hibernate 3.3.1</span></p><p class="c0 c16"><span class="c33">[sec]</span></p></td><td class="c22"><p class="c0 c11"><span class="c33 c8">Ratio</span><span>&nbsp;</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">meta data</span></p></td><td class="c22"><p class="c0 c11"><span>0.42</span></p></td><td class="c22"><p class="c0 c11"><span>1.26</span></p></td><td class="c22"><p class="c0 c11"><span>3.0</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">single select</span></p></td><td class="c22"><p class="c0 c11"><span>0.19</span></p></td><td class="c22"><p class="c0 c11"><span>0.53</span></p></td><td class="c22"><p class="c0 c11"><span>2.9</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">multi select</span></p></td><td class="c22"><p class="c0 c11"><span>0.69</span></p></td><td class="c22"><p class="c0 c11"><span>155.28</span></p></td><td class="c22"><p class="c0 c11"><span class="c8 c25">225.9</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">empty select</span></p></td><td class="c22"><p class="c0 c11"><span>0.36</span></p></td><td class="c22"><p class="c0 c11"><span>155.37</span></p></td><td class="c22"><p class="c0 c11"><span class="c8 c25">432.1</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">insert</span></p></td><td class="c22"><p class="c0 c11"><span>1.62</span></p></td><td class="c22"><p class="c0 c11"><span>2.43</span></p></td><td class="c22"><p class="c0 c11"><span>1.5</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">delete</span></p></td><td class="c22"><p class="c0 c11"><span>0.37</span></p></td><td class="c22"><p class="c0 c11"><span>151.43</span></p></td><td class="c22"><p class="c0 c11"><span class="c8 c25">407.3</span></p></td></tr><tr class="c4"><td class="c22"><p class="c0"><span class="c8">update</span></p></td><td class="c22"><p class="c0 c11"><span>1.28</span></p></td><td class="c22"><p class="c0 c11"><span>1.13</span></p></td><td class="c22"><p class="c0 c11"><span>0.9</span></p></td></tr></tbody></table><p class="c21 c23"><span>&nbsp;</span></p><p class="c21 c23"><span class="c8">Note:</span></p><p class="c21 c23"><span>The </span><span class="c8">Hibernate</span><span>&nbsp;framework provides many parameters for optimization, however some of them can bring some limitations. For example a Hibernate transaction can be set to </span><span class="c8">read-only</span><span>&nbsp;in the case of the exclusive SELECT(s) to better performance. The </span><span class="c8">Ujorm </span><span>have got &nbsp;a great performance on default settings so it will save&nbsp;a lot of &nbsp;development time.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.6c32e8b75e6e"></a><span>Supported databases</span></h2><p class="c0"><span>Ujorm framework offers prepared dialects for the following databases:</span></p><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c3"><span>PostgreSQL (8.3+)</span></li><li class="c0 c3"><span>MySQL (5.0+)</span></li><li class="c0 c3"><span>Derby (10.5+)</span></li><li class="c0 c3"><span>Oracle (8.0+)</span></li><li class="c0 c3"><span>H2 (1.2.147+)</span></li><li class="c0 c3"><span>HSQLDB (1.8+)</span></li><li class="c0 c3"><span>Firebird (jaybird 2.1.6+)</span></li><li class="c0 c3"><span>MS-SQL on the SQL Server 2008 R2 (JDBC Driver 3.0)</span></li></ol><p class="c21 c23 c5"><span></span></p><p class="c21 c23"><span>As mentioned in the previous chapter, support for other databases can be implemented by overwriting the </span><span class="c19 c8"><a class="c1" href="http://ujorm.com/javadoc/org/ujorm/orm/SqlDialect.html">SqlDialect</a></span><span>&nbsp;class or one of its &#39;child&#39;. The new class has to be registered in application class of the &#39;Database&#39; type.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.55252fa54c31"></a><span>Why Key constants have lowercase letters?</span></h2><p class="c0"><span>In the examples mentioned in this document are the names of the static field of Keys often written in lower case - contrary to normal convention. The reason is to shorten the code when creating Key, but also seems to be useful when small letters more correspond to&nbsp; instance variables (fields). Lowercase letters are proven to be better, but the using the capital letters in your project won&#39;t create a technical problem.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>Full specification of Key can be set explicitly, including a </span><span class="c8">name</span><span>, by this pattern:</span></p><p class="c0 c5"><span></span></p><a href="#" name="183c62d57715433ec4efeadcd617d30f4bddeccf"></a><a href="#" name="33"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr><td class="c30"><p class="c0"><span>&nbsp;</span><span class="c33 c8">public static final</span><span>&nbsp;Property &lt;BO, Long&gt;&nbsp;</span><span class="c13 c8">id</span><span>&nbsp;= newKey</span><span class="c13 c8">(&#39;id&#39;</span><span>);</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p><p class="c0"><span>In short writing is name of &#39;Property&#39; taken from a name of field:</span></p><p class="c0 c5"><span></span></p><a href="#" name="12a979b1bce2f7a5cf7c68f95ced407962c5632f"></a><a href="#" name="34"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr><td class="c30"><p class="c0"><span class="c33 c8">public static final</span><span>&nbsp;Property &lt;BO, Long&gt; </span><span class="c13 c8">id</span><span>&nbsp;= newKey();</span></p></td></tr></tbody></table><p class="c0 c5"><span></span></p><p class="c0"><span>Terms used in Ujorm:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>Key&nbsp;</span><span class="c8">field</span><span>&nbsp;- the name of the static constants of Key in the implementation of Ujo</span></li><li class="c0 c2"><span>Key&nbsp;</span><span class="c8">name</span><span>&nbsp;- a logical indication that returns &#39;Key.getName()&#39; as the String type</span></li></ol><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.51c99f3693d0"></a><span>Using of UJO objects</span></h2><p class="c0"><span>This chapter describes the important features of the UJO object, which have an effect on the correct behavior:</span></p><p class="c0 c5"><span></span></p><ol class="c6" start="1"><li class="c0 c2"><span>each </span><span class="c8">attribute</span><span>&nbsp;</span><span class="c8">of entity</span><span>&nbsp;has its own unique Key instance</span></li><li class="c0 c2"><span>for reading and writing values are used these methods:</span></li></ol><ol class="c17" start="1"><li class="c0 c31"><span>Key.getValue (..)</span></li><li class="c0 c31"><span>Key.setValue (..)</span></li></ol><p class="c0 c9"><span>or other methods that invoke them internally, for example:</span></p><ol class="c17" start="1"><li class="c0 c31"><span>UjoMiddle.get (..)</span></li><li class="c0 c31"><span>UjoMiddle.set (..)</span></li></ol><p class="c0 c9"><span>or more comfortable </span><span class="c8">getters</span><span>&nbsp;and </span><span class="c8">setters,</span><span>&nbsp;that invoke (internally) one of the methods above</span></p><ol class="c6" start="1"><li class="c0 c2"><span>method &#39;Key.getValue()&#39; </span><span class="c8">changes</span><span>&nbsp;values NULL to the default value Key (which is NULL if it isn&#39;t set otherwise). Beware, the method &#39;Ujo.readValue()&#39; doesn&#39;t do any replacement of default values.</span></li><li class="c0 c2"><span>for reading and writing values </span><span class="c8">is not recommended</span><span>&nbsp;to invoke </span><span class="c8">untyped</span><span>&nbsp;methods</span></li></ol><ol class="c17" start="1"><li class="c0 c31"><span>Ujo.readValue ()</span></li><li class="c0 c31"><span>Ujo.writeValue ()</span></li></ol><p class="c0 c9"><span>However, these two methods are suitable for the </span><span class="c8">overriding </span><span>in propose to implement the various conversions, validations and other requirements.</span></p><ol class="c6" start="1"><li class="c0 c2"><span>for the </span><span class="c8">default</span><span>&nbsp;value of &#39;Key&#39; is suitable only an </span><span class="c8">immutable object</span></li><li class="c0 c2"><span>Ujo objects can be generally inherited, inheritance of OrmUjo objects isn&#39;t supported directly</span></li><li class="c0 c2"><span>more information about Ujo Core can be found </span><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/package-summary.html#UJO">here</a></span><span>&nbsp;.</span></li></ol><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.978d5de1fd78"></a><span>Best Practices</span></h2><ol class="c6" start="1"><li class="c0 c2"><span>common ancestor of your domain objects can simplify behavior changes of all children. An example might be a generic implementation of method &#39;toString ()&#39;, or implementation of methods &#39;equals (..)&#39;, &#39;hashCode ()&#39;, etc.</span></li><li class="c0 c2"><span>service for processing data from DB to Query can easily complement other Criterion. An example of use might be implementation of limited access to data based on context (role) of logged user</span></li><li class="c0 c2"><span>for access to the values of UJO objects proved using the methods:</span></li></ol><ol class="c17" start="1"><li class="c0 c31"><span>UjoMiddle.get (property)</span></li><li class="c0 c31"><span>UjoMiddle.set (property, value)</span></li></ol><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.c41270dc0dbb"></a><span>Integrating Spring Framework</span></h2><p class="c0"><span>The Spring Framework can automate the creation and release Ujorm session and manage a transaction management using a special module called &#39;orm-spring&#39;. In a Maven project use the next dependency in your POM file:</span></p><p class="c0 c5"><span></span></p><a href="#" name="aa37c96d0bc9c6004324a070ef2094613c6fa5c0"></a><a href="#" name="35"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c35"><p class="c0"><span class="c15">&nbsp;&nbsp; &lt;dependency&gt;</span></p><p class="c0"><span class="c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;</span><span class="c8 c15">org.ujorm</span><span class="c15">&lt;/groupId&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;</span><span class="c8 c15">ujo-spring</span><span class="c15">&lt;/artifactId&gt;</span></p><p class="c0"><span class="c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;version&gt;</span><span class="c8 c15">1.30</span><span class="c15">&lt;/version&gt;</span></p><p class="c0"><span class="c15">&nbsp;&nbsp; &lt;/dependency&gt;</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c15"></span></p><p class="c0"><span>How to get a Ujorm Session? The procedure for obtaining the session will vary according to the code that calls the session:</span></p><ol class="c6" start="1"><li class="c0 c2"><span>aroundSessionAOP - calls from a job or other internal</span></li><li class="c0 c2"><span>Open Session in View - using HTTP Request</span></li></ol><p class="c0 c5"><span></span></p><p class="c0"><span>AroundSessionAOP is currently defined in the current spring-beans.xml pointcut </span></p><p class="c0 c9"><span class="c13 c15">org.application.administration.jobs ..*(..)</span></p><p class="c0 c5"><span class="c13 c15"></span></p><p class="c0"><span>Open Session in View is defined in the </span><span class="c8">web.xml</span><span>&nbsp;.</span></p><p class="c0 c5"><span></span></p><p class="c0"><span>How to use the session manually?</span></p><a href="#" name="77e8601493f0fe39913d3c75eaf7ec8139ae460f"></a><a href="#" name="36"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c35"><p class="c0"><span class="c13 c32">&nbsp;&nbsp; UjoSessionFactoryFilter ujoSessionFactoryFilter</span></p><p class="c0"><span class="c13 c32">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = (UjoSessionFactoryFilter)wac.getBean(&quot;ujoSessionFactory&quot;);</span></p><p class="c0"><span class="c13 c32">&nbsp;&nbsp; ujoSessionFactoryFilter.openSession();</span></p><p class="c0"><span class="c13 c32">&nbsp;&nbsp; ...</span></p><p class="c0"><span class="c13 c32">&nbsp;&nbsp; ujoSessionFactoryFilter.closeSession();</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13 c32"></span></p><p class="c0"><span>How to use a Manual control session and transaction - using ORM handle?</span></p><a href="#" name="d837a46bfabc82b3e530454f2e684cb1d08f00df"></a><a href="#" name="37"></a><table cellpadding="0" cellspacing="0" class="c24"><tbody><tr class="c4"><td class="c35"><p class="c0"><span>&nbsp;</span><span class="c13">&nbsp; OrmHandler handler = (OrmHandler) wac.getBean(&quot;ormHandler&quot;);</span></p><p class="c0"><span class="c13">&nbsp;&nbsp; Session s = handler.createSession() ;</span></p><p class="c0"><span class="c13">&nbsp;&nbsp; ...</span></p><p class="c0"><span class="c13">&nbsp;&nbsp; s.commit();</span></p><p class="c0"><span class="c13">&nbsp;&nbsp; s.close();</span></p></td></tr></tbody></table><p class="c0 c5"><span class="c13"></span></p><p class="c0"><span>See the official </span><span class="c19"><a class="c1" href="http://www.springsource.org/documentation">Spring documentation</a></span><span>&nbsp;for more information.</span></p><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.304a6c50b9c1"></a><span>More information</span></h2><ol class="c6" start="1"><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/javadoc/org/ujorm/orm/package-summary.html">JavaDoc</a></span><span>&nbsp;the detail API descriptions with some examples of use</span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.com/">Home Page</a></span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/presentation/index.htm#orm">Presentation</a></span><span>&nbsp;(intro slide show), includes</span></li></ol><ol class="c17" start="1"><li class="c0 c31"><span>short motivation</span></li><li class="c0 c31"><span>Key Features</span></li><li class="c0 c31"><span>Compared with competitors (Hibernate iBatis)</span></li></ol><ol class="c6" start="4"><li class="c0 c2"><span>Examples of using </span><span class="c19"><a class="c1" href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/SampleORM.java?view=markup">the source code</a></span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.blogspot.com/">Blog</a></span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/dokuwiki/doku.php">Wiki</a></span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://ujorm.org/dokuwiki/doku.php?id=orm_faq">Frequently asked questions - FAQ</a></span></li><li class="c0 c2"><span class="c19"><a class="c1" href="http://en.wikipedia.org/wiki/Wikipedia_talk:Articles_for_creation/Ujorm">Wikipedia</a></span><span>&nbsp;(declined article: how to get reputable, third-party information sources?)</span></li></ol><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.772ac403cca2"></a><span>References</span></h2><ol class="c6" start="1"><li class="c0 c2"><span>The </span><span class="c19"><a class="c1" href="http://www.effectiva.cz/en/ecall">eCall</a></span><span>&nbsp;is a complete software solution for management of corporate telecommunications - especially for a modern call center. It enables easy organization, management and automated operation of all telecommunications. See Ujorm development </span><span class="c19"><a class="c1" href="http://ujorm.blogspot.com/2010/10/ujorm-development-interview.html">Interview</a></span><span>.</span></li><li class="c0 c2"><span>Do you wish to make reference to your application, built on Ujorm? Send us a link to your project to the email address support@ujorm.com</span></li></ol><p class="c21 c23 c5"><span></span></p><h2 class="c29"><a name="h.cc2d51f7ea2f"></a><span>Acknowledgements</span></h2><p class="c0"><span>Thanks to developer team at </span><span class="c19"><a class="c1" href="http://www.effectiva.cz/">Effectiva Solutions</a></span><span>&nbsp;for their valuable comments on the technical content of this document.</span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p><p class="c0 c5"><span></span></p></body></html>