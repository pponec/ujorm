<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
  <title>Ujorm User Guide - EN</title>
  <style type="text/css">
ol{margin:0;padding:0}p{margin:0}.c26{vertical-align:top;width:347.2pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c20{vertical-align:top;width:468pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c39{vertical-align:top;width:404.2pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c55{vertical-align:top;width:437.2pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c14{vertical-align:top;width:117pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c42{vertical-align:top;width:390.8pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c44{vertical-align:top;width:438pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c43{vertical-align:top;width:297pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c62{vertical-align:top;width:430.5pt;border-style:solid;background-color:#ffffff;border-color:#999999;border-width:0.8pt;padding:2.2pt 2.2pt 2.2pt 2.2pt}.c59{vertical-align:top;width:436.2pt;border-style:solid;border-color:#999999;border-width:1pt;padding:5pt 5pt 5pt 5pt}.c24{vertical-align:top;width:498.6pt;border-style:solid;border-color:#999999;border-width:1pt;padding:5pt 5pt 5pt 5pt}.c35{vertical-align:top;width:29.2pt;border-style:solid;border-color:#ffffff;border-width:0pt;padding:5pt 5pt 5pt 5pt}.c60{vertical-align:top;width:446.2pt;border-style:solid;border-color:#ffffff;border-width:0pt;padding:5pt 5pt 5pt 5pt}.c0{padding-left:0pt;padding-top:0pt;direction:ltr;margin-left:30pt;padding-bottom:0pt}.c1{padding-top:0pt;direction:ltr;margin-left:30pt;padding-bottom:0pt}.c61{list-style-type:decimal;margin:0;padding:0}.c54{width:498.6pt;background-color:#ffffff;padding:56.7pt 56.7pt 56.7pt 56.7pt}.c18{padding-top:0pt;direction:ltr;padding-bottom:11.2pt}.c4{padding-top:0pt;direction:ltr;padding-bottom:0pt}.c33{list-style-type:circle;margin:0;padding:0}.c27{list-style-type:disc;margin:0;padding:0}.c67{list-style-type:square;margin:0;padding:0}.c16{padding-left:0pt;margin-left:60pt}.c65{padding-left:0pt;margin-left:90pt}.c46{padding-left:0pt;margin-left:36pt}.c7{direction:ltr;margin-left:36pt}.c11{color:#0000ee;text-decoration:underline}.c25{color:#000099;text-decoration:underline}.c45{padding-left:0pt;margin-left:45pt}.c31{margin-left:30pt;padding-bottom:12.8pt}.c8{color:inherit;text-decoration:inherit}.c10{color:#741b47;font-weight:bold}.c52{padding-left:0pt;margin-left:54pt}.c28{color:#7f6000}.c63{font-size:18pt}.c56{margin-left:28.5pt}.c32{color:#999999}.c2{color:#351c75}.c37{padding-bottom:12.8pt}.c38{color:#cc0000}.c53{margin-left:30pt}.c6{font-family:Courier New}.c58{color:#a64d79}.c17{color:#bf9000}.c49{margin-left:4.5pt}.c30{color:#666666}.c9{color:#674ea7}.c13{color:#0b5394}.c40{margin-left:120pt}.c47{color:#990000}.c50{color:#3d85c6}.c12{font-weight:bold}.c34{color:#741b47}.c23{padding-top:0pt}.c15{height:0pt}.c19{direction:ltr}.c22{text-align:right}.c57{font-size:9pt}.c21{height:10pt}.c36{margin-left:60pt}.c5{font-style:italic}.c64{font-size:8pt}.c51{margin-left:18pt}.c29{text-align:center}.c3{border-collapse:collapse}.c41{margin-left:72pt}.c48{margin-right:4.5pt}.c66{margin-left:36pt}body{color:#000000;font-size:10pt;font-family:Verdana}h1{padding-top:12pt;line-height:1.0;text-align:left;color:#000000;font-size:18pt;font-family:Arial;font-weight:bold;padding-bottom:12pt}h2{padding-top:11.2pt;line-height:1.0;text-align:left;color:#000000;font-size:14pt;font-family:Arial;font-weight:bold;padding-bottom:11.2pt}h3{padding-top:12pt;line-height:1.0;text-align:left;color:#000000;font-size:12pt;font-family:Arial;font-weight:bold;padding-bottom:12pt}h4{padding-top:12.8pt;line-height:1.0;text-align:left;color:#000000;font-size:11pt;font-family:Arial;font-weight:bold;padding-bottom:12.8pt}h5{padding-top:12.8pt;line-height:1.0;text-align:left;color:#000000;font-size:8pt;font-family:Arial;font-weight:bold;padding-bottom:12.8pt}h6{padding-top:18pt;line-height:1.0;text-align:left;color:#000000;font-size:8pt;font-family:Arial;font-weight:bold;padding-bottom:18pt}</style>
</head>

<body class="c54">
<h1 class="c19"><a name="h.2f89e3402672"></a><span class="c9 c12 c63">Ujorm
User Guide</span><img height="65" src="images/image01.png" width="65" style="margin-left: 300px;"></h1>

<p class="c23 c19"><span class="c9 c12">the ORM module</span></p>

<p class="c4 c21"><span class="c9 c12"></span></p>

<p class="c4"><span class="c5">Document License: </span><span class="c11 c5"><a
class="c8" href="http://creativecommons.org/licenses/by-nd/3.0/">Creative
Commons BY-ND</a></span><span class="c5">&#xa0;,</span></p>

<p class="c4"><span class="c5">Author: Pavel Ponec, ponec@ujorm.com</span></p>

<p class="c1"><span class="c5">&#xa0;&#xa0; Spring Integration by Tomas
Hampl</span></p>

<p class="c4"><span class="c5">Version: Ujorm 1.22 (February, 2012)</span></p>

<p class="c4"><span class="c5">PDF format:</span><span>&#xa0;</span><img
height="16" src="images/image02.png" width="16"><span class="c25"><a class="c8"
href="http://www.google.com/url?q=http%3A%2F%2Fujorm.org%2Form%2Ftutorial%2FUjormUserGuide-1.22.pdf&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNH3zCQYq3BdAtLPNLx3wkqq53iMJw">http://ujorm.org/orm/tutorial/UjormUserGuide-1.22.pdf
</a></span></p>

<p class="c4"><span class="c5">Thank you for your comments or
suggestions.</span></p>

<p class="c18 c21"><span></span></p>

<p class="c19 c51"><span class="c25"><a class="c8" href="#h.2f89e3402672">Ujorm
User Guide</a></span></p>

<p class="c7"><span class="c25"><a class="c8"
href="#h.6d553494a6d4">Prologue</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.3f19c028a66e">Quick
Start</a></span></p>

<p class="c7"><span class="c25"><a class="c8"
href="#h.dc11e7a0ee04">Architecture</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.524c1014fb21">Example of
the application code</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.fbe3bfa4e133">Persistent
domain objects</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.d0c24121399a">Comment by
annotations</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.e3c2a8d31f1d">How to use
the Criterion?</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.f3eeecf0018a">Native
Criterion</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.69a8d8c6e0d5">Native
Query</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.68ad777df9c1">Dynamic
native query</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.c7130ecb63b9">States of
persistent object</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.c448f4c12d9e">Mapping of
data types</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.f52f9a1ffe92">Lazy
loading</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.b0f5b8a80c12">Session
cache</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.dda7591ed9d5">DDL
support</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.c672291e4db1">Entity
inheritance</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.e795e614c8d5">Primary
key auto increment</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.7b8bdc481ed0">Database
procedures</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.fa936dd12adb">Connection
to database</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.b24a52ae4cf8">Batch
database operations</a></span></p>

<p class="c19 c41"><span class="c25"><a class="c8" href="#h.8e5b77e9f3e8">Batch
insert</a></span></p>

<p class="c19 c41"><span class="c25"><a class="c8" href="#h.d4e9acf1b3f4">Batch
update</a></span></p>

<p class="c19 c41"><span class="c25"><a class="c8" href="#h.a9a5e52dcb3d">Batch
delete</a></span></p>

<p class="c7"><span class="c25"><a class="c8"
href="#h.286935a745d0">Transaction control</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.dahj244afoo5">Logging
support</a></span></p>

<p class="c7"><span class="c25"><a class="c8"
href="#h.87af2d291d2c">Multi-thread environment</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.2dc8b03b0862">API
extension</a></span></p>

<p class="c7"><span class="c25"><a class="c8"
href="#h.5902a957f5ab">Meta-Model</a></span></p>

<p class="c7"><span class="c25"><a class="c8"
href="#h.529d45f07307">Performance</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.6c32e8b75e6e">Supported
databases</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.55252fa54c31">Why
UjoProperty constants have lowercase letters?</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.51c99f3693d0">Using of
UJO objects</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.978d5de1fd78">Best
Practices</a></span></p>

<p class="c7"><span class="c25"><a class="c8"
href="#h.c41270dc0dbb">Integrating Spring Framework</a></span></p>

<p class="c7"><span class="c25"><a class="c8" href="#h.304a6c50b9c1">More
information</a></span></p>

<p class="c7"><span class="c25"><a class="c8"
href="#h.772ac403cca2">References</a></span></p>

<p class="c7"><span class="c25"><a class="c8"
href="#h.cc2d51f7ea2f">Acknowledgements</a></span></p>

<p><span></span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.6d553494a6d4"></a><span>Prologue</span></h2>

<p class="c4"><span class="c11"><a class="c8"
href="http://ujorm.com/">Ujorm</a></span><span>&#xa0;is an easy-to-use ORM
framework designed for rapid Java development based on a relation database. The
framework is carefully designed for the </span><span
class="c12">effective</span><span>&#xa0;development with great performance and
a small footprint. The key features are:</span></p>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c0"><span>type-safe queries to a relation database</span></li>
  <li class="c0"><span>building of queries are independent on a target
    database</span></li>
  <li class="c0"><span>relation mapping by the Java code by default, however
    the</span></li>
  <li class="c0"><span>database mapping can be overwritten by annotations or a
    XML file</span></li>
  <li class="c0"><span>internal cache with a protection against overload
    storage</span></li>
  <li class="c0"><span>no entity states</span></li>
  <li class="c0"><span>incremental database update using DDL
  statements</span></li>
  <li class="c0"><span>lazy initialization is supported</span></li>
  <li class="c0"><span>multi row insert, update and delete is supported by a
    single SQL statement</span></li>
  <li class="c0"><span>subset of table columns on SELECT can be specified for
    the statement</span></li>
  <li class="c0"><span>simple and reliable implementation solution</span></li>
  <li class="c0"><span>integration support for the Spring
  Framework&#xa0;</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>The main vision is:</span></p>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c0"><span>50% developer time saving for a persistent layer
    and</span></li>
  <li class="c0"><span>great performance compared with competitors</span></li>
  <li class="c0"><span>simple rules to use</span></li>
  <li class="c0"><span>lightweight ORM framework</span></li>
  <li class="c0"><span>open-source for free use include a commercial
  one</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.3f19c028a66e"></a><span>Quick Start</span></h2>

<p class="c4"><span>There is recommended to read first of all this </span><span
class="c11"><a class="c8"
href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/SampleORM.java?view=markup">class
tutorial</a></span><span>&#xa0;based on an annotated source code for quick
introduction. In the tutorial you can found entities from following class
diagram:</span></p>

<p class="c1 c21"><span></span></p>

<p class="c4 c21 c29"><span></span></p>

<p class="c4 c29"><img height="225" src="images/image03.png" width="444"></p>

<p class="c4"><span class="c5">Note: UjoProperties are in diagrams formally
described using the attributes of entity.</span></p>

<p class="c4 c21"><span class="c5"></span></p>

<p class="c4"><span>Because the Ujorm connected from Maven repository (repo1)
is compiled without debugging information, I suggest to you to join the Ujorm
JavaDoc to your project, so that you get full names of method parameters and
more useful information from API.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>When you use the Maven POM file, take the following
dependency:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c20"><p class="c4"><span class="c6">&#xa0;
        &lt;dependency&gt;</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        &lt;groupId&gt;</span><span class="c6 c12">org.ujorm</span><span
        class="c6">&lt;/groupId&gt;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        &lt;artifactId&gt;</span><span class="c6 c12">ujo-orm</span><span
        class="c6">&lt;/artifactId&gt;</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        &lt;version&gt;</span><span class="c6 c12">1.22</span><span
        class="c6">&lt;/version&gt;</span></p>

        <p class="c4"><span class="c6">&#xa0; &lt;/dependency&gt;</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c18 c21"><span class="c6"></span></p>

<p class="c18 c21"><span class="c6"></span></p>

<h2 class="c19"><a name="h.dc11e7a0ee04"></a><span>Architecture</span></h2>

<p class="c4"><span>The next class diagram clarifies relation between Ujorm
framework classes and application domain classes. The diagram is simplified and
slightly modified to show only the relevant entities. A more detailed
descriptions can be found, if necessary, in the </span><span class="c11"><a
class="c8" href="http://ujorm.org/javadoc/">Ujorm
JavaDoc</a></span><span>&#xa0;.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21 c29"><span></span></p>

<p class="c4 c29"><img height="568" src="images/image04.png" width="543"></p>

<p class="c4 c21 c29"><span></span></p>

<p class="c4"><span>Notes to graph:</span></p>

<p class="c4"><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/UjoProperty.html">UjoProperty</a></span><span>&#xa0;attributes
described in the domain objects are always </span><span class="c12">immutable
static constants,</span><span>&#xa0;which provide methods for writing and
reading values to (from) the Ujo object. Only this diagram is hinted for better
illustration the implementation of UjoProperties in domain objects, in other
diagrams of this document is used the same formal registration as for a regular
POJO attributes.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Entity Description:</span></p>
<ol class="c27">
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/Ujo.html">Ujo</a></span><span>&#xa0;-
    interface of an object containing the values. The object provides a list of
    their keys. A kind of data storage determines the implementation, for
    example OrmTable uses internally an array of objects.</span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/UjoProperty.html">UjoProperty</a></span><span>&#xa0;-
    immutable object containing meta-data of the property, which provides two
    methods for reading and writing values to Ujo object. Two related
    UjoProperties could be joined using the method add(), the result is stored
    in a new immutable instance of the UjoProperty interface.</span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/extensions/Property.html">Property</a></span><span>&#xa0;-
    the default implementation of UjoProperty</span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/implementation/orm/RelationToMany.html">RelationToMany</a></span><span>&#xa0;-
    extended default implementation of UjoProperty designed for the data type:
    UjoIterator&lt;item&gt;</span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/orm/OrmUjo.html">OrmUjo</a></span><span>&#xa0;-
    an interface designed for persistent application domain objects. Each
    object contains the session and provides a list of modified keys,
    more information are available later in this document</span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/implementation/orm/OrmTable.html">OrmTable</a></span><span>&#xa0;-
    default implementation of OrmUjo interface</span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/orm/OrmHandler.html">OrmHandler</a></span><span>&#xa0;-
    owner of the meta-model, which provides an efficient methods to search for
    specific parts of the meta-model. Meta-model is locked after initialization
    and can't be changed later.</span></li>
  <li class="c0"><span class="c25"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html">Criterion</a></span><span>&#xa0;-
    the fundamental condition for the evaluation database Query. Criterion
    objects can be joined into a binary tree by operators </span><span
    class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html#and%28org.ujorm.criterion.Criterion%29">and()</a></span><span>&#xa0;and
    </span><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html#or%28org.ujorm.criterion.Criterion%29">or()</a></span><span>&#xa0;.</span></li>
  <li class="c0"><span>Database - the class form an application package
    containing a description of the persistent domain classes and stored
    procedures. For different DB connections, you can define multiple classes
    type of Database</span></li>
  <li class="c0"><span>User, Order, Item - example of using application domain
    objects, Please notice that in object can be used RelatinToMany property
    like in class Database. This RelationToMany always returns UjoIterator as a
    result of a new database query.</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.524c1014fb21"></a><span>Example of the application
code</span></h2>

<p class="c4"><span>The following code example obtains instances of
</span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/OrmHandler.html">OrmHandler</a></span><span>&#xa0;class
and its configuration using the Database class, the instance is retained for.
It creates an instance of Order class Items and stores in a database. The
</span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/Session.html#save%28org.ujorm.orm.OrmUjo%29">save()</a></span><span>&#xa0;and
</span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/Session.html#commit%28%29">commit()</a></span><span>&#xa0;operations
can throw an run-time exception so there is necessary to catch the exception
and close the used </span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/Session.html">Session</a></span><span>.</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c43"><p class="c4"><span class="c6">&#xa0;OrmHandler handler =
        </span><span class="c10 c6">new</span><span
        class="c6 c12">&#xa0;</span><span
        class="c6">OrmHandler();&#xa0;</span></p>

        <p class="c4"><span
        class="c6">&#xa0;handler.loadDatabase(Database.</span><span
        class="c10 c6">class</span><span class="c6">);</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">&#xa0;Order order = </span><span
        class="c10 c6">new</span><span class="c6 c34">&#xa0;</span><span
        class="c6">Order();</span></p>

        <p class="c4"><span class="c6">&#xa0;order.setDate(</span><span
        class="c10 c6">new </span><span class="c6">Date());</span></p>

        <p class="c4"><span class="c6">&#xa0;order.setDescr("</span><span
        class="c6 c13 c12">My order</span><span class="c6">");</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">&#xa0;Item item1 = </span><span
        class="c6 c34">new </span><span class="c6">Item();</span></p>

        <p class="c4"><span class="c6">&#xa0;item1.setOrder(order);</span></p>

        <p class="c4"><span class="c6">&#xa0;item1.setDescr(</span><span
        class="c6 c13 c12">"Yellow table"</span><span class="c6">);</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">&#xa0;Item item2 = </span><span
        class="c6 c34">new </span><span class="c6">Item();</span></p>

        <p class="c4"><span class="c6">&#xa0;item2.setOrder(order);</span></p>

        <p class="c4"><span class="c6">&#xa0;item2.setDescr(</span><span
        class="c6 c13 c12">"Green window"</span><span class="c6">);</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">&#xa0;Session session
        =&#xa0;handler.createSession(); &#xa0;</span></p>

        <p class="c4"><span class="c6">&#xa0;session.save(order);
        &#xa0;</span></p>

        <p class="c4"><span class="c6">&#xa0;session.save(item1);
        &#xa0;</span></p>

        <p class="c4"><span class="c6">&#xa0;session.save(item2);
        &#xa0;</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">&#xa0;session.commit(); &#xa0;</span></p>

        <p class="c4"><span class="c6">&#xa0;session.close();</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c4"><span>The second example contains usage a query using the
</span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html">Criterion</a></span><span>&#xa0;joined
by two elementary conditions. Missing operator is replaced by the EQUALS' one.
Notice how is created composite 'UjoProperty'. The composite 'property' can be
stored as an additional static constants of domain object. Prepared query is
contained in the 'Query' object a can be simply used in 'for-each' command. In
the end we have to close database 'session' again. More information about the
Criterion use can be found </span><span class="c11">later</span><span>&#xa0;in
this document.</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c44"><p class="c4"><span class="c6">&#xa0;Session session =
        handler.createSession();</span></p>

        <p class="c4"><span>&#xa0; </span><span
        class="c6">Criterion&lt;Item&gt; cn1, cn2, criterion;</span></p>

        <p class="c4"><span>&#xa0; &#xa0;</span></p>

        <p class="c4"><span class="c6">&#xa0;cn1 = Item.id.whereGe(</span><span
        class="c6 c13 c12">1L</span><span class="c6">);</span></p>

        <p class="c4"><span class="c6">&#xa0;cn2 =
        Item.order.add(Order.descr).whereEq(</span><span class="c6 c13 c12">"My
        order"</span><span class="c6">);</span></p>

        <p class="c4"><span class="c6">&#xa0;criterion =
        cn1.and(cn2);</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">&#xa0;for (Item item :
        session.createQuery(criterion)) {</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0; String descr =
        item.getDescr();</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0; Date created =
        item.getOrder().getDate();</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0;
        System.out.println( created + </span><span class="c6 c13 c12">" :
        "</span><span class="c6">&#xa0;+ descr );</span></p>

        <p class="c4"><span class="c6">&#xa0;}</span></p>

        <p class="c4"><span class="c6">&#xa0;session.close();</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c4"><span>This Java code executes a database SQL statement
</span><span class="c12">similar </span><span>to this:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c44"><p class="c4"><span>&#xa0; </span><span class="c6">SELECT
        * FROM item</span></p>

        <p class="c4"><span class="c6">&#xa0;LEFT INNER JOIN order ON order.id
        = item.fk_order&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span></p>

        <p class="c4"><span class="c6">&#xa0;WHERE item.id &gt;= 1</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0; AND order.descr =
        '</span><span class="c6 c13 c12">John\'s order</span><span
        class="c6">'</span></p>

        <p class="c4"><span class="c6">&#xa0;ORDER BY order.created, item.id
        DESC</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c4"><span>where both parameters are passed by a 'question mark'
notation for a high security.</span></p>

<p class="c4"><span>In the last example is used information from meta-model,
which may contain useful information such as validation of the
object.</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c26"><p class="c4"><span class="c6">&#xa0;MetaColumn col =
        (MetaColumn) &#xa0;</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        handler.findColumnModel(Order.DESCR); &#xa0;</span></p>

        <p class="c4"><span>&#xa0;</span></p>

        <p class="c4"><span class="c6">&#xa0;String msg</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0; = </span><span
        class="c6 c13 c12">"DB name: "</span><span class="c6">&#xa0;+
        col.getFullName()&#xa0; + </span><span
        class="c6 c13 c12">'\n'</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0; + </span><span
        class="c6 c13 c12">"Comment: "</span><span class="c6">&#xa0;+
        col.getComment() &#xa0; + </span><span
        class="c6 c13 c12">'\n'</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0; + </span><span
        class="c6 c13 c12">"Length : "</span><span class="c6">&#xa0;+
        col.getMaxLength() + </span><span class="c6 c13 c12">'\n'</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0; + </span><span
        class="c6 c13 c12">"NotNull: "</span><span class="c6">&#xa0;+
        col.isMandatory()&#xa0; + </span><span
        class="c6 c13 c12">'\n'</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0; + </span><span
        class="c6 c12 c13">"Primary: "</span><span class="c6">&#xa0;+
        col.isPrimaryKey() + </span><span class="c6 c13 c12">'\n'</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0; + </span><span
        class="c6 c13 c12">"Dialect: "</span><span class="c6">&#xa0;+
        col.getDialectName()</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;&#xa0; ;</span></p>

        <p class="c4"><span class="c6">&#xa0;System.out.println(msg);</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c19"><span>Prints the text report on a console output:</span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c26"><p class="c4"><span>&#xa0;&#xa0;</span><span
        class="c6">DB name: db1.ord_order.DESCR</span></p>

        <p class="c4"><span class="c6">&#xa0;Comment: Description of the
        Order</span></p>

        <p class="c4"><span class="c6">&#xa0;Length : 128</span></p>

        <p class="c4"><span class="c6">&#xa0;NotNull: true</span></p>

        <p class="c4"><span class="c6">&#xa0;Primary: false</span></p>

        <p class="c4"><span class="c6">&#xa0;Dialect: H2Dialect</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c18 c21"><span class="c6"></span></p>

<h2 class="c19"><a name="h.fbe3bfa4e133"></a><span>Persistent domain
objects</span></h2>

<p class="c4"><span>Ujorm framework can use to persistence any object which
implements the OrmUjo interface.</span></p>

<p class="c4"><span>However the easiest way is to create a child from the
abstract class OrmTable:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c26"><p class="c4"><span>public class </span><span
        class="c2 c12">Order </span><span>extends OrmTable&lt;Order&gt;
        {</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; @Column(pk = true)</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public static final
        UjoProperty&lt;Order, Long&gt; </span><span class="c2 c12">id</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; =
        newProperty(Long.</span><span
        class="c10">class</span><span>);</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public static final
        UjoProperty&lt;Order, Date&gt; </span><span
        class="c2 c12">created</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; =
        newProperty(Date.</span><span
        class="c10">class</span><span>);</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span>&#xa0; &#xa0; public static final
        UjoProperty&lt;Order, User&gt; </span><span
        class="c2 c12">user</span></p>

        <p
        class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        = newProperty(User.</span><span
        class="c10">class</span><span>);</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span class="c32 c5">&#xa0;&#xa0;&#xa0; /** Reference to
        the Order Item Iterator */</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public static final
        RelationToMany&lt;Order, Item&gt; </span><span
        class="c2 c12">items</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; =
        newRelation(Item.</span><span
        class="c10">class</span><span>);</span></p>

        <p class="c4"><span>}</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>The </span><span class="c12">primary
key</span><span>&#xa0;is marked by parameter </span><span
class="c12">pk</span><span>&#xa0;of the annotation </span><span
class="c12">Column</span><span>, a database column name is derived from
UjoProperty field name by default. That is all, isn't it easy?</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>OK, for better comfort for developers we can optionally add
getters and setters, however it is important to know that the framework doesn't
need the methods:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c26"><p class="c4"><span>public class </span><span
        class="c2 c12">Order </span><span>extends OrmTable&lt;Order&gt;
        {</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span class="c32 c5">&#xa0;&#xa0;&#xa0; [ The UjoProperty
        declarations ... ]</span></p>

        <p class="c4 c21"><span class="c32 c5"></span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public Long getId() {</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        </span><span class="c10">return </span><span>get(</span><span
        class="c2 c12">id</span><span>);</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; }</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public </span><span
        class="c10">void </span><span>setId(Long _id) {</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        set(</span><span class="c2 c12">id</span><span>, _id);</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; }</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public Date getCreated()
        {</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        </span><span class="c10">return </span><span>get(</span><span
        class="c2 c12">created</span><span>);</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; }</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public </span><span
        class="c10">void </span><span>setCreated(Date _created) {</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        set(</span><span class="c2 c12">created</span><span>,
        _created);</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; }</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public User getUser()
        {</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        </span><span class="c10">return </span><span>get(</span><span
        class="c2 c12">user</span><span>);</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; }</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public </span><span
        class="c10">void </span><span>setUser(User _user) {</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        set(</span><span class="c2 c12">user</span><span>, _user);</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; }</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; </span><span class="c32 c5">/**
        Only getter is allowed for the UjoIterlator */</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public UjoIterator&lt;Item&gt;
        getItems() {</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        </span><span class="c10">return </span><span>get(</span><span
        class="c2 c12">items</span><span>);</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; }</span></p>

        <p class="c4"><span>}</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c18 c21"><span></span></p>

<p class="c18"><span>Note, that the relation to the Items can't have got the
setter. A new Items can be assigned by the method Session.save(...) to database
only.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.d0c24121399a"></a><span>Comment by
annotations</span></h2>

<p class="c4"><span>Since Ujorm release 1.10 is allowed to describe persistent
objects or its keys by special annotation called </span><span
class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/annot/Comment.html">Comment.</a></span></p>

<p class="c4"><span>In case that a DDL auto-update is enabled than Ujorm write
the text to relation database meta-model loading time, if the feature is
supported</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>The assigned policy can be affected by parameter
</span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/metaModel/MetaParams.html#COMMENT_POLICY">COMMENT_POLICY</a></span><span>&#xa0;with
options:</span></p>
<ol class="c27">
  <li class="c0"><span>ON_ANY_CHANGE - Assign all available comments from
    annotations to database on a new database object event,exactly on new
    table, column or index. It is a </span><span class="c12">default
    </span><span>option.</span></li>
  <li class="c0"><span>FOR_NEW_OBJECT Assign the comment for a new table
    only</span></li>
  <li class="c0"><span>NEVER No comments are assigned</span></li>
  <li class="c0"><span>ALWAYS - Write all available comments from annotations
    to database on each meta-model loading event.</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Sample of the use:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c26"><p class="c4"><span
        class="c10">@Comment</span><span>("</span><span class="c2">Order table
        is a head for its 'item'</span><span>&#xa0;list)</span></p>

        <p class="c4"><span>public class </span><span class="c2 c12">Order
        </span><span>extends OrmTable&lt;Order&gt; {</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; </span><span
        class="c10">@Comment</span><span>("</span><span class="c2">The Primary
        Key</span><span>")</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; @Column(pk = true)</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public static final
        UjoProperty&lt;Order, Long&gt; </span><span class="c2 c12">id
        </span><span>...</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; </span><span
        class="c10">@Comment</span><span>("</span><span class="c2">Date of
        insert</span><span>")</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public static final
        UjoProperty&lt;Order, Date&gt; </span><span class="c2 c12">created
        </span><span>...</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; </span><span
        class="c10">@Comment</span><span>("</span><span class="c2">Key to
        related user</span><span>")</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; public static final
        UjoProperty&lt;Order, User&gt; </span><span class="c2 c12">user
        </span><span>...</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span>}</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c18 c21"><span></span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.e3c2a8d31f1d"></a><span>How to use the
Criterion?</span></h2>

<p class="c4"><span>The </span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html">Criterion</a></span><span>&#xa0;is
a base element to restrict a database </span><span
class="c12">query</span><span>, however criterions have got one next feature:
they can be used immediately for the evaluation of an object - as a
</span><span class="c12">validator</span><span>.</span></p>

<p class="c4"><span>Each Criterion can be built to the binary tree by to
operators: </span><span class="c12">and</span><span>(), </span><span
class="c12">or</span><span>().</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>For example let's create an instance of the Order
entity:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c26"><p class="c4"><span class="c6">final Order order =
        </span><span class="c10 c6">new </span><span
        class="c6">Order();</span></p>

        <p class="c4"><span class="c6">order.setId(</span><span
        class="c6 c13 c12">100L</span><span class="c6">);</span></p>

        <p class="c4"><span class="c6">order.setDescr("</span><span
        class="c6 c13 c12">my order</span><span class="c6">");</span></p>

        <p class="c4"><span class="c6">order.setDate(new Date());</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c4"><span>and three different instances of the Criterion
class:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c26"><p class="c4"><span
        class="c6 c13 c12">final&#xa0;</span><span
        class="c6">Criterion&lt;Order&gt; crnId,&#xa0;crnDescr, crnCreated,
        crn;</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c32 c6 c12 c5">// Order.id&gt;99</span></p>

        <p class="c4"><span class="c6">crnId = Order.</span><span
        class="c6 c12">id</span><span class="c6">.whereGt(</span><span
        class="c6 c13 c12">99L</span><span class="c6">);</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c32 c6 c12 c5">//
        Order.descr='another'</span></p>

        <p class="c4"><span class="c6">crnDescr = Order.</span><span
        class="c6 c12">descr</span><span class="c6">.whereEq("</span><span
        class="c6 c13 c12">another</span><span class="c6">");</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c32 c6 c12">//
        Order.created&lt;=now()</span></p>

        <p class="c4"><span class="c6">crnCreated =
        Criterion.where(Order.created</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        , Operator.LE, </span><span class="c10 c6">new </span><span
        class="c6">Date());</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c4"><span>See the samples where the </span><span
class="c6 c12">assert </span><span>statement have got a true result
always.</span></p>

<p class="c4"><span>Simple condition: </span></p>

<p class="c4"><span class="c32 c6 c12 c5">Order.id&gt;99</span></p>

<p class="c4 c21"><span class="c32 c6 c12 c5"></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c26"><p class="c4"><span class="c10 c6">assert </span><span
        class="c6">crnId.evaluate(order);</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c4"><span>Compound condition: </span></p>

<p class="c4"><span class="c32 c6 c12 c5">Order.id&gt;99 or
Order.descr='another'</span></p>

<p class="c4 c21"><span class="c32 c6 c12 c5"></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c26"><p class="c4"><span class="c6">crn =
        crnId.or(crnDescr);</span></p>

        <p class="c4"><span class="c10 c6">assert </span><span
        class="c6">crn.evaluate(order);</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c4"><span>Compound condition with parentheses: </span></p>

<p class="c4"><span class="c32 c6 c12">Order.created&lt;=now() and
(Order.descr='another' or Order.id&gt;99)</span></p>

<p class="c4 c21"><span class="c6 c12 c32"></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c26"><p class="c4"><span class="c6">crn =
        crnCreated.and(crnDescr.or(crnId));</span></p>

        <p class="c4"><span class="c10 c6">assert </span><span
        class="c6">crn.evaluate(order);</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c4"><span>Another condition: </span></p>

<p class="c4"><span class="c32 c6 c12 c5">Order.created&lt;=now() or
Order.descr='another') and Order.id&gt;99</span></p>

<p class="c4 c21"><span class="c32 c6 c12 c5"></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c26"><p class="c4"><span class="c6">crn =
        (crnCreated.or(crnDescr)).and(crnId);</span></p>

        <p class="c4"><span class="c32 c6 c5">// ... or simple by a native
        priority:</span></p>

        <p class="c4"><span class="c6">crn =&#xa0;
        crnCreated.or(crnDescr).and(crnId);</span></p>

        <p class="c4"><span class="c10 c6">assert </span><span
        class="c6">crn.evaluate(order);</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c18 c21"><span class="c6"></span></p>

<p class="c19 c48"><span>See the last example to filter an list of order items
where each its order is created in the past:</span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr>
      <td class="c24"><p class="c4 c48 c49"><span class="c6">List&lt;Item&gt;
        items = Item.</span><span class="c6 c12">order</span><span
        class="c6">.add(</span><span class="c6 c12">created</span><span
        class="c6">).whereLt(new Date())</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.evaluate(getAllOrderItems());</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">for (Item item : items) {</span></p>

        <p class="c4 c49 c48"><span class="c6">&#xa0; &#xa0;
        System.out.println(item);</span></p>

        <p class="c4"><span class="c6">}</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c18 c21"><span class="c6"></span></p>

<p class="c18"><span>Further examples of solved tasks can be found at this
</span><span class="c11"><a class="c8"
href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/SampleORM.java?view=markup">link</a></span><span>&#xa0;.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.f3eeecf0018a"></a><span>Native Criterion</span></h2>

<p class="c4"><span>Native Criterion is a special Criterion with a native SQL
code. The Criterion can be created by the factory method</span></p>

<p class="c1"><span>Criterion.forSql(Property, SQL_condition)</span></p>

<p class="c4"><span>where</span></p>
<ol class="c27">
  <li class="c0"><span>parameter </span><span class="c12">Property
    </span><span>is required by Ujorm to location a basic </span><span
    class="c12">database table </span><span>and the join relations in case a
    composed Property</span></li>
  <li class="c0"><span class="c12">SQL_condition</span><span>&#xa0;is a part of
    the native SQL statement with a condition expression in a text
  format</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>The instance of the native Criterion have got some special
features:</span></p>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c0"><span>parameters inside the SQL_condition are not supported by
    the Ujorm using a 'question mark' notation</span></li>
  <li class="c0"><span>your own implementation of SQL the parameters can
    increase a risk of the </span><span class="c11"><a class="c8"
    href="http://en.wikipedia.org/wiki/SQL_injection">SQL
    injection</a></span><span>&#xa0;attacks</span></li>
  <li class="c0"><span>method </span><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/criterion/Criterion.html#evaluate%28UJO%29">Criterion.evaluate(ujo)</a></span><span>&#xa0;is
    not supported and throws the exception UnsupportedOperationException in the
    run-time</span></li>
  <li class="c0"><span>native Criterion dependents on a selected database so
    application developers should to create support for each supported database
    of target application to ensure database compatibility</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>The native Criterion can be </span><span class="c12">joined
</span><span>with another Criterions include the native type. The Criterion can
be used also in the </span><span class="c11">Native
Query</span><span>.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Sample of the use:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c39"><p class="c4"><span
        class="c6">&#xa0;Criterion&lt;Order&gt; crn1 =
        Criterion.forSql</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        (Order.</span><span class="c6 c12 c58">id</span><span class="c6">,
        "</span><span class="c6 c9 c12">ord_order_alias.id&gt;3</span><span
        class="c6">");</span></p>

        <p class="c4"><span class="c6">&#xa0;Criterion&lt;Order&gt; crn2 =
        Order.created..whereLe(new Date());</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">&#xa0;Query&lt;Order&gt; orders =
        session.createQuery(crn1.and(crn2));</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">&#xa0;for (Order order : orders)
        {</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0;
        System.out.println("ORDER: " + order);</span></p>

        <p class="c4"><span class="c6">&#xa0;}</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c18 c21"><span class="c6"></span></p>

<p class="c18"><span>Note: the property </span><span
class="c10">id</span><span>&#xa0;from the sample can be replaced for another
UjoProperty from the Order class.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.69a8d8c6e0d5"></a><span>Native Query</span></h2>

<p class="c4"><span>The native Query is a tool of the framework Ujorm to
mapping a native (database-dependent) SQL query to </span><span class="c11"><a
class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/OrmUjo.html">OrmUjo</a></span><span>&#xa0;business
object. Each native Query must be mapped to new object. Using of the Query is
similar like the object-table mapping, however the </span><span class="c11"><a
class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/annot/View.html">@View</a></span><span>&#xa0;annotation
is used instead of @</span><span class="c12">Table</span><span>.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr>
      <td class="c24"><p class="c4"><span class="c10 c6">@View</span><span
        class="c6">(select=</span><span class="c6 c12">"</span><span
        class="c6 c17 c12">SELECT ord_order_alias.id, count(*) AS
        item_count</span><span class="c6 c12">"</span></p>

        <p class="c4"><span class="c6 c12">&#xa0;&#xa0;&#xa0; + "</span><span
        class="c6 c17 c12">&#xa0;FROM </span><span
        class="c6 c47 c12">{SCHEMA}</span><span class="c6 c17 c12">.ord_order
        ord_order_alias</span><span class="c6 c12">"</span></p>

        <p class="c4"><span class="c6 c12">&#xa0;&#xa0;&#xa0; + "</span><span
        class="c6 c12 c17">, </span><span
        class="c6 c47 c12">{SCHEMA}</span><span class="c6 c17 c12">.ord_item
        ord_item_alias</span><span class="c6 c12">"</span></p>

        <p class="c4"><span class="c6 c12">&#xa0;&#xa0;&#xa0; + " </span><span
        class="c6 c17 c12">WHERE ord_order_alias.id =
        ord_item_alias.fk_order</span><span class="c6 c12">"</span></p>

        <p class="c4"><span class="c6 c12">&#xa0;&#xa0;&#xa0; + " </span><span
        class="c6 c17 c12">GROUP BY ord_order_alias.id</span><span
        class="c6 c12">"</span></p>

        <p class="c4"><span class="c6 c12">&#xa0;&#xa0;&#xa0; + " </span><span
        class="c6 c17 c12">ORDER BY ord_order_alias.id</span><span
        class="c6 c12">"</span><span class="c6">)</span></p>

        <p class="c4"><span class="c6">public </span><span
        class="c6 c9 c12">class </span><span class="c6">ViewOrder </span><span
        class="c6 c9 c12">extends </span><span
        class="c6">OrmTable&lt;ViewOrder&gt; {</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0; </span><span
        class="c32 c6">/** Unique key */</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0; </span><span
        class="c10 c6">@Column</span><span class="c6">(pk=true)</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0; </span><span
        class="c6 c9 c12">public static final</span><span
        class="c6">&#xa0;UjoProperty&lt;ViewOrder,Long&gt; ID</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        = newProperty(Long.</span><span class="c6 c9 c12">class</span><span
        class="c6">);</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0; </span><span
        class="c32 c6">/** ItemCount */</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0;&#xa0; </span><span
        class="c6 c9 c12">public static final</span><span
        class="c6">&#xa0;UjoProperty&lt;ViewOrder,Integer&gt;
        ITEM_COUNT</span></p>

        <p class="c4"><span class="c6">&#xa0; &#xa0; &#xa0; &#xa0; &#xa0;&#xa0;
        = newProperty(</span><span class="c10 c6">0</span><span
        class="c6">);</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">}</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>The View:</span></p>
<ol class="c27">
  <li class="c0"><span>must contain an unique column similar as a primary
    key</span></li>
  <li class="c0"><span>supports </span><span class="c12">relations
    </span><span>to another views or tables</span></li>
  <li class="c0"><span>the view business object can't be used to the INSERT,
    UPDATE nor DELETE</span></li>
  <li class="c0"><span>different SQL syntax can be covered in a different XML
    configurations</span></li>
  <li class="c0"><span>in the most cases the additional Criterion (all types)
    is supported</span></li>
  <li class="c0"><span>in the most cases the additional sorting is
    supported</span></li>
  <li class="c0"><span>attributes LIMIT and OFFSET are ignored</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.68ad777df9c1"></a><span>Dynamic native
query</span></h2>

<p class="c18"><span>Sometimes there is necessary to use a SQK query built in
the run-time. For the case use you can use the next feature:</span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr>
      <td class="c24"><p class="c4"><span class="c6 c9 c12">final </span><span
        class="c6">Long </span><span class="c6 c12 c50">excludedId </span><span
        class="c6">= </span><span class="c6 c9 c12">-7L</span><span
        class="c6">;</span></p>

        <p class="c4"><span class="c6">SqlParameters sql = </span><span
        class="c6 c9 c12">new </span><span
        class="c6">SqlParameters().setSqlStatement</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(</span><span
        class="c6 c17">&#xa0;</span><span class="c6 c17 c12">"SELECT * FROM
        ("</span></p>

        <p class="c4"><span
        class="c6 c17 c12">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;+
        "SELECT ord_order_alias.id"</span></p>

        <p class="c4"><span
        class="c6 c17 c12">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;+
        &#xa0; &#xa0; &#xa0; &#xa0; ", 1000 + count(*) AS item_count"</span></p>

        <p class="c4"><span
        class="c6 c17 c12">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;+ "
        FROM </span><span class="c6 c12 c47">${SCHEMA}</span><span
        class="c6 c17 c12">.ord_order ord_order_alias"</span></p>

        <p class="c4"><span
        class="c6 c17 c12">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;+ "
        LEFT JOIN </span><span class="c6 c47 c12">${SCHEMA}</span><span
        class="c6 c17 c12">.ord_item ord_item_alias"</span></p>

        <p class="c4"><span
        class="c6 c17 c12">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;+ "
        ON ord_order_alias.id = ord_item_alias.fk_order"</span></p>

        <p class="c4"><span
        class="c6 c17 c12">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;+ "
        WHERE ord_item_alias.id != ?"</span><span
        class="c32 c6">&#xa0;</span><span class="c32 c6 c64">// Parameter is
        replaced by the excludedId</span></p>

        <p class="c4"><span
        class="c6 c17 c12">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;+ "
        GROUP BY ord_order_alias.id"</span></p>

        <p class="c4"><span
        class="c6 c17 c12">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;+ "
        ORDER BY ord_order_alias.id"</span></p>

        <p class="c4"><span
        class="c6 c17 c12">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;+ ")
        testView WHERE true"</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;).setParameters(</span><span
        class="c6 c50 c12">excludedId</span><span class="c6">);</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">Criterion&lt;ViewOrder&gt; </span><span
        class="c6 c12">crit </span><span class="c6">= ViewOrder.</span><span
        class="c6 c12">itemCount</span><span
        class="c6">.whereLe(100);</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">long orderCount =
        session.createQuery(</span><span class="c6 c12">crit</span><span
        class="c6">)</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.setSqlParameters(sql)</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.getCount()</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;;</span></p>

        <p class="c4 c21"><span class="c6"></span></p>

        <p class="c4"><span class="c6">Query&lt;ViewOrder&gt; orders =
        session.createQuery(</span><span class="c6 c12">crit</span><span
        class="c6">)</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.setLimit(5)</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.orderBy(ViewOrder.ID)</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.setSqlParameters(sql)</span></p>

        <p class="c4"><span
        class="c6">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;;</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.c7130ecb63b9"></a><span>States of persistent
object</span></h2>

<p class="c4"><span>Persistent class is obtained by extending the abstract
class </span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/implementation/orm/OrmTable.html">OrmTable</a></span><span>&#xa0;or
implementation of </span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/OrmUjo.html">OrmUjo</a></span><span>&#xa0;interface.
Persistent object </span><span class="c12">doesn't</span><span>&#xa0;contain
invasive states known from specifications of 'JPA/Hibernate', but each
persistent object of OrmUjo type contains two other attributes:</span></p>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/orm/Session.html">Session</a></span><span>&#xa0;-
    is needed to obtain a 'DB connection' in late values approach, the process
    is called 'lazy-loading'. If an </span><span class="c12">attribute
    of</span><span>&#xa0;the persistent object is another persistent object,
    then in each session reading is 'session' propagated from the reference to
    the relational object. For this reason, if you restore the 'session', there
    is sufficient to setup only the first object of the relational hierarchy to
    the current Session.</span></li>
  <li class="c0"><span class="c25"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/UjoProperty.html">UjoProperty</a></span><span>[]
    - contains a list of 'Properties' </span><span
    class="c12">registered</span><span>&#xa0;during the assigned session. This
    list provides more efficient updating of the database by 'UPDATE' command,
    because the command is compiled only for the modified value of the
    'Properties'. Other values are ignored while updating. Note that if a
    session isn't assigned to the object, there is registered no value
    changes.</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Function of OrmUjo object is just "data transporter",
without any restrictions you can do activities such as:</span></p>
<ol class="c27">
  <li class="c0"><span>object obtained using the 'update' can be used (after
    changing ID) for insert</span></li>
  <li class="c0"><span>a new session can be assigned to object anytime (no
    other dependency)</span></li>
  <li class="c0"><span>object can be assigned with </span><span class="c11"><a
    class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/orm/ForeignKey.html">foreign
    key</a></span><span>&#xa0;to force LazyLoading - using
    'Ujo.writeValue()'</span></li>
  <li class="c0"><span>to change the session of ManyToOne type (update of
    foreign key) is sufficient to assign a new instance of an object containing
    an real Primary Key</span></li>
  <li class="c0"><span>when using Criterion, the value of the filter
    (parameter) can be a new instance of OrmUjo object that contains the
    required Primary Key</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<p class="c18"><span>Note: both of these attributes aren't transferred by Java
</span><span class="c12">serialization,</span><span>&#xa0;which means that
after the restoration from serialization, they will be logically
empty.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.c448f4c12d9e"></a><span>Mapping of data
types</span></h2>

<p class="c4"><span>Mapping of data types means adding JDBC type and element
name to persistent Ujo property. Depending on the parameter mapping can be
divided into two major groups:</span></p>
<ol class="c27">
  <li class="c0"><span>mapping of session - mapping to another persistent
    object of </span><span class="c12">OrmUjo </span><span>type</span></li>
  <li class="c0"><span>mapping of value - other assignments of selected object
    types</span></li>
</ol>

<p class="c4"><span>More detailed description is here:</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span class="c2 c12">Mapping of values</span></p>
<ol class="c27">
  <li class="c0"><span class="c12">default</span><span>&#xa0;mapping is
    implemented for objects of these types: String, Boolean, Byte, Character,
    Short, Integer, Long, Float, Double, BigDecimal, BigInteger, byte [],
    java.util.Date, java.sql.Date, java.sql.Time, java.sql.Timestamp,
    java.sql.Blob, java.sql.Clob, Enum</span></li>
  <li class="c0"><span class="c12">explicit</span><span>&#xa0;mapping is given
    in '@Column' annotation or via an XML configuration file</span></li>
  <li class="c0"><span>via </span><span
    class="c12">interface:</span><span>&#xa0;any object that implements the
    interface 'ValueExportable' is automatically mapped to 'VARCHAR'. That
    interface can also implement the 'Enum' type.</span></li>
  <li class="c0"><span>specific requirements for mapping can be implemented by
    overlay </span><span class="c12">TypeService </span><span>class</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span class="c2 c12">Mapping of session M:1</span></p>
<ol class="c27">
  <li class="c0"><span>mapping on primary key: for mapping is used standard
    property, only in class name appears another persistent class of object
    (implementing OrmUjo). As a relational column will be automatically used
    the primary key of a relational table.</span></li>
  <li class="c0"><span>explicit mapping: used if the referenced column is not
    the primary key. In this case, you can use a 'RelationToOne' class that
    lets you put relational column with a second parameter in the following
    format:</span></li>
</ol>

<p class="c4 c36"><span>ordProperty = RelationToOne.newInstance (Order.class,
</span><span class="c12">Order.sid)</span></p>

<p class="c1"><span>I recommend referenced column mark with a unique
</span><span class="c12">index</span><span>&#xa0;for fast searching and data
integrity, some databases require an index explicitly.</span></p>

<p class="c4"><span class="c2 c12">Mapping of session 1:M</span></p>

<p class="c1"><span>This type of mapping offers (in way of writing code), easy
access to the database query results. Any other value invoking generates a new
database query. This type of property doesn't affect the creation or
modification of database structure. Example of use:</span></p>

<p class="c4 c21 c36"><span></span></p>

<p class="c4 c36"><span>items = newRelation (Item.class)</span></p>

<p class="c4"><span class="c2 c12">Mapping of session 1:1</span></p>

<p class="c1"><span>From the perspective of a solution this is a special case
of session M: 1, where degree number M can be limited by appropriate unique
index. An alternative solution can be using a relational table as primary key
(see example below).</span></p>

<p class="c4"><span class="c2 c12">Mapping of relation M:N</span></p>

<p class="c18 c53"><span>The binding is implemented using two relations M:1
&amp; 1:N, which are mapped on the other (relation) table.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c23 c19"><a name="h.f52f9a1ffe92"></a><span>Lazy loading</span></h2>

<p class="c4"><span>Late loading of objects is a process that generally allows
more efficient transfer of data between the database and the client. Late
loading is implemented for each attribute that contains other entity, which is,
in the database model, mapped by a foreign key.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>In late loading of an object Ujorm starts new database
query that uses a database connection stored in </span><span class="c12">opened
session.</span><span>&#xa0;However, because the entity </span><span
class="c12">can't </span><span>open the closed session is itself, so
LazyLoading on closed session shows a run-time exception:</span></p>

<p class="c1"><span>new IllegalStateException ("The session is
closed")</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Such exemption can be avoided by choosing a suitable
solution:</span></p>
<ol class="c27">
  <li class="c0"><span>before invoking lazy to assign a open session to
    object:</span></li>
</ol>

<p class="c4 c36"><span>OrmUjo.writeSession(session)</span></p>
<ol class="c27">
  <li class="c0"><span>before invoking lazy to update the attributes of an
    object from database:</span></li>
</ol>

<p class="c4 c36"><span>Session.reload (ujo)</span></p>
<ol class="c27">
  <li class="c0"><span>load the required lazy property right after obtaining
    the object using method according to the model:</span></li>
</ol>

<p class="c4 c36"><span>item.getOrder();</span></p>
<ol class="c27">
  <li class="c0"><span>retrieve all the lazy property to the desired depth by
    method:</span></li>
</ol>

<p class="c4 c36"><span>OrmTools.loadLazyValuesAsBatch(...)</span></p>
<ol class="c27">
  <li class="c0"><span>sometimes it is not necessary to load the entire entity,
    just a </span><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/orm/ForeignKey.html">foreign
    key</a></span><span>, for which there is no need to have an opened session.
    This key can be obtained by command:</span></li>
</ol>

<p
class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;OrmTable.readFK
(property)</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Note: Ujorm core doesn't use this method and isn't included
in OrmUjo interface. The method is available in the default implementation of
OrmTable.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Sometimes you need to get lazy attribute(s) with a single
SQL query using JOIN for more database query optimization, or to use some
specific operators in your database. In this case, you can use:</span></p>
<ol class="c27">
  <li class="c0"><span>user's query called "Ujorm native query" mapped to a new
    entity, or</span></li>
  <li class="c0"><span>database VIEW - mapped to the new entity</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<h2 class="c19"><a name="h.b0f5b8a80c12"></a><span>Session cache</span></h2>

<p class="c4"><span>Ujorm uses caching objects in session in order to limit
duplicate database queries. Cache behavior has a simple rule:</span></p>
<ol class="c27">
  <li class="c0"><span>lifetime of cache has range (SCOPE) of database
    transactions. After executing a commit / rollback the cache will be
    released</span></li>
  <li class="c0"><span>in cache would get only objects of foreign key when
    loading lazy (lazy loading), in other cases the object is always loaded
    from the database</span></li>
  <li class="c0"><span>while updating the object, cache doesn't sync and so for
    elimination of potential conflicts you can empty the cache by </span><span
    class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/orm/Session.html#cacheClear%28%29">clearCache()</a></span></li>
  <li class="c0"><span>cache storage is protected against memory overload, it
    means that the garbage collector can release part of the cache at any
    time</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<p class="c18"><span>From cache side: Ujorm doesn't have exclusive access to
the database, the registration will only need to align the allocation of
primary keys. With parameter </span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/metaModel/MetaParams.html#CACHE_POLICY">CACHE_POLICY</a></span><span>&#xa0;you
can disable the cache for whole meta-model or you can disable releasing the
cache with the garbage collector.</span></p>

<p class="c18"><span>To optimize performance rather recommend to keep the cache
of</span><span class="c12">&#xa0;logic units</span><span>&#xa0;at the level of
application logic (e.g., Articles) than maintaining a cache of database
rows.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.dda7591ed9d5"></a><span>DDL support</span></h2>

<p class="c4"><span>Ujorm can create or update the database schema using DDL
commands according its meta-model. Meta-model contains a description of the
real database structure, which is built from class names, UjoProperty names,
their annotations and occasionally from a XML configuration file. Once the
meta-model loading (into a memory) is finished, the information is locked so
any future modifications aren't possible. Updating the database is following
these rules:</span></p>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c0"><span>updates are carried out according to a meta-model right
    after its completion in the OrmHandler object</span></li>
  <li class="c0"><span>update is done only for </span><span
    class="c12">database items:</span></li>
</ol>
<ol class="c33">
  <li class="c4 c16"><span>new table</span></li>
  <li class="c4 c16"><span>new columns</span></li>
  <li class="c4 c16"><span>new indexes</span></li>
  <li class="c4 c16"><span>db schema is created only on the first
  update</span></li>
</ol>
<ol class="c27" start="3">
  <li class="c0"><span>item (column, index) created in the database framework
    is no longer changed, so you will have to be handle migrations on
    </span><span class="c12">your own</span><span>, for example:</span></li>
</ol>
<ol class="c33">
  <li class="c4 c16"><span>change the column NULL to NOT NULL (or
  back)</span></li>
  <li class="c4 c16"><span>change in the index UNIQUE to NON-UNIQUE (or
    back)</span></li>
  <li class="c4 c16"><span>change the primary key of table, etc.</span></li>
</ol>
<ol class="c27" start="4">
  <li class="c0"><span>database table must contain at least the primary
    key</span></li>
  <li class="c0"><span>Ujorm ignores non-mapped database objects (tables,
    columns, indexes)</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Parameter </span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/metaModel/MetaParams.html#ORM2DLL_POLICY">ORM2DLL_POLICY</a></span><span>&#xa0;can
change behavior of update to one of the following </span><span class="c11"><a
class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/ao/Orm2ddlPolicy.html">approaches</a></span><span>:</span></p>
<ol class="c27">
  <li class="c0"><span>update ban</span></li>
  <li class="c0"><span>allow only the first creation of the db model</span></li>
  <li class="c0"><span>allow incremental changes (default)</span></li>
</ol>

<p class="c18"><span>General use of Ujorm parameters is described in the
</span><span class="c11"><a class="c8"
href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/SampleORM.java?view=markup">tutorial</a></span><span>.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c23 c19"><a name="h.c672291e4db1"></a><span>Entity
inheritance</span></h2>

<p class="c4"><span>Ujorm doesn't support the concept of inheritance in the
JPA. The main reason is that implementation of inheritance into the existing
Ujorm architecture simply doesn't fit.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Easy availability of inheritance in ORM tempting to
light-headed use, which can cause performance problems on production data, so I
recommend rather avoid the inheritance. However, if required, Ujorm allows
</span><span class="c12">to emulate</span><span>&#xa0;inheritance - using
design pattern of </span><span class="c12">aggregation and
interface</span><span>&#xa0;(interface).</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>&#xa0; In draft of solution the inheritance are used
entities:</span></p>
<ol class="c27">
  <li class="c0"><span>User [id, login, password, name]</span></li>
  <li class="c0"><span>Customer [user, company, discount]</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>The proposed solution is based on IUser interface, that
implements User and Customer objects. Both entities, User and Customer, shares
the same ID. We can start using the advantages of inheritance, because instance
of type </span><span class="c12">ICustomer</span><span>&#xa0;can be written to
the data type </span><span class="c12">IUser.</span><span>&#xa0;Descriptions of
</span><span class="c12">setters</span><span>&#xa0;have been skipped to
simplify the diagram.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c29"><img height="238" src="images/image05.png" width="335"></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Notice that the 'Customer' has a </span><span
class="c12">primary key</span><span>&#xa0;of </span><span class="c12">User
</span><span>type and shares the same ID value:</span></p>

<p class="c1 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c44"><p class="c4"><span class="c6">public class Customer
        extends OrmTable&lt;Employee&gt; implements IUser {</span></p>

        <p class="c1"><span class="c6">@Column(</span><span
        class="c6 c12">pk=true</span><span class="c6">, value=</span><span
        class="c6 c13">"id"</span><span class="c6">)</span></p>

        <p class="c1"><span class="c6">public static final
        UjoProperty&lt;Customer, User&gt; </span><span
        class="c6 c12">user</span></p>

        <p class="c4 c40 c21"><span class="c6 c12"></span></p>

        <p class="c4 c40"><span class="c6">= newProperty(User.</span><span
        class="c10 c6">class</span><span class="c6">);</span></p>

        <p class="c1"><span class="c6">...</span></p>

        <p class="c4"><span class="c6">}</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c4"><span>Implementation of the method </span><span
class="c12">Customer.getLogin ()</span><span>&#xa0;might look like
this:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c55"><p class="c4"><span class="c6">@Override</span></p>

        <p class="c4"><span class="c6">public String getLogin() {</span></p>

        <p class="c1 c21"><span class="c6"></span></p>

        <p class="c1"><span class="c6">return get(user).getLogin();</span></p>

        <p class="c4"><span class="c6">}</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c1 c21"><span class="c6"></span></p>

<p class="c4 c21 c36"><span class="c6"></span></p>

<p class="c4"><span>In operations such as INSERT and UPDATE, we have to take
care of each entity separately. See the example of coding to save the
'Customer':</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c62"><p class="c4"><span class="c6">&#xa0;Session session =
        handler.getSession();</span></p>

        <p class="c4"><span
        class="c6">&#xa0;session.save(customer);&#xa0;&#xa0; // Save the parent
        User object too</span></p>

        <p class="c4"><span class="c6">&#xa0;session.commit();</span></p>

        <p class="c4"><span class="c6">&#xa0;...</span></p>

        <p class="c4"><span class="c6">&#xa0;session.update(customer); //
        Update the parent User too</span></p>

        <p class="c4"><span class="c6">&#xa0;session.commit();</span></p>

        <p class="c4"><span class="c6">&#xa0;...</span></p>

        <p class="c4"><span class="c6">&#xa0;session.delete(customer); //
        Delete the parent User too</span></p>

        <p class="c4"><span class="c6">&#xa0;session.commit();</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c18 c21"><span class="c6"></span></p>

<p class="c18"><span>Example of a full implementing the inheritance of the
'Customer' class can be found </span><span class="c11"><a class="c8"
href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/inheritance/src/main/java/org/bo/Customer.java?view=markup">here</a></span><span>&#xa0;and
its use </span><span class="c11"><a class="c8"
href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/inheritance/src/main/java/org/SampleOfInheritance.java?view=markup">here</a></span><span>.
For more information see the parametr </span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/metaModel/MetaParams.html#INHERITANCE_MODE">INHERITANCE_MODE</a></span><span>.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c23 c19"><a name="h.e795e614c8d5"></a><span>Primary key auto
increment</span></h2>

<p class="c4"><span>Ujorm supports automatic generation of primary key using
</span><span class="c12">UjoSequencer </span><span>class. The solution was
influenced primarily by requirements for high </span><span
class="c12">reliability</span><span>&#xa0;and smooth </span><span
class="c12">portability </span><span>of implementation between database of
different providers. Allocation of primary keys is following these
rules:</span></p>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c0"><span>Primary key (PK) will be assigned automatically only if
    the value of 'UjoProperty' is NULL. It is possible to assign own values of
    PK without changing any configuration.</span></li>
  <li class="c0"><span>Each table has its own set of primary keys, about which
    take care its own instance of the&#xa0; UjoSequencer class. Class
    UjoSequencer contains primary key values in an auxiliary database table
    </span><span class="c12">ujorm_pk_support,</span><span>&#xa0;here is a
    description of columns:</span></li>
</ol>
<ol class="c33">
  <li class="c4 c16"><span class="c12">id</span><span>&#xa0;(db type VARCHAR) -
    table name including schema format</span></li>
  <li class="c4 c16"><span class="c12">seq</span><span>&#xa0;- the value last
    assigned sequence</span></li>
  <li class="c4 c16"><span class="c12">cache</span><span>&#xa0;- UjoSequencer
    can allocate a number of consecutive numbers, which then allocates from
    memory to increase performance. Enabled cache may cause:</span></li>
</ol>
<ol class="c67">
  <li class="c4 c65"><span>discontinuous series of keys in case of restart
    Ujorm</span></li>
  <li class="c4 c65"><span>violation of time sequence in the case of multiple
    Ujorm clients</span></li>
</ol>

<p class="c4 c36"><span>This behavior can be eliminated by disabling the cache
using value 1. Value of cache can be modified correctly also in application
program (SQL command).</span></p>
<ol class="c33">
  <li class="c4 c16"><span class="c12">maxvalue</span><span>&#xa0;- if a column
    'seq' exceeds the maximum value, Ujorm shows an exception</span></li>
</ol>
<ol class="c27">
  <li class="c0"><span>allocating the primary key of Ujorm is used independent
    DB connection, so that any rollback of transaction wouldn't cause the
    return already assigned primary keys</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<p class="c18"><span>How does the default class </span><span
class="c12">UjoSequence</span><span>? Sequence numbers are taken from the
database table column </span><span
class="c12">ujorm_pk_support.seq</span><span>. Ujorm have also booked a series
of numbers in advance, not to have ID for each reaching back to the DB, the
buffer size is governed by the cache column. The </span><span
class="c12">seq</span><span>&#xa0;column is always the last number of the
allocated range. Column </span><span class="c12">maxvalue</span><span>&#xa0;can
limit the maximum number of assigned sequence, in case the next number
overcomes the limit so the class UjoSequencer&#xa0;throws exception. If
</span><span class="c12">maxvalue </span><span>have got zero, so the limit is
not checked.</span></p>

<p class="c18"><span>A common question is how to use native support of database
sequence? The solution lies in creating own implementation (child) of
</span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/UjoSequencer.html">UjoSequencer</a></span><span>&#xa0;class.
Class of this child must be registered in the parameters Ujorm before creating
a meta-model. The only requirement of solution is that the acquisition of a new
primary key (e.g. using JDBC) must be completed before INSERT command. Removing
this condition is in the development plan of Ujorm.</span></p>

<p class="c18"><span>There is possible to suppress the formation table
'ujorm_pk_support' by the overriding the method
UjoSequencer.isSequenceTableRequired() in case a different implementation of
the ID generator is used.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.7b8bdc481ed0"></a><span>Database
procedures</span></h2>

<p class="c4"><span>Ujorm supports since version 0.94 invoking database stored
</span><span class="c12">procedures</span><span>&#xa0;and </span><span
class="c12">functions&#xa0;</span><span>(furthermore just a procedure). Each
procedure is described by class extending an abstract DbProcedure class, which
implements the Ujo. Important is an order of UjoProperties in the class, which
must match the order of parameters in the procedure. If the procedure
</span><span class="c12">have no return type,</span><span>&#xa0;the first
constant UjoProperty in order will be </span><span class="c12">Void.class
</span><span>type</span><span class="c12">.</span><span>&#xa0;The first
UjoProperty is OUTPUT type, others are INPUT type. The default type of
keys you can override by annotation </span><span class="c5">@Parameter
(input = true, output = true).</span><span>&#xa0;Database procedures need to be
</span><span class="c12">registered</span><span>&#xa0;in the class of databases
like the database table:</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21 c36"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr>
      <td class="c24"><p class="c1"><span>public static final Property
        &lt;Database,MyProcedure&gt; procedure</span></p>

        <p class="c4 c36"><span>= NewInstance (MyProcedure.class);</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21 c36"><span></span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>We create an instance of the procedure, fill the INPUT type
parameters and invoke with 'call' method with parameter of opened
session:</span></p>

<p class="c4 c21"><span></span></p>

<p class="c1"><span>MyProcedure procedure = new MyProcedure().</span></p>

<p class="c1"><span>procedure.set (MyProcedure.DATE, new Date ());</span></p>

<p class="c1"><span>String result = procedure.call (session);</span></p>

<p class="c18"><span>Complete example you can find in </span><span
class="c11"><a class="c8"
href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/SampleORM.java?view=markup">tutorial</a></span><span>.
Instances of the procedure isn't connected with a particular session and such
instance can be used can frequently with different parameters (only one-thread
access). Ujorm version 1.00 does not support the return type of parameter
ResultSet.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c23 c19"><a name="h.fa936dd12adb"></a><span>Connection to
database</span></h2>

<p class="c4"><span>How to configure a database connection for Ujorm? You can
use parameters for the direct database configuration or use some JNDI service
(from an application server for example). If the JNDI parameter have got no
empty text then other direct database parameters will be ignored. The JNDI
solution is preffered in a production environment.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>There are three basic ways how to configure the database
connection:</span></p>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c0"><span>Use the annotation </span><span class="c11"><a
    class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/orm/annot/Db.html">@Db</a></span><span>&#xa0;on
    the class where are database table configured. See the </span><span
    class="c11"><a class="c8"
    href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/Database.java?view=markup">sample</a></span><span>&#xa0;of
    use for more information. This is very quick and type safe
  solution.</span></li>
  <li class="c0"><span>Overwrite the configuration annotations by XML
    configuration file. The full final content of the file is logged in the
    time of start you application. Simple example for the MySQL dialect
    follows:</span></li>
</ol>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr>
      <td class="c35"><p class="c4 c21"><span></span></p>
      </td>
      <td class="c60"><p class="c4 c21 c56"><span class="c28"></span></p>

        <table cellpadding="0" cellspacing="0" class="c3">
          <tbody>
            <tr>
              <td class="c59"><p class="c4"><span class="c28">&lt;?xml
                version="1.0" encoding="UTF-8"?&gt;</span></p>

                <p class="c4"><span class="c28">&lt;body&gt;</span></p>

                <p class="c4"><span class="c28">&#xa0;&#xa0;&#xa0; &lt;database
                id="DatabaseConfigurationClass"&gt;</span></p>

                <p class="c4"><span
                class="c28">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
                &lt;schema&gt;TestDBSchema&lt;/schema&gt;</span></p>

                <p class="c4"><span
                class="c28">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
                &lt;user&gt;applicationUser&lt;/user&gt;</span></p>

                <p class="c4"><span
                class="c28">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
                &lt;password&gt;userPassword&lt;/password&gt;</span></p>

                <p class="c4"><span
                class="c28">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
                &lt;dialect&gt;org.ujorm.orm.dialect.MySqlDialect&lt;/dialect&gt;</span></p>

                <p class="c4"><span
                class="c28">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
                &lt;jdbcUrl&gt;jdbc:mysql://127.0.0.1:3306/&lt;/jdbcUrl&gt;</span></p>

                <p class="c4"><span
                class="c28">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
                &lt;jdbcDriver&gt;com.mysql.jdbc.Driver&lt;/jdbcDriver&gt;</span></p>

                <p class="c4"><span
                class="c28">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
                &lt;jndi&gt;&lt;/jndi&gt;</span></p>

                <p class="c4"><span class="c28">&#xa0;&#xa0;&#xa0;
                &lt;/database&gt;</span></p>

                <p class="c4"><span class="c28">&lt;/body&gt;</span></p>
              </td>
            </tr>
          </tbody>
        </table>

        <p class="c4 c21"><span></span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c66"><span>Where:</span></p>
<ol class="c27">
  <li class="c4 c52"><span class="c12">database </span><span>id - is the the
    name of a configuration Class from you application&#xa0; without
    package</span></li>
  <li class="c4 c52"><span class="c12">schema </span><span>- default database
    schema (can be empty), however each table can have got your own schema.
    Table schema can be modified in the XML by a table configuration
    tags.</span></li>
  <li class="c4 c52"><span class="c12">user </span><span>- the application
    database user</span></li>
  <li class="c4 c52"><span class="c12">password </span><span>- is a password
    for the user</span></li>
  <li class="c4 c52"><span class="c12">dialect </span><span>- use one dialect
    from or your own</span></li>
  <li class="c4 c52"><span class="c12">jdbcUrl </span><span>- JDBC
  URL</span></li>
  <li class="c4 c52"><span class="c12">jdbcDriver </span><span>- JDBC
    Driver</span></li>
  <li class="c4 c52"><span class="c12">jndi </span><span>- no empty JNDI string
    have got an more strong priority than any previous parameters. Some more
    information can be found in the </span><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/orm/annot/Db.html#jndi%28%29">JavaDoc</a></span><span>&#xa0;.</span></li>
</ol>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c0"><span>Create a special child of the SqlDialect class and
    overwrite a special method for creating the database connection:
    </span><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/orm/SqlDialect.html#createConnection%28org.ujorm.orm.metaModel.MetaDatabase%29">SqlDialect.createConnection()</a></span><span>.
    The method can implement any special implementation by your
  idea.</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19 c37"><a name="h.b24a52ae4cf8"></a><span>Batch database
operations</span></h2>

<p class="c37 c23 c19"><span>For a better performance is useful to use so
called 'batch operation'. The common feature is that many rows is affected by a
single SQL statement. There are supported next cases of the typical
use.</span></p>

<h4 class="c19 c23"><a name="h.8e5b77e9f3e8"></a><span>Batch insert</span></h4>

<p class="c1"><span>Most of databases supports special SQL statement for Multi
Row Insert. The statement can import many database rows by a single SQL
statement. If database doesn't supports the feature, so all rows will be
inserted by many plain SQL INSERT statements. See next sample of use:</span></p>

<p class="c1 c21"><span></span></p>

<p class="c1 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c42"><p class="c4"><span>&#xa0; List&lt;Item&gt; itemList =
        createOrderItems();</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span>&#xa0; session.</span><span
        class="c12">save</span><span>(itemList);</span></p>

        <p class="c4"><span>&#xa0; session.commit();</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span></span></p>

<p class="c23 c19 c31"><span>Warning: the batch insert affect to parent objects
(if any) using a plain INSERT statement only.</span></p>

<h4 class="c23 c19"><a name="h.d4e9acf1b3f4"></a><span>Batch update</span></h4>

<p class="c1"><span>Ujorm can modify a table column(s) to any CONSTANT by
single SQL statement. The example updates one database column (created) to the
current date for all Orders where id&gt;=1 .</span></p>

<p class="c4 c21"><span></span></p>

<p class="c1 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c42"><p
        class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; Order order
        = new Order();</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span
        class="c32">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; // Activate the
        Change column management:</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        order.writeSession(session);</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span
        class="c32">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; // Set a
        value(s) to the change:</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        order.setCreated(new </span><span
        class="c12">Date</span><span>());</span></p>

        <p class="c4 c21"><span></span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        Criterion&lt;Order&gt; criterion&#xa0; = Criterion.where(Order.id, GE,
        1L);</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        session.</span><span class="c12">update</span><span>(order,
        criterion);</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        session.commit();</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span></span></p>

<p class="c31 c23 c19"><span>Warning: batch update does affect to parent
objects (if any). Modification to an expression is not supported in the current
version of Ujorm.</span></p>

<h4 class="c23 c19"><a name="h.a9a5e52dcb3d"></a><span>Batch delete</span></h4>

<p class="c1"><span>The next example deletes all Items where Item.id &lt; 10.
See more information in JavaDoc.</span></p>

<p class="c1 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c42"><p class="c4"><span>&#xa0;&#xa0;&#xa0;
        Criterion&lt;Item&gt; crit = Criterion.where(Item.id, LT, </span><span
        class="c12">10</span><span>L);</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; int count =
        session.delete(crit);</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; session.commit();</span></p>

        <p class="c4"><span>&#xa0;&#xa0;&#xa0; System.out.println("There are
        DELETED rows: " + count);</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span></span></p>

<p class="c1"><span>Warning: batch delete does affect to parent objects (if
any).</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c23 c19"><a name="h.286935a745d0"></a><span>Transaction
control</span></h2>

<p class="c4"><span>All database DML statements can be seen as temporary until
they are committed. Ujorm supports commitment with the Ujorm Session.commit() .
Method Session.rollback() is used to remove operations performed since the
previous commit or rollback. Use this method when an exception occurs or when
the program detects some error condition or error in the data.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>For a parallel transaction use a next session.</span></p>

<p class="c4"><span>See a JDBC 2.0 documentation for more
information.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<h2 class="c23 c19"><a name="h.dahj244afoo5"></a><span>Logging
support</span></h2>

<p class="c4"><span>The Ujorm have got a native support for the both logging
tools</span></p>
<ol class="c27">
  <li class="c4 c46"><span class="c12">org.slf4j.Logger</span><span>&#xa0;from
    </span><span class="c25"><a class="c8" href="http://www.slf4j.org/">SLF4J
    framework</a></span><span>&#xa0;or the</span></li>
  <li class="c4 c46"><span
    class="c12">java.util.loggingl.Logger</span><span>&#xa0;from the JRE
    5.0+</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<p class="c18"><span>On the first request to log a message from the Ujorm
framework is processed:</span></p>
<ol class="c27">
  <li class="c18 c46"><span>the Ujorm try to load a class
    org.slf4j.Logger</span></li>
  <li class="c18 c46"><span>if the class is loaded succesfully and the action
    does not throw an other exception, than an internal flag i switched to the
    SLF4J logger support</span></li>
  <li class="c18 c46"><span>if the class is not found or any else exception is
    throwed, than the Ujorm is switched to a native JRE logger.</span></li>
</ol>

<p class="c18"><span>Of course, you can use any other logging systems based on
the interface org.slf4j.Logger as the </span><span class="c25"><a class="c8"
href="http://logback.qos.ch/">LogBack</a></span><span>&#xa0;for example. There
is need to customize your project along the logging framework&#x2019;s
documentation.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c23 c19"><a name="h.87af2d291d2c"></a><span>Multi-thread
environment</span></h2>

<p class="c4"><span>The </span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/implementation/orm/OrmTable.html">OrmTable</a></span><span>&#xa0;UJO
class is not ready to use in multi-thread environment by default
implementation. You can eliminate some risks probably using a read-only mode
and loading all needed lazy keys before you share the object to more
threads. However for the case is prepared a specilal implementation called
</span><span class="c11"><a class="c8"
href="http://ujorm.org/javadoc/org/ujorm/implementation/orm/OrmTableSynchronized.html">OrmTableSynchronized</a></span><span>&#xa0;with
the next features:</span></p>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c0"><span>there are synchonized methods </span><span
    class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/Ujo.html#readValue%28org.ujorm.UjoProperty%29">Ujo.readValue(Property)</a></span><span>&#xa0;and</span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/Ujo.html#writeValue%28org.ujorm.UjoProperty,%20java.lang.Object%29">Ujo.writeValue(Property,
    Object)</a></span><span>&#xa0; and some more strategy methods</span></li>
  <li class="c0"><span>there is used a special object </span><span
    class="c12">ThreadLocal&lt;Session&gt;</span><span>&#xa0;to store the
    private object Session</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>The data lazy loading in a new thread needs to assign a new
(open) Session instance always. The great news are that an incorrect lazy
property loading throws the IllegalStateException instead of a dead-lock
risk.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c23 c19"><a name="h.2dc8b03b0862"></a><span>API extension</span></h2>

<p class="c4"><span>In development, after time we can meet the requirement of
implementation of specific function or features of SQL language. For this type
of requirement can be created "own child" of </span><span class="c11 c12"><a
class="c8"
href="http://ujorm.org/javadoc/org/ujorm/orm/SqlDialect.html">SqlDialect</a></span><span>&#xa0;class
(or some of its implementation), because this class provides several important
activities:</span></p>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c0"><span>creates a specific SQL queries for different CRUD type
    databases</span></li>
  <li class="c0"><span>defines the syntax of each type of operator in the WHERE
    phrase</span></li>
  <li class="c0"><span>creates DDL commands according to a
  meta-model</span></li>
  <li class="c0"><span>provides DB connection (or other parameters for DB
    connection)</span></li>
  <li class="c0"><span>provides a list of SQL keywords</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Any of the attributes above can be easily modified by
creating a 'child', new class is registered by annotation in the Database class
type. Overlapping the SqlDialect class can solve one of the following
requirements:</span></p>
<ol class="c27">
  <li class="c0"><span>expansion and optimization of SQL queries</span></li>
  <li class="c0"><span>mapping of specific data type of SQL language</span></li>
  <li class="c0"><span>completion of own operators for Criterion class has two
    steps:</span></li>
</ol>
<ol class="c61">
  <li class="c4 c16"><span>create a child of </span><span class="c11"><a
    class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/criterion/ValueCriterion.html">ValueCriterion</a></span><span>&#xa0;class,
    extended with specification of a custom type</span></li>
  <li class="c4 c16"><span>overlay method </span><span class="c11"><a
    class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/orm/SqlDialect.html#getCriterionTemplate%28org.ujorm.criterion.ValueCriterion%29">SqlDialect.getCriterionTemplate
    ()</a></span><span>&#xa0;implementing the extended operator</span></li>
</ol>
<ol class="c27" start="4">
  <li class="c0"><span>creating own DB connection or a its modification (adding
    parameters)</span></li>
  <li class="c0"><span>add or remove a reserved SQL keywords</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<p class="c18"><span class="c12">TypeService</span></p>

<p class="c18"><span>class provides a mapping of application values to the JDBC
API. Methods of class can be overridden with your own implementations.
Registration is done by annotation in the 'Database' type class.</span></p>

<p class="c18"><span class="c12">UjoSequencer</span></p>

<p class="c18"><span>As stated earlier, this class allows the implementation of
your own algorithm for assigning a unique ID to INSERT command. Registration is
done by annotation in the 'Database' type class.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.5902a957f5ab"></a><span>Meta-Model</span></h2>

<p class="c4"><span>Meta-model is created according to the content of Ujo
keys of Database class and its tables. The names of tables, view and
procedure are derived from names of Ujo property. Most features of the model
can be overridden by annotations placed directly in property or in name of the
class. Features set by annotation can be also overridden by configuration XML
file, which can optionally modify only selection of a meta-model.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>After creating a meta-model in memory, the model is locked
and you can't write into meta-model anymore, at run-time, however, you can
obtain useful information from it. Slightly simplified class diagram meta is in
the following picture:</span></p>

<p class="c4 c21 c29"><span></span></p>

<p class="c4 c29"><img height="452" src="images/image00.png" width="431"></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span class="c12">Entity Description:</span></p>
<ol class="c27">
  <li class="c0"><span>OrmHandler is a class providing meta-model, in the
    application is recommended to keep only one instance of this class. Class
    offers several methods to provide selected parts of meta-model. OrmHandler
    is the only entity in the diagram, which isn't a child of an abstract
    AbstractMetaModel class (implementing the interface of Ujo).</span></li>
  <li class="c0"><span>MetaRoot creates the base of meta-model and allows you
    to read an XML configuration file</span></li>
  <li class="c0"><span>MetaParams contains general Ujorm parameters that can be
    also modify by the XML configuration file</span></li>
  <li class="c0"><span>MetaDatabase contains a database connection, a list of
    tables (or views) and the list of database procedures. It also includes a
    default schema.</span></li>
  <li class="c0"><span>MetaTable represents the database table that takes the
    schema from 'MetaDatabase', but you can configure (with annotations) also a
    different scheme. Logical attribute 'view' differs view from the tables
    (you can't white into 'view' and it doesn't affect the updating of the
    DB).</span></li>
  <li class="c0"><span>MetaPKey - each table contains one primary
  key</span></li>
  <li class="c0"><span>MetaRelation2Many - represents a 1: M type database
    session</span></li>
  <li class="c0"><span>MetaColumn - class represents the database column, or
    stored procedure parameters.</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.529d45f07307"></a><span>Performance</span></h2>

<p class="c4"><span>Ujorm is very fast in comparison to its competitors, see
the benchmark table to detail information. I hope that you will not be angry if
I compare Ujorm performance with the popular Hibernate ORM framework. The
result of the benchmark is listed in the next table. Each action represents a
type of database operation with </span><span class="c12">no
optimization</span><span>, all tests are performed by default Java
parameters.</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c14"><p class="c4"><span
        class="c9 c12">Action</span><span>&#xa0;</span><span
        class="c9 c12">on</span></p>

        <p class="c4"><span class="c9 c12">PostgreSQL</span></p>
      </td>
      <td class="c14"><p class="c4 c29"><span class="c9 c12">Ujorm
        1.00</span></p>

        <p class="c4 c29"><span class="c9">[sec]</span></p>
      </td>
      <td class="c14"><p class="c4 c29"><span class="c9 c12">Hibernate
        3.3.1</span></p>

        <p class="c4 c29"><span class="c9">[sec]</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span
        class="c9 c12">Ratio</span><span>&#xa0;</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">meta data</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>0.33</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>1.53</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>4.65</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">single select</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>0.35</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>0.58</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>1.67</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">multi select</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>21.78</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>168.01</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>7.71</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">empty select</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>1.24</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>151.17</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span class="c38 c12">121.85</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">insert</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>11.12</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>12.30</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>1.11</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">delete</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>101.18</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>208.28</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>2.06</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">update</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>8.04</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>3.90</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>0.49</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4"><span>&#xa0;</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Action description:</span></p>
<ol class="c27">
  <li class="c0"><span>meta data - time to loading meta-model and to verify
    database model (auto-update option is enabled)</span></li>
  <li class="c0"><span>single select - the one big select for all order items
    (with a condition)</span></li>
  <li class="c0"><span>multi select - many different selects to emulate a
    server application or statements with no optimization</span></li>
  <li class="c0"><span>empty selects - 2000 selects with the empty result -
    where a condition contains different parameter values</span></li>
  <li class="c0"><span>insert - insert 2000 orders, 14000 items and 1
    user</span></li>
  <li class="c0"><span>delete - execution many statements to delete all table
    rows</span></li>
  <li class="c0"><span>update - modify and save a loaded BO</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Environment description:</span></p>
<ol class="c27">
  <li class="c0"><span>date of performance: 2010-10-15</span></li>
  <li class="c0"><span>test through the 2000 orders and 14,000 items</span></li>
  <li class="c0"><span>against the database PostgreSQL 8.3 (on the same
    computer)</span></li>
  <li class="c0"><span>values are an average of 5 measurements</span></li>
  <li class="c0"><span>DB indexes was insignificant</span></li>
  <li class="c0"><span>Ujorm release 1.00</span></li>
  <li class="c0"><span>Hibernate 3.3.1.GA + EhCacheProvider</span></li>
  <li class="c0"><span>Java version "1.6.0_14" running with default run-time
    parameters</span></li>
  <li class="c0"><span>Intel Dual Core, 2GB RAM</span></li>
  <li class="c0"><span>Windows XP + SP3</span></li>
  <li class="c0"><span>benchmark code is available on the
  SourceForge</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span class="c12">The similar test </span><span>I have finished
on the </span><span class="c11"><a class="c8"
href="http://www.h2database.com/html/main.html">database
H2</a></span><span>&#xa0;(release 1.2.147) running in-memory mode. The test was
performed on 2011-01-29 on the release Ujorm 1.10:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c14"><p class="c4"><span
        class="c9 c12">Action</span><span>&#xa0;</span><span
        class="c9 c12">on</span></p>

        <p class="c4"><span class="c9 c12">H2 in-memory</span></p>
      </td>
      <td class="c14"><p class="c4 c29"><span class="c9 c12">Ujorm
        1.10</span></p>

        <p class="c4 c29"><span class="c9">[sec]</span></p>
      </td>
      <td class="c14"><p class="c4 c29"><span class="c9 c12">Hibernate
        3.3.1</span></p>

        <p class="c4 c29"><span class="c9">[sec]</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span
        class="c9 c12">Ratio</span><span>&#xa0;</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">meta data</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>0.42</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>1.26</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>3.0</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">single select</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>0.19</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>0.53</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>2.9</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">multi select</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>0.69</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>155.28</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span class="c38 c12">225.9</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">empty select</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>0.36</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>155.37</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span class="c38 c12">432.1</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">insert</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>1.62</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>2.43</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>1.5</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">delete</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>0.37</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>151.43</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span class="c12 c38">407.3</span></p>
      </td>
    </tr>
    <tr class="c15">
      <td class="c14"><p class="c4"><span class="c12">update</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>1.28</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>1.13</span></p>
      </td>
      <td class="c14"><p class="c4 c22"><span>0.9</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c18"><span>&#xa0;</span></p>

<p class="c18"><span class="c12">Note:</span></p>

<p class="c18"><span>The </span><span
class="c12">Hibernate</span><span>&#xa0;framework provides many parameters for
optimization, however some of them can bring some limitations. For example a
Hibernate transaction can be set to </span><span
class="c12">read-only</span><span>&#xa0;in the case of the exclusive SELECT(s)
to better performance. The </span><span class="c12">Ujorm </span><span>have got
&#xa0;a great performance on default settings so it will save&#xa0;a lot of
&#xa0;development time.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.6c32e8b75e6e"></a><span>Supported
databases</span></h2>

<p class="c4"><span>Ujorm framework offers prepared dialects for the following
databases:</span></p>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c4 c45"><span>PostgreSQL (8.3+)</span></li>
  <li class="c4 c45"><span>MySQL (5.0+)</span></li>
  <li class="c4 c45"><span>Derby (10.5+)</span></li>
  <li class="c4 c45"><span>Oracle (8.0+)</span></li>
  <li class="c4 c45"><span>H2 (1.2.147+)</span></li>
  <li class="c4 c45"><span>HSQLDB (1.8+)</span></li>
  <li class="c4 c45"><span>Firebird (jaybird 2.1.6+)</span></li>
  <li class="c4 c45"><span>MS-SQL on the SQL Server 2008 R2 (JDBC Driver
    3.0)</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<p class="c18"><span>As mentioned in the previous chapter, support for other
databases can be implemented by overwriting the </span><span class="c11 c12"><a
class="c8"
href="http://ujorm.com/javadoc/org/ujorm/orm/SqlDialect.html">SqlDialect</a></span><span>&#xa0;class
or one of its 'child'. The new class has to be registered in application class
of the 'Database' type.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.55252fa54c31"></a><span>Why UjoProperty constants
have lowercase letters?</span></h2>

<p class="c4"><span>In the examples mentioned in this document are the names of
the static field of UjoProperties often written in lower case - contrary to
normal convention. The reason is to shorten the code when creating UjoProperty,
but also seems to be useful when small letters more correspond to&#xa0;
instance variables (fields). Lowercase letters are proven to be better, but the
using the capital letters in your project won't create a technical
problem.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Full specification of UjoProperty can be set explicitly,
including a </span><span class="c12">name</span><span>, by this
pattern:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr>
      <td class="c24"><p class="c4"><span>&#xa0;</span><span
        class="c9 c12">public static final</span><span>&#xa0;Property &lt;BO,
        Long&gt;&#xa0;</span><span class="c6 c12">id</span><span>&#xa0;=
        </span><span class="c6">newProperty</span><span
        class="c6 c12">('id',</span><span>&#xa0;Long.</span><span
        class="c9 c12">class</span><span>);</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>In short writing is name of 'Property' taken from a name of
field:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr>
      <td class="c24"><p class="c4"><span class="c9 c12">public static
        final</span><span>&#xa0;Property &lt;BO, Long&gt; </span><span
        class="c6 c12">id</span><span>&#xa0;= newProperty (Long.</span><span
        class="c9 c12">class</span><span>);</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>Terms used in Ujorm:</span></p>
<ol class="c27">
  <li class="c0"><span>UjoProperty&#xa0;</span><span
    class="c12">field</span><span>&#xa0;- the name of the static constants of
    UjoProperty in the implementation of Ujo</span></li>
  <li class="c0"><span>UjoProperty&#xa0;</span><span
    class="c12">name</span><span>&#xa0;- a logical indication that returns
    'UjoProperty.getName()' as the String type</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.51c99f3693d0"></a><span>Using of UJO
objects</span></h2>

<p class="c4"><span>This chapter describes the important features of the UJO
object, which have an effect on the correct behavior:</span></p>

<p class="c4 c21"><span></span></p>
<ol class="c27">
  <li class="c0"><span>each </span><span
    class="c12">attribute</span><span>&#xa0;</span><span class="c12">of
    entity</span><span>&#xa0;has its own unique UjoProperty instance</span></li>
  <li class="c0"><span>for reading and writing values are used these
    methods:</span></li>
</ol>
<ol class="c33">
  <li class="c4 c16"><span>UjoProperty.getValue (..)</span></li>
  <li class="c4 c16"><span>UjoProperty.setValue (..)</span></li>
</ol>

<p class="c1"><span>or other methods that invoke them internally, for
example:</span></p>
<ol class="c33">
  <li class="c4 c16"><span>UjoMiddle.get (..)</span></li>
  <li class="c4 c16"><span>UjoMiddle.set (..)</span></li>
</ol>

<p class="c1"><span>or more comfortable </span><span
class="c12">getters</span><span>&#xa0;and </span><span
class="c12">setters,</span><span>&#xa0;that invoke (internally) one of the
methods above</span></p>
<ol class="c27">
  <li class="c0"><span>method 'UjoProperty.getValue()' </span><span
    class="c12">changes</span><span>&#xa0;values NULL to the default value
    UjoProperty (which is NULL if it isn't set otherwise). Beware, the method
    'Ujo.readValue()' doesn't do any replacement of default values.</span></li>
  <li class="c0"><span>for reading and writing values </span><span
    class="c12">is not recommended</span><span>&#xa0;to invoke </span><span
    class="c12">untyped</span><span>&#xa0;methods</span></li>
</ol>
<ol class="c33">
  <li class="c4 c16"><span>Ujo.readValue ()</span></li>
  <li class="c4 c16"><span>Ujo.writeValue ()</span></li>
</ol>

<p class="c1"><span>However, these two methods are suitable for the
</span><span class="c12">overriding </span><span>in propose to implement the
various conversions, validations and other requirements.</span></p>
<ol class="c27">
  <li class="c0"><span>for the </span><span
    class="c12">default</span><span>&#xa0;value of 'UjoProperty' is suitable
    only an </span><span class="c12">immutable object</span></li>
  <li class="c0"><span>Ujo objects can be generally inherited, inheritance of
    OrmUjo objects isn't supported directly</span></li>
  <li class="c0"><span>more information about Ujo Core can be found
    </span><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/package-summary.html#UJO">here</a></span><span>&#xa0;.</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.978d5de1fd78"></a><span>Best Practices</span></h2>
<ol class="c27">
  <li class="c0"><span>common ancestor of your domain objects can simplify
    behavior changes of all children. An example might be a generic
    implementation of method 'toString ()', or implementation of methods
    'equals (..)', 'hashCode ()', etc.</span></li>
  <li class="c0"><span>service for processing data from DB to Query can easily
    complement other Criterion. An example of use might be implementation of
    limited access to data based on context (role) of logged user</span></li>
  <li class="c0"><span>for access to the values of UJO objects proved using the
    methods:</span></li>
</ol>
<ol class="c33">
  <li class="c4 c16"><span>UjoMiddle.get (property)</span></li>
  <li class="c4 c16"><span>UjoMiddle.set (property, value)</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.c41270dc0dbb"></a><span>Integrating Spring
Framework</span></h2>

<p class="c4"><span>The Spring Framework can automate the creation and release
Ujorm session and manage a transaction management using a special module called
'orm-spring'. In a Maven project use the next dependency in your POM
file:</span></p>

<p class="c4 c21"><span></span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c20"><p class="c4"><span class="c5">&#xa0;&#xa0;
        &lt;dependency&gt;</span></p>

        <p class="c4"><span class="c5">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        &lt;groupId&gt;</span><span class="c12 c5">org.ujorm</span><span
        class="c5">&lt;/groupId&gt;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span></p>

        <p class="c4"><span class="c5">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        &lt;artifactId&gt;</span><span class="c12 c5">ujo-spring</span><span
        class="c5">&lt;/artifactId&gt;</span></p>

        <p class="c4"><span class="c5">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
        &lt;version&gt;</span><span class="c12 c5">1.22</span><span
        class="c5">&lt;/version&gt;</span></p>

        <p class="c4"><span class="c5">&#xa0;&#xa0;
        &lt;/dependency&gt;</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c5"></span></p>

<p class="c4"><span>How to get a Ujorm Session? The procedure for obtaining the
session will vary according to the code that calls the session:</span></p>
<ol class="c27">
  <li class="c0"><span>aroundSessionAOP - calls from a job or other
    internal</span></li>
  <li class="c0"><span>Open Session in View - using HTTP Request</span></li>
</ol>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>AroundSessionAOP is currently defined in the current
spring-beans.xml pointcut </span></p>

<p class="c1"><span class="c6 c5">org.application.administration.jobs
..*(..)</span></p>

<p class="c4 c21"><span class="c6 c5"></span></p>

<p class="c4"><span>Open Session in View is defined in the </span><span
class="c12">web.xml</span><span>&#xa0;.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4"><span>How to use the session manually?</span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c20"><p class="c4"><span class="c6 c30">&#xa0;&#xa0;
        UjoSessionFactoryFilter ujoSessionFactoryFilter</span></p>

        <p class="c4"><span class="c6 c30">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; =
        (UjoSessionFactoryFilter)wac.getBean("ujoSessionFactory");</span></p>

        <p class="c4"><span class="c6 c30">&#xa0;&#xa0;
        ujoSessionFactoryFilter.openSession();</span></p>

        <p class="c4"><span class="c6 c30">&#xa0;&#xa0; ...</span></p>

        <p class="c4"><span class="c6 c30">&#xa0;&#xa0;
        ujoSessionFactoryFilter.closeSession();</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6 c30"></span></p>

<p class="c4"><span>How to use a Manual control session and transaction - using
ORM handle?</span></p>

<table cellpadding="0" cellspacing="0" class="c3">
  <tbody>
    <tr class="c15">
      <td class="c20"><p class="c4"><span>&#xa0;</span><span class="c6">&#xa0;
        OrmHandler handler = (OrmHandler) wac.getBean("ormHandler");</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0; Session s =
        handler.createSession() ;</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0; ...</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0; s.commit();</span></p>

        <p class="c4"><span class="c6">&#xa0;&#xa0; s.close();</span></p>
      </td>
    </tr>
  </tbody>
</table>

<p class="c4 c21"><span class="c6"></span></p>

<p class="c4"><span>See the official </span><span class="c11"><a class="c8"
href="http://www.springsource.org/documentation">Spring
documentation</a></span><span>&#xa0;for more information.</span></p>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.304a6c50b9c1"></a><span>More information</span></h2>
<ol class="c27">
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/javadoc/org/ujorm/orm/package-summary.html">JavaDoc</a></span><span>&#xa0;the
    detail API descriptions with some examples of use</span></li>
  <li class="c0"><span class="c11"><a class="c8" href="http://ujorm.com/">Home
    Page</a></span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/presentation/index.htm#orm">Presentation</a></span><span>&#xa0;(intro
    slide show), includes</span></li>
</ol>
<ol class="c33">
  <li class="c4 c16"><span>short motivation</span></li>
  <li class="c4 c16"><span>Key Features</span></li>
  <li class="c4 c16"><span>Compared with competitors (Hibernate
  iBatis)</span></li>
</ol>
<ol class="c27" start="4">
  <li class="c0"><span>Examples of using </span><span class="c11"><a class="c8"
    href="http://ujorm.svn.sourceforge.net/viewvc/ujorm/trunk/samples/ujorm/src/main/java/org/SampleORM.java?view=markup">the
    source code</a></span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.blogspot.com/">Blog</a></span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/dokuwiki/doku.php">Wiki</a></span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://ujorm.org/dokuwiki/doku.php?id=orm_faq">Frequently asked
    questions - FAQ</a></span></li>
  <li class="c0"><span class="c11"><a class="c8"
    href="http://en.wikipedia.org/wiki/Wikipedia_talk:Articles_for_creation/Ujorm">Wikipedia</a></span><span>&#xa0;(declined
    article: how to get reputable, third-party information sources?)</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.772ac403cca2"></a><span>References</span></h2>
<ol class="c27">
  <li class="c0"><span>The </span><span class="c11"><a class="c8"
    href="http://www.effectiva.cz/en/ecall">eCall</a></span><span>&#xa0;is a
    complete software solution for management of corporate telecommunications -
    especially for a modern call center. It enables easy organization,
    management and automated operation of all telecommunications. See Ujorm
    development </span><span class="c11"><a class="c8"
    href="http://ujorm.blogspot.com/2010/10/ujorm-development-interview.html">Interview</a></span><span>.</span></li>
  <li class="c0"><span>Do you wish to make reference to your application, built
    on Ujorm? Send us a link to your project to the email address
    support@ujorm.com</span></li>
</ol>

<p class="c18 c21"><span></span></p>

<h2 class="c19"><a name="h.cc2d51f7ea2f"></a><span>Acknowledgements</span></h2>

<p class="c4"><span>Thanks to developer team at </span><span class="c11"><a
class="c8" href="http://www.effectiva.cz/">Effectiva
Solutions</a></span><span>&#xa0;for their valuable comments on the technical
content of this document.</span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>

<p class="c4 c21"><span></span></p>
</body>
</html>
