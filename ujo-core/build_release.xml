<?xml version="1.0" encoding="UTF-8"?>
<!-- 
*********************************************
* Author : PPone(c)2008
* Purpose: Create a ZIP archive
* Start  : "c:\jdk1.4\bin\java.exe" -jar "C:\Program Files\ant-1.5.1\lib\ant.jar" -verbose -buildfile archive.ant
*
* Build Description:
*    1) update "read-me.html"
*    2) modify parameters in bundle "Resource/build.properties"
*    3) run project JUnit tests
*    4) run ant default target of build_release.xml
*    5) copy file "dist/ujo.VERSION.zip" to internet
*
*********************************************
-->
<project name="archive-JavaProject" basedir="." default="public-build">
    <description>Create new BUILD !</description>

    <property name="jDocLang" value="en" /> <!-- cs/en -->
    <property name="manifest.file" value="dist/manifest.txt"/>
    
    <!-- Time stamp -->
    <tstamp/>

    <!-- Parrents, separated by "," character. -->
    <property name="include" value="*.*,src/**,src-tools/**,nbproject/project*,test/**" />

    <!-- Parrents, separated by "," character. -->
    <property name="exclude" value=",**/.*,**/*.class*,**/*.rar,**/*.java~,*.log,build*.xml,**/*.svg,www/**,**/z_package*.html,junit*.properties" />

    <!-- A root of the backuped directories -->
    <property name="root" value="${basedir}"/>

    <property file="Resource/build.properties"/>
    <property name="manifest.file" value="dist/manifest.txt"/>    
    <import   file="build.xml"/>
    <property name="dist.zip" value="dist/ujo.${version}.zip" />    
    <property name="javadoc.preview" value="false" />
    <property name="jar.compress" value="true" />
    <property name="javac.debug" value="false"/>

    <!-- - - - - - - - - INFORMATION - - - - - - - - - - -->
    <echo message="  dist.zip : ${dist.zip}"/>
    <echo message="  os.name  : ${os.name}"  />
    <echo message="  basedir  : ${basedir}"  />
    <echo message="  user.dir : ${user.dir}" />
    <echo message="  ant.file : ${ant.file}" />
    <echo message="  java.home: ${java.home}"/>
    <echo message="  tstamp   : ${DSTAMP}.${TSTAMP} - ${TODAY}"/>
    <echo message="  root     : ${root}"/>
    <echo message="  manifest : ${manifest.file}"/>
    
    <target name="-pre-jar">
        <mkdir dir="dist"/>
        <echo file="${manifest.file}">Main-Class: org.ujoframework.core.UjoManager
Specification-Title: ${name}
Specification-Version: ${version}
Specification-Vendor: Paul Ponec
Implementation-Title: ${implementationTitle}
Implementation-Version: ${version}
Implementation-Vendor: "Paul Ponec"</echo>

        <!-- delete sample -->
        <delete dir="build/classes/org/ujoframework/orm/sample" />

    </target>    


    <target name="public-build" depends="clean,jar,javadoc" description="Create new archiv.">

        <!-- Jméno zálohy. -->
        <echo message="Creating an builld archiv file: ${dist.zip}"/>
        
        <!-- replace in the html file -->
        <copy file="Resource/read-me.html" todir="build"/>
        <replaceregexp file="build/read-me.html" 
                       match="\$\{VERSION\}"
                       replace="${version}"
                       flags="g"
                       encoding="UTF-8"
                       byline="true" />
        <replaceregexp file="build/read-me.html" 
                       match="\$\{year\}"
                       replace="${year}"
                       flags="g"
                       encoding="UTF-8"
                       byline="true" />
        <replaceregexp file="build/read-me.html" 
                       match="\$\{homePage\}"
                       replace="${homePage}"
                       flags="g"
                       encoding="UTF-8"
                       byline="true" />

        <zip destfile="${dist.zip}" whenempty="create" compress="true" comment="UJO ${version}"> 
           <zipfileset 
              dir="${root}" 
              prefix="src"
              includes="${include}"
              excludes="${exclude}"
              casesensitive="no"
           />            
           
           <zipfileset 
              dir="dist" 
              prefix="bin"
              includes="*.jar"
              casesensitive="no"
           />            
           
           <zipfileset 
              dir="dist/javadoc" 
              prefix="javadoc"
              casesensitive="no"
           />            
           
           <zipfileset 
              dir="Resource" 
              prefix=""
              includes="*.txt"
              casesensitive="no"
           />            

           <zipfileset 
              dir="build" 
              prefix=""
              includes="*.html"
              casesensitive="no"
           />            
           
           
        </zip>

        <!-- Copy to other dir. 
        <copy file="${zipFile}" todir="d:/"></copy> 
        -->

    </target>
</project>
